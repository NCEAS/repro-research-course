<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Cleaning and Manipulating Data | Reproducible Practices for Arctic Research Using R</title>
  <meta name="description" content="8 Cleaning and Manipulating Data | Reproducible Practices for Arctic Research Using R" />
  <meta name="generator" content="bookdown 0.24.1 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Cleaning and Manipulating Data | Reproducible Practices for Arctic Research Using R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Cleaning and Manipulating Data | Reproducible Practices for Arctic Research Using R" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-modeling-essentials.html"/>
<link rel="next" href="data-visualization-and-publishing-to-the-web.html"/>
<script src="libs/header-attrs-2.19/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.19/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html#reproducible-research-techniques-for-synthesis" id="toc-reproducible-research-techniques-for-synthesis">Reproducible Practices for Arctic Research Using R</a>
<ul>
<li><a href="index.html#schedule" id="toc-schedule"><span class="toc-section-number">0.1</span> Schedule</a>
<ul>
<li><a href="index.html#code-of-conduct" id="toc-code-of-conduct"><span class="toc-section-number">0.1.1</span> Code of Conduct</a></li>
<li><a href="index.html#logistics" id="toc-logistics"><span class="toc-section-number">0.1.2</span> Logistics</a></li>
<li><a href="index.html#about-this-book" id="toc-about-this-book"><span class="toc-section-number">0.1.3</span> About this book</a></li>
</ul></li>
</ul></li>
<li><a href="welcome-and-introductions.html#welcome-and-introductions" id="toc-welcome-and-introductions"><span class="toc-section-number">1</span> Welcome and Introductions</a>
<ul>
<li><a href="welcome-and-introductions.html#introduction-to-the-arctic-data-center-and-nsf-standards-and-policies" id="toc-introduction-to-the-arctic-data-center-and-nsf-standards-and-policies"><span class="toc-section-number">1.1</span> Introduction to the Arctic Data Center and NSF Standards and Policies</a>
<ul>
<li><a href="welcome-and-introductions.html#learning-objectives" id="toc-learning-objectives"><span class="toc-section-number">1.1.1</span> Learning Objectives</a></li>
<li><a href="welcome-and-introductions.html#arctic-data-center---history-and-introduction" id="toc-arctic-data-center---history-and-introduction"><span class="toc-section-number">1.1.2</span> Arctic Data Center - History and Introduction</a></li>
<li><a href="welcome-and-introductions.html#data-discovery-portal" id="toc-data-discovery-portal"><span class="toc-section-number">1.1.3</span> Data Discovery Portal</a></li>
<li><a href="welcome-and-introductions.html#tools-and-infrastructure" id="toc-tools-and-infrastructure"><span class="toc-section-number">1.1.4</span> Tools and Infrastructure</a></li>
<li><a href="welcome-and-introductions.html#support-services" id="toc-support-services"><span class="toc-section-number">1.1.5</span> Support Services</a></li>
<li><a href="welcome-and-introductions.html#training-and-outreach" id="toc-training-and-outreach"><span class="toc-section-number">1.1.6</span> Training and Outreach</a></li>
<li><a href="welcome-and-introductions.html#data-rescue" id="toc-data-rescue"><span class="toc-section-number">1.1.7</span> Data Rescue</a></li>
<li><a href="welcome-and-introductions.html#who-must-submit" id="toc-who-must-submit"><span class="toc-section-number">1.1.8</span> Who Must Submit</a></li>
<li><a href="welcome-and-introductions.html#summary" id="toc-summary"><span class="toc-section-number">1.1.9</span> Summary</a></li>
</ul></li>
<li><a href="welcome-and-introductions.html#writing-good-data-management-plans" id="toc-writing-good-data-management-plans"><span class="toc-section-number">1.2</span> Writing Good Data Management Plans</a>
<ul>
<li><a href="welcome-and-introductions.html#learning-objectives-1" id="toc-learning-objectives-1"><span class="toc-section-number">1.2.1</span> Learning Objectives</a></li>
<li><a href="welcome-and-introductions.html#when-to-plan-the-data-life-cycle" id="toc-when-to-plan-the-data-life-cycle"><span class="toc-section-number">1.2.2</span> When to Plan: The Data Life Cycle</a></li>
<li><a href="welcome-and-introductions.html#why-plan" id="toc-why-plan"><span class="toc-section-number">1.2.3</span> Why Plan?</a></li>
<li><a href="welcome-and-introductions.html#how-to-plan" id="toc-how-to-plan"><span class="toc-section-number">1.2.4</span> How to Plan</a></li>
<li><a href="welcome-and-introductions.html#what-to-include-in-a-dmp" id="toc-what-to-include-in-a-dmp"><span class="toc-section-number">1.2.5</span> What to include in a DMP</a></li>
<li><a href="welcome-and-introductions.html#nsf-dmp-requirements" id="toc-nsf-dmp-requirements"><span class="toc-section-number">1.2.6</span> NSF DMP requirements</a></li>
<li><a href="welcome-and-introductions.html#tools-in-support-of-creating-a-dmp" id="toc-tools-in-support-of-creating-a-dmp"><span class="toc-section-number">1.2.7</span> Tools in Support of Creating a DMP</a></li>
<li><a href="welcome-and-introductions.html#arctic-data-center-support-for-dmps" id="toc-arctic-data-center-support-for-dmps"><span class="toc-section-number">1.2.8</span> Arctic Data Center Support for DMPs</a></li>
<li><a href="welcome-and-introductions.html#sharing-your-dmp" id="toc-sharing-your-dmp"><span class="toc-section-number">1.2.9</span> Sharing Your DMP</a></li>
<li><a href="welcome-and-introductions.html#additional-resources" id="toc-additional-resources"><span class="toc-section-number">1.2.10</span> Additional Resources</a></li>
</ul></li>
</ul></li>
<li><a href="documenting-and-publishing-data.html#documenting-and-publishing-data" id="toc-documenting-and-publishing-data"><span class="toc-section-number">2</span> Documenting and Publishing Data</a>
<ul>
<li><a href="documenting-and-publishing-data.html#data-documentation-and-publishing" id="toc-data-documentation-and-publishing"><span class="toc-section-number">2.1</span> Data Documentation and Publishing</a>
<ul>
<li><a href="documenting-and-publishing-data.html#learning-objectives-2" id="toc-learning-objectives-2"><span class="toc-section-number">2.1.1</span> Learning Objectives</a></li>
<li><a href="documenting-and-publishing-data.html#data-sharing-and-preservation" id="toc-data-sharing-and-preservation"><span class="toc-section-number">2.1.2</span> Data sharing and preservation</a></li>
<li><a href="documenting-and-publishing-data.html#data-repositories-built-for-data-and-code" id="toc-data-repositories-built-for-data-and-code"><span class="toc-section-number">2.1.3</span> Data repositories: built for data (and code)</a></li>
<li><a href="documenting-and-publishing-data.html#metadata" id="toc-metadata"><span class="toc-section-number">2.1.4</span> Metadata</a></li>
<li><a href="documenting-and-publishing-data.html#structure-of-a-data-package" id="toc-structure-of-a-data-package"><span class="toc-section-number">2.1.5</span> Structure of a data package</a></li>
<li><a href="documenting-and-publishing-data.html#dataone-federation" id="toc-dataone-federation"><span class="toc-section-number">2.1.6</span> DataONE Federation</a></li>
<li><a href="documenting-and-publishing-data.html#publishing-data-from-the-web" id="toc-publishing-data-from-the-web"><span class="toc-section-number">2.1.7</span> Publishing data from the web</a></li>
</ul></li>
</ul></li>
<li><a href="literate-analysis-with-rmarkdown.html#literate-analysis-with-rmarkdown" id="toc-literate-analysis-with-rmarkdown"><span class="toc-section-number">3</span> Literate Analysis with RMarkdown</a>
<ul>
<li><a href="literate-analysis-with-rmarkdown.html#rstudio-setup" id="toc-rstudio-setup"><span class="toc-section-number">3.1</span> RStudio Setup</a>
<ul>
<li><a href="literate-analysis-with-rmarkdown.html#learning-objectives-3" id="toc-learning-objectives-3"><span class="toc-section-number">3.1.1</span> Learning Objectives</a></li>
<li><a href="literate-analysis-with-rmarkdown.html#logging-into-the-rstudio-server" id="toc-logging-into-the-rstudio-server"><span class="toc-section-number">3.1.2</span> Logging into the RStudio server</a></li>
<li><a href="literate-analysis-with-rmarkdown.html#why-use-an-r-project" id="toc-why-use-an-r-project"><span class="toc-section-number">3.1.3</span> Why use an R project?</a></li>
<li><a href="literate-analysis-with-rmarkdown.html#understand-how-to-use-paths-and-working-directories" id="toc-understand-how-to-use-paths-and-working-directories"><span class="toc-section-number">3.1.4</span> Understand how to use paths and working directories</a></li>
<li><a href="literate-analysis-with-rmarkdown.html#organizing-your-project" id="toc-organizing-your-project"><span class="toc-section-number">3.1.5</span> Organizing your project</a></li>
<li><a href="literate-analysis-with-rmarkdown.html#summary-1" id="toc-summary-1"><span class="toc-section-number">3.1.6</span> Summary</a></li>
<li><a href="literate-analysis-with-rmarkdown.html#setting-up-git" id="toc-setting-up-git"><span class="toc-section-number">3.1.7</span> Setting up git</a></li>
<li><a href="literate-analysis-with-rmarkdown.html#github-authentication" id="toc-github-authentication"><span class="toc-section-number">3.1.8</span> GitHub Authentication</a></li>
<li><a href="literate-analysis-with-rmarkdown.html#setting-up-the-r-environment-on-your-local-computer" id="toc-setting-up-the-r-environment-on-your-local-computer"><span class="toc-section-number">3.1.9</span> Setting up the R environment on your local computer</a></li>
</ul></li>
<li><a href="literate-analysis-with-rmarkdown.html#literate-analysis-with-rmarkdown-1" id="toc-literate-analysis-with-rmarkdown-1"><span class="toc-section-number">3.2</span> Literate Analysis with RMarkdown</a>
<ul>
<li><a href="literate-analysis-with-rmarkdown.html#learning-objectives-4" id="toc-learning-objectives-4"><span class="toc-section-number">3.2.1</span> Learning Objectives</a></li>
<li><a href="literate-analysis-with-rmarkdown.html#introduction-and-motivation" id="toc-introduction-and-motivation"><span class="toc-section-number">3.2.2</span> Introduction and motivation</a></li>
<li><a href="literate-analysis-with-rmarkdown.html#basic-rmarkdown-syntax" id="toc-basic-rmarkdown-syntax"><span class="toc-section-number">3.2.3</span> Basic RMarkdown syntax</a></li>
<li><a href="literate-analysis-with-rmarkdown.html#code-chunks" id="toc-code-chunks"><span class="toc-section-number">3.2.4</span> Code chunks</a></li>
<li><a href="literate-analysis-with-rmarkdown.html#literate-analysis-practice" id="toc-literate-analysis-practice"><span class="toc-section-number">3.2.5</span> Literate analysis practice</a></li>
<li><a href="literate-analysis-with-rmarkdown.html#rmarkdown-and-environments" id="toc-rmarkdown-and-environments"><span class="toc-section-number">3.2.6</span> RMarkdown and environments</a></li>
<li><a href="literate-analysis-with-rmarkdown.html#go-further" id="toc-go-further"><span class="toc-section-number">3.2.7</span> Go Further</a></li>
<li><a href="literate-analysis-with-rmarkdown.html#resources" id="toc-resources"><span class="toc-section-number">3.2.8</span> Resources</a></li>
<li><a href="literate-analysis-with-rmarkdown.html#troubleshooting" id="toc-troubleshooting"><span class="toc-section-number">3.2.9</span> Troubleshooting</a></li>
</ul></li>
</ul></li>
<li><a href="version-control-with-git-and-github.html#version-control-with-git-and-github" id="toc-version-control-with-git-and-github"><span class="toc-section-number">4</span> Version Control with git and GitHub</a>
<ul>
<li><a href="version-control-with-git-and-github.html#learning-objectives-5" id="toc-learning-objectives-5"><span class="toc-section-number">4.1</span> Learning Objectives</a></li>
<li><a href="version-control-with-git-and-github.html#introduction-to-git" id="toc-introduction-to-git"><span class="toc-section-number">4.2</span> Introduction to <code>Git</code></a>
<ul>
<li><a href="version-control-with-git-and-github.html#a-motivating-example" id="toc-a-motivating-example"><span class="toc-section-number">4.2.1</span> A Motivating Example</a></li>
<li><a href="version-control-with-git-and-github.html#version-control-and-collaboration-using-git-and-github" id="toc-version-control-and-collaboration-using-git-and-github"><span class="toc-section-number">4.2.2</span> Version control and Collaboration using <code>Git</code> and GitHub</a></li>
<li><a href="version-control-with-git-and-github.html#lets-look-at-a-github-repository" id="toc-lets-look-at-a-github-repository"><span class="toc-section-number">4.2.3</span> Let’s look at a GitHub repository</a></li>
<li><a href="version-control-with-git-and-github.html#the-git-lifecycle" id="toc-the-git-lifecycle"><span class="toc-section-number">4.2.4</span> The <code>Git</code> Lifecycle</a></li>
</ul></li>
<li><a href="version-control-with-git-and-github.html#create-a-remote-repository-on-github" id="toc-create-a-remote-repository-on-github"><span class="toc-section-number">4.3</span> Create a remote repository on GitHub</a>
<ul>
<li><a href="version-control-with-git-and-github.html#setup-2" id="toc-setup-2">Setup</a></li>
<li><a href="version-control-with-git-and-github.html#section-6" id="toc-section-6"></a></li>
<li><a href="version-control-with-git-and-github.html#challenge-5" id="toc-challenge-5">Challenge</a></li>
<li><a href="version-control-with-git-and-github.html#section-7" id="toc-section-7"></a></li>
</ul></li>
<li><a href="version-control-with-git-and-github.html#working-locally-with-git-via-rstudio" id="toc-working-locally-with-git-via-rstudio"><span class="toc-section-number">4.4</span> Working locally with <code>Git</code> via RStudio</a>
<ul>
<li><a href="version-control-with-git-and-github.html#setup-3" id="toc-setup-3">Setup</a></li>
<li><a href="version-control-with-git-and-github.html#section-8" id="toc-section-8"></a></li>
<li><a href="version-control-with-git-and-github.html#challenge-6" id="toc-challenge-6">Challenge</a></li>
<li><a href="version-control-with-git-and-github.html#section-9" id="toc-section-9"></a></li>
<li><a href="version-control-with-git-and-github.html#aside-3" id="toc-aside-3">Aside</a></li>
<li><a href="version-control-with-git-and-github.html#collaboration-and-conflict-free-workflows" id="toc-collaboration-and-conflict-free-workflows">Collaboration and conflict free workflows</a></li>
</ul></li>
<li><a href="version-control-with-git-and-github.html#setting-up-git-on-an-existing-project" id="toc-setting-up-git-on-an-existing-project"><span class="toc-section-number">4.5</span> Setting up Git on an existing project</a>
<ul>
<li><a href="version-control-with-git-and-github.html#challenge-7" id="toc-challenge-7">Challenge</a></li>
<li><a href="version-control-with-git-and-github.html#section-10" id="toc-section-10"></a></li>
<li><a href="version-control-with-git-and-github.html#challenge-8" id="toc-challenge-8">Challenge</a></li>
<li><a href="version-control-with-git-and-github.html#section-11" id="toc-section-11"></a></li>
</ul></li>
<li><a href="version-control-with-git-and-github.html#go-further-with-git" id="toc-go-further-with-git"><span class="toc-section-number">4.6</span> Go Further with <code>Git</code></a></li>
<li><a href="version-control-with-git-and-github.html#additional-git-resources" id="toc-additional-git-resources"><span class="toc-section-number">4.7</span> Additional <code>Git</code> Resources</a></li>
</ul></li>
<li><a href="git-collaboration-and-conflict-management.html#git-collaboration-and-conflict-management" id="toc-git-collaboration-and-conflict-management"><span class="toc-section-number">5</span> git Collaboration and Conflict Management</a>
<ul>
<li><a href="git-collaboration-and-conflict-management.html#learning-objectives-6" id="toc-learning-objectives-6"><span class="toc-section-number">5.1</span> Learning Objectives</a></li>
<li><a href="git-collaboration-and-conflict-management.html#introduction" id="toc-introduction"><span class="toc-section-number">5.2</span> Introduction</a></li>
<li><a href="git-collaboration-and-conflict-management.html#collaborating-with-a-trusted-colleague-without-conflicts" id="toc-collaborating-with-a-trusted-colleague-without-conflicts"><span class="toc-section-number">5.3</span> Collaborating with a trusted colleague <strong>without conflicts</strong></a>
<ul>
<li><a href="git-collaboration-and-conflict-management.html#setup-4" id="toc-setup-4">Setup</a></li>
<li><a href="git-collaboration-and-conflict-management.html#section-12" id="toc-section-12"></a></li>
<li><a href="git-collaboration-and-conflict-management.html#step-1-collaborator-clone" id="toc-step-1-collaborator-clone"><span class="toc-section-number">5.3.1</span> Step 1: Collaborator clone</a></li>
<li><a href="git-collaboration-and-conflict-management.html#step-2-collaborator-edits" id="toc-step-2-collaborator-edits"><span class="toc-section-number">5.3.2</span> Step 2: Collaborator Edits</a></li>
<li><a href="git-collaboration-and-conflict-management.html#step-3-collaborator-commit-and-push" id="toc-step-3-collaborator-commit-and-push"><span class="toc-section-number">5.3.3</span> Step 3: Collaborator commit and push</a></li>
<li><a href="git-collaboration-and-conflict-management.html#step-4-owner-pull" id="toc-step-4-owner-pull"><span class="toc-section-number">5.3.4</span> Step 4: Owner pull</a></li>
<li><a href="git-collaboration-and-conflict-management.html#step-5-owner-edits-commit-and-push" id="toc-step-5-owner-edits-commit-and-push"><span class="toc-section-number">5.3.5</span> Step 5: Owner edits, commit, and push</a></li>
<li><a href="git-collaboration-and-conflict-management.html#step-6-collaborator-pull" id="toc-step-6-collaborator-pull"><span class="toc-section-number">5.3.6</span> Step 6: Collaborator pull</a></li>
<li><a href="git-collaboration-and-conflict-management.html#challenge-9" id="toc-challenge-9">Challenge</a></li>
<li><a href="git-collaboration-and-conflict-management.html#section-13" id="toc-section-13"></a></li>
</ul></li>
<li><a href="git-collaboration-and-conflict-management.html#merge-conflicts" id="toc-merge-conflicts"><span class="toc-section-number">5.4</span> Merge conflicts</a></li>
<li><a href="git-collaboration-and-conflict-management.html#how-to-resolve-a-conflict" id="toc-how-to-resolve-a-conflict"><span class="toc-section-number">5.5</span> How to resolve a conflict</a>
<ul>
<li><a href="git-collaboration-and-conflict-management.html#abort-abort-abort" id="toc-abort-abort-abort">Abort, abort, abort…</a></li>
<li><a href="git-collaboration-and-conflict-management.html#checkout" id="toc-checkout">Checkout</a></li>
<li><a href="git-collaboration-and-conflict-management.html#pull-and-edit-the-file" id="toc-pull-and-edit-the-file">Pull and edit the file</a></li>
<li><a href="git-collaboration-and-conflict-management.html#producing-and-resolving-merge-conflicts" id="toc-producing-and-resolving-merge-conflicts"><span class="toc-section-number">5.5.1</span> Producing and resolving merge conflicts</a></li>
<li><a href="git-collaboration-and-conflict-management.html#merge-conflict-challenge" id="toc-merge-conflict-challenge">Merge Conflict Challenge</a></li>
<li><a href="git-collaboration-and-conflict-management.html#section-14" id="toc-section-14"></a></li>
</ul></li>
<li><a href="git-collaboration-and-conflict-management.html#workflows-to-avoid-merge-conflicts" id="toc-workflows-to-avoid-merge-conflicts"><span class="toc-section-number">5.6</span> Workflows to avoid merge conflicts</a></li>
</ul></li>
<li><a href="social-aspects-of-collaboration.html#social-aspects-of-collaboration" id="toc-social-aspects-of-collaboration"><span class="toc-section-number">6</span> Social Aspects of Collaboration</a>
<ul>
<li><a href="social-aspects-of-collaboration.html#thinking-preferences" id="toc-thinking-preferences"><span class="toc-section-number">6.1</span> Thinking preferences</a>
<ul>
<li><a href="social-aspects-of-collaboration.html#learning-objectives-7" id="toc-learning-objectives-7"><span class="toc-section-number">6.1.1</span> Learning Objectives</a></li>
<li><a href="social-aspects-of-collaboration.html#thinking-preferences-activity" id="toc-thinking-preferences-activity"><span class="toc-section-number">6.1.2</span> Thinking Preferences Activity</a></li>
<li><a href="social-aspects-of-collaboration.html#about-the-whole-brain-thinking-system" id="toc-about-the-whole-brain-thinking-system"><span class="toc-section-number">6.1.3</span> About the Whole Brain Thinking System</a></li>
</ul></li>
<li><a href="social-aspects-of-collaboration.html#developing-a-code-of-conduct" id="toc-developing-a-code-of-conduct"><span class="toc-section-number">6.2</span> Developing a Code of Conduct</a></li>
<li><a href="social-aspects-of-collaboration.html#authorship-and-credit-policies" id="toc-authorship-and-credit-policies"><span class="toc-section-number">6.3</span> Authorship and Credit Policies</a></li>
<li><a href="social-aspects-of-collaboration.html#data-sharing-and-reuse-policies" id="toc-data-sharing-and-reuse-policies"><span class="toc-section-number">6.4</span> Data Sharing and Reuse Policies</a>
<ul>
<li><a href="social-aspects-of-collaboration.html#community-principles-care-and-fair" id="toc-community-principles-care-and-fair"><span class="toc-section-number">6.4.1</span> Community Principles: CARE and FAIR</a></li>
</ul></li>
<li><a href="social-aspects-of-collaboration.html#research-data-publishing-ethics" id="toc-research-data-publishing-ethics"><span class="toc-section-number">6.5</span> Research Data Publishing Ethics</a>
<ul>
<li><a href="social-aspects-of-collaboration.html#discussion-data-publishing-policies" id="toc-discussion-data-publishing-policies">Discussion: Data publishing policies</a></li>
<li><a href="social-aspects-of-collaboration.html#section-16" id="toc-section-16"></a></li>
</ul></li>
<li><a href="social-aspects-of-collaboration.html#extra-reading" id="toc-extra-reading"><span class="toc-section-number">6.6</span> Extra Reading</a></li>
</ul></li>
<li><a href="data-modeling-essentials.html#data-modeling-essentials" id="toc-data-modeling-essentials"><span class="toc-section-number">7</span> Data Modeling Essentials</a>
<ul>
<li><a href="data-modeling-essentials.html#data-modeling-tidy-data" id="toc-data-modeling-tidy-data"><span class="toc-section-number">7.1</span> Data Modeling &amp; Tidy Data</a>
<ul>
<li><a href="data-modeling-essentials.html#learning-objectives-8" id="toc-learning-objectives-8"><span class="toc-section-number">7.1.1</span> Learning Objectives</a></li>
<li><a href="data-modeling-essentials.html#introduction-1" id="toc-introduction-1"><span class="toc-section-number">7.1.2</span> Introduction</a></li>
<li><a href="data-modeling-essentials.html#recognizing-untidy-data" id="toc-recognizing-untidy-data"><span class="toc-section-number">7.1.3</span> Recognizing untidy data</a></li>
<li><a href="data-modeling-essentials.html#good-enough-data-modeling" id="toc-good-enough-data-modeling"><span class="toc-section-number">7.1.4</span> Good enough data modeling</a></li>
<li><a href="data-modeling-essentials.html#using-normalized-data" id="toc-using-normalized-data"><span class="toc-section-number">7.1.5</span> Using normalized data</a></li>
<li><a href="data-modeling-essentials.html#data-modeling-exercise" id="toc-data-modeling-exercise"><span class="toc-section-number">7.1.6</span> Data modeling exercise</a></li>
<li><a href="data-modeling-essentials.html#resources-1" id="toc-resources-1"><span class="toc-section-number">7.1.7</span> Resources</a></li>
</ul></li>
</ul></li>
<li><a href="cleaning-and-manipulating-data.html#cleaning-and-manipulating-data" id="toc-cleaning-and-manipulating-data"><span class="toc-section-number">8</span> Cleaning and Manipulating Data</a>
<ul>
<li><a href="cleaning-and-manipulating-data.html#data-cleaning-and-manipulation" id="toc-data-cleaning-and-manipulation"><span class="toc-section-number">8.1</span> Data Cleaning and Manipulation</a>
<ul>
<li><a href="cleaning-and-manipulating-data.html#learning-objectives-9" id="toc-learning-objectives-9"><span class="toc-section-number">8.1.1</span> Learning Objectives</a></li>
<li><a href="cleaning-and-manipulating-data.html#introduction-2" id="toc-introduction-2"><span class="toc-section-number">8.1.2</span> Introduction</a></li>
<li><a href="cleaning-and-manipulating-data.html#data-cleaning-basics" id="toc-data-cleaning-basics"><span class="toc-section-number">8.1.3</span> Data Cleaning Basics</a></li>
<li><a href="cleaning-and-manipulating-data.html#joins-in-dplyr" id="toc-joins-in-dplyr"><span class="toc-section-number">8.1.4</span> Joins in dplyr</a></li>
</ul></li>
</ul></li>
<li><a href="data-visualization-and-publishing-to-the-web.html#data-visualization-and-publishing-to-the-web" id="toc-data-visualization-and-publishing-to-the-web"><span class="toc-section-number">9</span> Data Visualization and Publishing to the Web</a>
<ul>
<li><a href="data-visualization-and-publishing-to-the-web.html#publishing-analyses-to-the-web" id="toc-publishing-analyses-to-the-web"><span class="toc-section-number">9.1</span> Publishing Analyses to the Web</a>
<ul>
<li><a href="data-visualization-and-publishing-to-the-web.html#learning-objectives-10" id="toc-learning-objectives-10"><span class="toc-section-number">9.1.1</span> Learning Objectives</a></li>
<li><a href="data-visualization-and-publishing-to-the-web.html#introduction-3" id="toc-introduction-3"><span class="toc-section-number">9.1.2</span> Introduction</a></li>
<li><a href="data-visualization-and-publishing-to-the-web.html#a-minimal-example" id="toc-a-minimal-example"><span class="toc-section-number">9.1.3</span> A Minimal Example</a></li>
<li><a href="data-visualization-and-publishing-to-the-web.html#exercise-sharing-your-work" id="toc-exercise-sharing-your-work"><span class="toc-section-number">9.1.4</span> Exercise: Sharing your work</a></li>
</ul></li>
<li><a href="data-visualization-and-publishing-to-the-web.html#publication-graphics" id="toc-publication-graphics"><span class="toc-section-number">9.2</span> Publication Graphics</a>
<ul>
<li><a href="data-visualization-and-publishing-to-the-web.html#learning-objectives-11" id="toc-learning-objectives-11"><span class="toc-section-number">9.2.1</span> Learning Objectives</a></li>
<li><a href="data-visualization-and-publishing-to-the-web.html#overview-1" id="toc-overview-1"><span class="toc-section-number">9.2.2</span> Overview</a></li>
<li><a href="data-visualization-and-publishing-to-the-web.html#static-figures-using-ggplot2" id="toc-static-figures-using-ggplot2"><span class="toc-section-number">9.2.3</span> Static figures using <code>ggplot2</code></a></li>
<li><a href="data-visualization-and-publishing-to-the-web.html#interactive-visualization-using-leaflet-and-dt" id="toc-interactive-visualization-using-leaflet-and-dt"><span class="toc-section-number">9.2.4</span> Interactive visualization using <code>leaflet</code> and <code>DT</code></a></li>
<li><a href="data-visualization-and-publishing-to-the-web.html#resources-2" id="toc-resources-2"><span class="toc-section-number">9.2.5</span> Resources</a></li>
</ul></li>
</ul></li>
<li><a href="functions-and-packages.html#functions-and-packages" id="toc-functions-and-packages"><span class="toc-section-number">10</span> Functions and Packages</a>
<ul>
<li><a href="functions-and-packages.html#creating-r-functions" id="toc-creating-r-functions"><span class="toc-section-number">10.1</span> Creating R Functions</a>
<ul>
<li><a href="functions-and-packages.html#why-functions" id="toc-why-functions"><span class="toc-section-number">10.1.1</span> Why functions?</a></li>
<li><a href="functions-and-packages.html#documenting-r-functions" id="toc-documenting-r-functions"><span class="toc-section-number">10.1.2</span> Documenting R functions</a></li>
<li><a href="functions-and-packages.html#summary-4" id="toc-summary-4"><span class="toc-section-number">10.1.3</span> Summary</a></li>
<li><a href="functions-and-packages.html#examples-minimizing-work-with-functions" id="toc-examples-minimizing-work-with-functions"><span class="toc-section-number">10.1.4</span> Examples: Minimizing work with functions</a></li>
</ul></li>
<li><a href="functions-and-packages.html#creating-r-packages" id="toc-creating-r-packages"><span class="toc-section-number">10.2</span> Creating R Packages</a>
<ul>
<li><a href="functions-and-packages.html#learning-objectives-12" id="toc-learning-objectives-12"><span class="toc-section-number">10.2.1</span> Learning Objectives</a></li>
<li><a href="functions-and-packages.html#why-packages" id="toc-why-packages"><span class="toc-section-number">10.2.2</span> Why packages?</a></li>
<li><a href="functions-and-packages.html#install-and-load-packages" id="toc-install-and-load-packages"><span class="toc-section-number">10.2.3</span> Install and load packages</a></li>
<li><a href="functions-and-packages.html#create-a-basic-package" id="toc-create-a-basic-package"><span class="toc-section-number">10.2.4</span> Create a basic package</a></li>
<li><a href="functions-and-packages.html#add-your-code" id="toc-add-your-code"><span class="toc-section-number">10.2.5</span> Add your code</a></li>
<li><a href="functions-and-packages.html#add-documentation" id="toc-add-documentation"><span class="toc-section-number">10.2.6</span> Add documentation</a></li>
<li><a href="functions-and-packages.html#test-your-package" id="toc-test-your-package"><span class="toc-section-number">10.2.7</span> Test your package</a></li>
<li><a href="functions-and-packages.html#checking-and-installing-your-package" id="toc-checking-and-installing-your-package"><span class="toc-section-number">10.2.8</span> Checking and installing your package</a></li>
<li><a href="functions-and-packages.html#sharing-and-releasing-your-package" id="toc-sharing-and-releasing-your-package"><span class="toc-section-number">10.2.9</span> Sharing and releasing your package</a></li>
<li><a href="functions-and-packages.html#more-reading" id="toc-more-reading"><span class="toc-section-number">10.2.10</span> More reading</a></li>
</ul></li>
</ul></li>
<li><a href="data-portals.html#data-portals" id="toc-data-portals"><span class="toc-section-number">11</span> Data Portals</a>
<ul>
<li><a href="data-portals.html#what-is-a-portal" id="toc-what-is-a-portal"><span class="toc-section-number">11.1</span> What is a Portal?</a></li>
<li><a href="data-portals.html#portal-uses" id="toc-portal-uses"><span class="toc-section-number">11.2</span> Portal Uses</a></li>
<li><a href="data-portals.html#portal-features" id="toc-portal-features"><span class="toc-section-number">11.3</span> Portal Features</a>
<ul>
<li><a href="data-portals.html#flexible-content-creation" id="toc-flexible-content-creation">Flexible Content Creation</a></li>
<li><a href="data-portals.html#curated-collections-of-data" id="toc-curated-collections-of-data">Curated Collections of Data</a></li>
<li><a href="data-portals.html#customized-search-capabilities" id="toc-customized-search-capabilities">Customized Search Capabilities</a></li>
<li><a href="data-portals.html#metrics-metrics-metrics" id="toc-metrics-metrics-metrics">Metrics, Metrics, Metrics</a></li>
</ul></li>
<li><a href="data-portals.html#enhancing-access-to-social-science-research-data" id="toc-enhancing-access-to-social-science-research-data"><span class="toc-section-number">11.4</span> Enhancing Access to Social Science Research Data</a></li>
<li><a href="data-portals.html#relationship-between-arctic-data-center-portals-and-dataone" id="toc-relationship-between-arctic-data-center-portals-and-dataone"><span class="toc-section-number">11.5</span> Relationship between Arctic Data Center portals and DataONE</a></li>
<li><a href="data-portals.html#creating-portals" id="toc-creating-portals"><span class="toc-section-number">11.6</span> Creating Portals</a>
<ul>
<li><a href="data-portals.html#getting-started-with-portals" id="toc-getting-started-with-portals">Getting Started with Portals</a></li>
<li><a href="data-portals.html#portal-settings-page" id="toc-portal-settings-page">Portal Settings Page</a></li>
<li><a href="data-portals.html#adding-data-to-portals" id="toc-adding-data-to-portals">Adding Data to Portals</a></li>
<li><a href="data-portals.html#building-search-options-for-your-audience" id="toc-building-search-options-for-your-audience">Building Search Options for Your Audience</a></li>
<li><a href="data-portals.html#data-package-metrics" id="toc-data-package-metrics">Data Package Metrics</a></li>
<li><a href="data-portals.html#creating-unique-freeform-pages" id="toc-creating-unique-freeform-pages">Creating Unique Freeform Pages</a></li>
<li><a href="data-portals.html#saving-and-editing-portals" id="toc-saving-and-editing-portals">Saving and Editing Portals</a></li>
</ul></li>
<li><a href="data-portals.html#how-to-publish-portals" id="toc-how-to-publish-portals"><span class="toc-section-number">11.7</span> How to Publish Portals</a></li>
<li><a href="data-portals.html#sharing-portals" id="toc-sharing-portals"><span class="toc-section-number">11.8</span> Sharing Portals</a></li>
<li><a href="data-portals.html#tutorial-videos" id="toc-tutorial-videos"><span class="toc-section-number">11.9</span> Tutorial Videos</a></li>
<li><a href="data-portals.html#acknowledgements" id="toc-acknowledgements"><span class="toc-section-number">11.10</span> Acknowledgements</a></li>
</ul></li>
<li><a href="exercise-cleaning-and-manipulating-data.html#exercise-cleaning-and-manipulating-data" id="toc-exercise-cleaning-and-manipulating-data"><span class="toc-section-number">12</span> Exercise: Cleaning and Manipulating Data</a>
<ul>
<li><a href="exercise-cleaning-and-manipulating-data.html#hands-on-clean-and-integrate-datasets" id="toc-hands-on-clean-and-integrate-datasets"><span class="toc-section-number">12.1</span> Hands On: Clean and Integrate Datasets</a>
<ul>
<li><a href="exercise-cleaning-and-manipulating-data.html#learning-objectives-13" id="toc-learning-objectives-13"><span class="toc-section-number">12.1.1</span> Learning Objectives</a></li>
<li><a href="exercise-cleaning-and-manipulating-data.html#outline" id="toc-outline"><span class="toc-section-number">12.1.2</span> Outline</a></li>
<li><a href="exercise-cleaning-and-manipulating-data.html#full-solution.-warning-spoilers-ahead" id="toc-full-solution.-warning-spoilers-ahead"><span class="toc-section-number">12.1.3</span> Full solution. Warning, spoilers ahead!</a></li>
</ul></li>
</ul></li>
<li><a href="geospatial-vector-analysis.html#geospatial-vector-analysis" id="toc-geospatial-vector-analysis"><span class="toc-section-number">13</span> Geospatial Vector Analysis</a>
<ul>
<li><a href="geospatial-vector-analysis.html#spatial-vector-analysis-using-sf" id="toc-spatial-vector-analysis-using-sf"><span class="toc-section-number">13.1</span> Spatial vector analysis using <code>sf</code></a>
<ul>
<li><a href="geospatial-vector-analysis.html#learning-objectives-14" id="toc-learning-objectives-14"><span class="toc-section-number">13.1.1</span> Learning Objectives</a></li>
<li><a href="geospatial-vector-analysis.html#introduction-4" id="toc-introduction-4"><span class="toc-section-number">13.1.2</span> Introduction</a></li>
<li><a href="geospatial-vector-analysis.html#working-with-geospatial-data" id="toc-working-with-geospatial-data"><span class="toc-section-number">13.1.3</span> Working with geospatial data</a></li>
<li><a href="geospatial-vector-analysis.html#sf-the-tidyverse" id="toc-sf-the-tidyverse"><span class="toc-section-number">13.1.4</span> <code>sf</code> &amp; the Tidyverse</a></li>
<li><a href="geospatial-vector-analysis.html#visualize-with-ggplot" id="toc-visualize-with-ggplot"><span class="toc-section-number">13.1.5</span> Visualize with ggplot</a></li>
<li><a href="geospatial-vector-analysis.html#visualize-sf-objects-with-leaflet" id="toc-visualize-sf-objects-with-leaflet"><span class="toc-section-number">13.1.6</span> Visualize <code>sf</code> objects with leaflet</a></li>
</ul></li>
</ul></li>
<li><a href="reproducibility-and-provenance.html#reproducibility-and-provenance" id="toc-reproducibility-and-provenance"><span class="toc-section-number">14</span> Reproducibility and Provenance</a>
<ul>
<li><a href="reproducibility-and-provenance.html#learning-objectives-15" id="toc-learning-objectives-15"><span class="toc-section-number">14.0.1</span> Learning Objectives</a></li>
<li><a href="reproducibility-and-provenance.html#data-citation-and-transitive-credit" id="toc-data-citation-and-transitive-credit"><span class="toc-section-number">14.0.2</span> Data Citation and Transitive Credit</a></li>
<li><a href="reproducibility-and-provenance.html#reproducible-papers-with-rrtools" id="toc-reproducible-papers-with-rrtools"><span class="toc-section-number">14.0.3</span> Reproducible Papers with <code>rrtools</code></a></li>
<li><a href="reproducibility-and-provenance.html#the-5th-generation-of-reproducible-papers" id="toc-the-5th-generation-of-reproducible-papers">The 5th Generation of Reproducible Papers</a></li>
</ul></li>
<li><a href="appendix.html#appendix" id="toc-appendix"><span class="toc-section-number">15</span> Appendix</a>
<ul>
<li><a href="appendix.html#collaborating-using-git" id="toc-collaborating-using-git"><span class="toc-section-number">15.1</span> Collaborating using Git</a>
<ul>
<li><a href="appendix.html#learning-objectives-16" id="toc-learning-objectives-16"><span class="toc-section-number">15.1.1</span> Learning Objectives</a></li>
<li><a href="appendix.html#pull-requests" id="toc-pull-requests"><span class="toc-section-number">15.1.2</span> Pull requests</a></li>
<li><a href="appendix.html#exercise-create-and-merge-pull-requests" id="toc-exercise-create-and-merge-pull-requests"><span class="toc-section-number">15.1.3</span> Exercise: Create and merge pull requests</a></li>
<li><a href="appendix.html#branches" id="toc-branches"><span class="toc-section-number">15.1.4</span> Branches</a></li>
</ul></li>
<li><a href="appendix.html#programming-metadata-and-data-publishing" id="toc-programming-metadata-and-data-publishing"><span class="toc-section-number">15.2</span> Programming Metadata and Data Publishing</a>
<ul>
<li><a href="appendix.html#learning-objectives-17" id="toc-learning-objectives-17"><span class="toc-section-number">15.2.1</span> Learning Objectives</a></li>
<li><a href="appendix.html#creating-metadata" id="toc-creating-metadata"><span class="toc-section-number">15.2.2</span> Creating Metadata</a></li>
<li><a href="appendix.html#publish-data-to-the-arctic-data-center-test-site" id="toc-publish-data-to-the-arctic-data-center-test-site"><span class="toc-section-number">15.2.3</span> Publish data to the Arctic Data Center test site</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Practices for Arctic Research Using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cleaning-and-manipulating-data" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">8</span> Cleaning and Manipulating Data<a href="cleaning-and-manipulating-data.html#cleaning-and-manipulating-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="data-cleaning-and-manipulation" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Data Cleaning and Manipulation<a href="cleaning-and-manipulating-data.html#data-cleaning-and-manipulation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="learning-objectives-9" class="section level3 hasAnchor" number="8.1.1">
<h3><span class="header-section-number">8.1.1</span> Learning Objectives<a href="cleaning-and-manipulating-data.html#learning-objectives-9" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this lesson, you will learn:</p>
<ul>
<li>What the Split-Apply-Combine strategy is and how it applies to data</li>
<li>The difference between wide vs. tall table formats and how to convert between them</li>
<li>How to use <code>dplyr</code> and <code>tidyr</code> to clean and manipulate data for analysis</li>
<li>How to join multiple <code>data.frame</code>s together using <code>dplyr</code></li>
</ul>
</div>
<div id="introduction-2" class="section level3 hasAnchor" number="8.1.2">
<h3><span class="header-section-number">8.1.2</span> Introduction<a href="cleaning-and-manipulating-data.html#introduction-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The data we get to work with are rarely, if ever, in the format we need to do our analyses. It’s often the case that one package requires data in one format, while another package requires the data to be in another format. To be efficient analysts, we should have good tools for reformatting data for our needs so we can do our actual work like making plots and fitting models. The <code>dplyr</code> and <code>tidyr</code> R packages provide a fairly complete and extremely powerful set of functions for us to do this reformatting quickly and learning these tools well will greatly increase your efficiency as an analyst.</p>
<p>Analyses take many shapes, but they often conform to what is known as the Split-Apply-Combine strategy. This strategy follows a usual set of steps:</p>
<ul>
<li><strong>Split</strong>: Split the data into logical groups (e.g., area, stock, year)</li>
<li><strong>Apply:</strong> Calculate some summary statistic on each group (e.g. mean total length by year)</li>
<li><strong>Combine:</strong> Combine the groups back together into a single table</li>
</ul>
<div class="figure">
<img src="images/split-apply-combine-diagram.png" alt="" />
<p class="caption">Figure 1: diagram of the split apply combine strategy</p>
</div>
<p>As shown above (Figure 1), our original table is split into groups by <code>year</code>, we calculate the mean length for each group, and finally combine the per-year means into a single table.</p>
<p><code>dplyr</code> provides a fast and powerful way to express this. Let’s look at a simple example of how this is done:</p>
<p>Assuming our length data is already loaded in a <code>data.frame</code> called <code>length_data</code>:</p>
<table>
<thead>
<tr class="header">
<th align="right">year</th>
<th align="right">length_cm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1991</td>
<td align="right">5.673318</td>
</tr>
<tr class="even">
<td align="right">1991</td>
<td align="right">3.081224</td>
</tr>
<tr class="odd">
<td align="right">1991</td>
<td align="right">4.592696</td>
</tr>
<tr class="even">
<td align="right">1992</td>
<td align="right">4.381523</td>
</tr>
<tr class="odd">
<td align="right">1992</td>
<td align="right">5.597777</td>
</tr>
<tr class="even">
<td align="right">1992</td>
<td align="right">4.900052</td>
</tr>
<tr class="odd">
<td align="right">1992</td>
<td align="right">4.139282</td>
</tr>
<tr class="even">
<td align="right">1992</td>
<td align="right">5.422823</td>
</tr>
<tr class="odd">
<td align="right">1992</td>
<td align="right">5.905247</td>
</tr>
<tr class="even">
<td align="right">1992</td>
<td align="right">5.098922</td>
</tr>
</tbody>
</table>
<p>We can do this calculation using <code>dplyr</code> like this:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="cleaning-and-manipulating-data.html#cb31-1" aria-hidden="true" tabindex="-1"></a>length_data <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="cleaning-and-manipulating-data.html#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="cleaning-and-manipulating-data.html#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_length_cm =</span> <span class="fu">mean</span>(length_cm))</span></code></pre></div>
<p>Another exceedingly common thing we need to do is “reshape” our data. Let’s look at an example table that is in what we will call “wide” format:</p>
<table>
<thead>
<tr class="header">
<th>site</th>
<th>1990</th>
<th>1991</th>
<th>…</th>
<th>1993</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>gold</td>
<td>100</td>
<td>118</td>
<td>…</td>
<td>112</td>
</tr>
<tr class="even">
<td>lake</td>
<td>100</td>
<td>118</td>
<td>…</td>
<td>112</td>
</tr>
<tr class="odd">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="even">
<td>dredge</td>
<td>100</td>
<td>118</td>
<td>…</td>
<td>112</td>
</tr>
</tbody>
</table>
<p>You are probably quite familiar with data in the above format, where values of the variable being observed are spread out across columns (Here: columns for each year). Another way of describing this is that there is more than one measurement per row. This wide format works well for data entry and sometimes works well for analysis but we quickly outgrow it when using R. For example, how would you fit a model with year as a predictor variable? In an ideal world, we’d be able to just run:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="cleaning-and-manipulating-data.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(length <span class="sc">~</span> year)</span></code></pre></div>
<p>But this won’t work on our wide data because <code>lm</code> needs <code>length</code> and <code>year</code> to be columns in our table.</p>
<p>Or how would we make a separate plot for each year? We could call <code>plot</code> one time for each year but this is tedious if we have many years of data and hard to maintain as we add more years of data to our dataset.</p>
<p>The <code>tidyr</code> package allows us to quickly switch between wide format and what is called tall format using the <code>pivot_longer</code> function:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="cleaning-and-manipulating-data.html#cb33-1" aria-hidden="true" tabindex="-1"></a>site_data <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="cleaning-and-manipulating-data.html#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>site, <span class="at">names_to =</span> <span class="st">&quot;year&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;length&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th>site</th>
<th>year</th>
<th align="right">length</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>gold</td>
<td>1990</td>
<td align="right">101</td>
</tr>
<tr class="even">
<td>lake</td>
<td>1990</td>
<td align="right">104</td>
</tr>
<tr class="odd">
<td>dredge</td>
<td>1990</td>
<td align="right">144</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td align="right">…</td>
</tr>
<tr class="odd">
<td>dredge</td>
<td>1993</td>
<td align="right">145</td>
</tr>
</tbody>
</table>
<p>In this lesson we’re going to walk through the functions you’ll most commonly use from the <code>dplyr</code> and <code>tidyr</code> packages:</p>
<ul>
<li><p><code>dplyr</code></p>
<ul>
<li><code>mutate()</code></li>
<li><code>group_by()</code></li>
<li><code>summarise()</code></li>
<li><code>select()</code></li>
<li><code>filter()</code></li>
<li><code>arrange()</code></li>
<li><code>left_join()</code></li>
<li><code>rename()</code></li>
</ul></li>
<li><p><code>tidyr</code></p>
<ul>
<li><code>pivot_longer()</code></li>
<li><code>pivot_wider()</code></li>
<li><code>unite()</code></li>
<li><code>separate()</code></li>
</ul></li>
</ul>
</div>
<div id="data-cleaning-basics" class="section level3 hasAnchor" number="8.1.3">
<h3><span class="header-section-number">8.1.3</span> Data Cleaning Basics<a href="cleaning-and-manipulating-data.html#data-cleaning-basics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To demonstrate, we’ll be working with a tidied up version of a dataset from ADF&amp;G containing commercial catch data from 1878-1997. The dataset and reference to the original source can be found at its public archive: <a href="https://knb.ecoinformatics.org/#view/df35b.304.2" class="uri">https://knb.ecoinformatics.org/#view/df35b.304.2</a>.</p>
<p>First, open a new RMarkdown document. Delete everything below the setup chunk, and add a library chunk that calls <code>dplyr</code>, <code>tidyr</code>, and <code>readr</code>:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="cleaning-and-manipulating-data.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb34-2"><a href="cleaning-and-manipulating-data.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb34-3"><a href="cleaning-and-manipulating-data.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span></code></pre></div>
<div id="aside-4" class="section level4 unnumbered aside hasAnchor">
<h4>Aside<a href="cleaning-and-manipulating-data.html#aside-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>A note on loading packages.</strong></p>
<p>You may have noticed the following warning messages pop up when you ran your library chunk.</p>
<pre><code>Attaching package: ‘dplyr’

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union</code></pre>
<p>These are important warnings. They are letting you know that certain functions from the <code>stats</code> and <code>base</code> packages (which are loaded by default when you start R) are masked by <em>different functions</em> with the same name in the <code>dplyr</code> package. It turns out, the order that you load the packages in matters. Since we loaded <code>dplyr</code> after <code>stats</code>, R will assume that if you call <code>filter</code>, you mean the <code>dplyr</code> version unless you specify otherwise.</p>
<p>Being specific about which version of <code>filter</code>, for example, you call is easy. To explicitly call a function by its unambiguous name, you use the syntax <code>package_name::function_name(...)</code>. So, if I wanted to call the <code>stats</code> version of <code>filter</code> in this Rmarkdown document, I would use the syntax <code>stats::filter(...)</code>.</p>
</div>
<div id="section-19" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
</div>
<div id="challenge-13" class="section level4 unnumbered exercise hasAnchor">
<h4>Challenge<a href="cleaning-and-manipulating-data.html#challenge-13" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The warnings above are important, but we might not want them in our final document. After you have read them, adjust the chunk settings on your library chunk to suppress warnings and messages.</p>
</div>
<div id="section-20" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<p>Now that we have learned a little mini-lesson on functions, let’s get the data that we are going to use for this lesson.</p>
</div>
<div id="setup-5" class="section level4 unnumbered setup hasAnchor">
<h4>Setup<a href="cleaning-and-manipulating-data.html#setup-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li><p>Navigate to the salmon catch dataset: <a href="https://knb.ecoinformatics.org/#view/df35b.304.2" class="uri">https://knb.ecoinformatics.org/#view/df35b.304.2</a></p></li>
<li><p>Right click the “download” button for the file “byerlySalmonByRegion.csv”</p></li>
<li><p>Select “copy link address” from the dropdown menu</p></li>
<li><p>Paste the URL into a <code>read.csv</code> call like below</p></li>
</ol>
</div>
<div id="section-21" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<p>The code chunk you use to read in the data should look something like this:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="cleaning-and-manipulating-data.html#cb36-1" aria-hidden="true" tabindex="-1"></a>catch_original <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://knb.ecoinformatics.org/knb/d1/mn/v2/object/df35b.302.1&quot;</span>)</span></code></pre></div>
</div>
<div id="aside-5" class="section level4 unnumbered aside hasAnchor">
<h4>Aside<a href="cleaning-and-manipulating-data.html#aside-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Note that windows users who want to use this method locally also need to use the <code>url</code> function here with the argument <code>method = "libcurl"</code> as below:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="cleaning-and-manipulating-data.html#cb37-1" aria-hidden="true" tabindex="-1"></a>catch_original <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">url</span>(<span class="st">&quot;https://knb.ecoinformatics.org/knb/d1/mn/v2/object/df35b.302.1&quot;</span>, <span class="at">method =</span> <span class="st">&quot;libcurl&quot;</span>))</span></code></pre></div>
</div>
<div id="section-22" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<p>This dataset is relatively clean and easy to interpret as-is. But while it may be clean, it’s in a shape that makes it hard to use for some types of analyses so we’ll want to fix that first.</p>
</div>
<div id="challenge-14" class="section level4 unnumbered exercise hasAnchor">
<h4>Challenge<a href="cleaning-and-manipulating-data.html#challenge-14" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Before we get too much further, spend a minute or two outlining your RMarkdown document so that it includes the following sections and steps:</p>
<ul>
<li>Data Sources
<ul>
<li>read in the data</li>
</ul></li>
<li>Clean and Reshape data
<ul>
<li>remove unnecessary columns</li>
<li>check column typing</li>
<li>reshape data</li>
</ul></li>
<li>Join to Regions dataset</li>
</ul>
</div>
<div id="about-the-pipe-operator" class="section level4 unnumbered hasAnchor">
<h4>About the pipe (<code>%&gt;%</code>) operator<a href="cleaning-and-manipulating-data.html#about-the-pipe-operator" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Before we jump into learning <code>tidyr</code> and <code>dplyr</code>, we first need to explain the <code>%&gt;%</code>.</p>
<p>Both the <code>tidyr</code> and the <code>dplyr</code> packages use the pipe operator - <code>%&gt;%</code>, which may look unfamiliar. The pipe is a powerful way to efficiently chain together operations. The pipe will take the output of a previous statement, and use it as the input to the next statement.</p>
<p>Say you want to both <code>filter</code> out rows of a dataset, and <code>select</code> certain columns. Instead of writing</p>
<pre><code>df_filtered &lt;- filter(df, ...)
df_selected &lt;- select(df_filtered, ...)</code></pre>
<p>You can write</p>
<pre><code>df_cleaned &lt;- df %&gt;% 
              filter(...) %&gt;%
              select(...)</code></pre>
<p>If you think of the assignment operator (<code>&lt;-</code>) as reading like “gets”, then the pipe operator would read like “then.”</p>
<p>So you might think of the above chunk being translated as:</p>
<p>The cleaned dataframe gets the original data, and then a filter (of the original data), and then a select (of the filtered data).</p>
<p>The benefits to using pipes are that you don’t have to keep track of (or overwrite) intermediate data frames. The drawbacks are that it can be more difficult to explain the reasoning behind each step, especially when many operations are chained together. It is good to strike a balance between writing efficient code (chaining operations), while ensuring that you are still clearly explaining, both to your future self and others, what you are doing and why you are doing it.</p>
<p>RStudio has a keyboard shortcut for <code>%&gt;%</code> : Ctrl + Shift + M (Windows), Cmd + Shift + M (Mac).</p>
</div>
<div id="selectingremoving-columns-select" class="section level4 unnumbered hasAnchor">
<h4>Selecting/removing columns: <code>select()</code><a href="cleaning-and-manipulating-data.html#selectingremoving-columns-select" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The first issue is the extra columns <code>All</code> and <code>notesRegCode</code>. Let’s select only the columns we want, and assign this to a variable called <code>catch_data</code>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="cleaning-and-manipulating-data.html#cb40-1" aria-hidden="true" tabindex="-1"></a>catch_data <span class="ot">&lt;-</span> catch_original <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="cleaning-and-manipulating-data.html#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Region, Year, Chinook, Sockeye, Coho, Pink, Chum)</span>
<span id="cb40-3"><a href="cleaning-and-manipulating-data.html#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="cleaning-and-manipulating-data.html#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(catch_data)</span></code></pre></div>
<pre><code>##   Region Year Chinook Sockeye Coho Pink Chum
## 1    SSE 1886       0       5    0    0    0
## 2    SSE 1887       0     155    0    0    0
## 3    SSE 1888       0     224   16    0    0
## 4    SSE 1889       0     182   11   92    0
## 5    SSE 1890       0     251   42    0    0
## 6    SSE 1891       0     274   24    0    0</code></pre>
<p>Much better!</p>
<p><code>select</code> also allows you to say which columns you <em>don’t</em> want, by passing unquoted column names preceded by minus (-) signs:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="cleaning-and-manipulating-data.html#cb42-1" aria-hidden="true" tabindex="-1"></a>catch_data <span class="ot">&lt;-</span> catch_original <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="cleaning-and-manipulating-data.html#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>All, <span class="sc">-</span>notesRegCode)</span>
<span id="cb42-3"><a href="cleaning-and-manipulating-data.html#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="cleaning-and-manipulating-data.html#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(catch_data)</span></code></pre></div>
</div>
<div id="quality-check" class="section level4 unnumbered hasAnchor">
<h4>Quality Check<a href="cleaning-and-manipulating-data.html#quality-check" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Now that we have the data we are interested in using, we should do a little quality check to see that it seems as expected. One nice way of doing this is the <code>glimpse</code> function.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="cleaning-and-manipulating-data.html#cb43-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(catch_data)</span></code></pre></div>
<pre><code>## Rows: 1,708
## Columns: 7
## $ Region  &lt;chr&gt; &quot;SSE&quot;, &quot;SSE&quot;, &quot;SSE&quot;, &quot;SSE&quot;, &quot;SSE&quot;, &quot;SSE&quot;, &quot;SSE…
## $ Year    &lt;int&gt; 1886, 1887, 1888, 1889, 1890, 1891, 1892, 1893…
## $ Chinook &lt;chr&gt; &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;…
## $ Sockeye &lt;int&gt; 5, 155, 224, 182, 251, 274, 207, 189, 253, 408…
## $ Coho    &lt;int&gt; 0, 0, 16, 11, 42, 24, 11, 1, 5, 8, 192, 161, 1…
## $ Pink    &lt;int&gt; 0, 0, 0, 92, 0, 0, 8, 187, 529, 606, 996, 2218…
## $ Chum    &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 7, 0, 1, 2, 0…</code></pre>
</div>
<div id="challenge-15" class="section level4 unnumbered exercise hasAnchor">
<h4>Challenge<a href="cleaning-and-manipulating-data.html#challenge-15" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Notice the output of the <code>glimpse</code> function call. Does anything seem amiss with this dataset that might warrant fixing?</p>
</div>
<div id="section-23" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<details>
<summary>
<strong>Answer:</strong>
</summary>
The Chinook catch data are <code>character</code> class. Let’s fix it using the function <code>mutate</code> before moving on.
</details>
</div>
<div id="changing-column-content-mutate" class="section level4 unnumbered hasAnchor">
<h4>Changing column content: <code>mutate()</code><a href="cleaning-and-manipulating-data.html#changing-column-content-mutate" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can use the <code>mutate</code> function to change a column, or to create a new column. First Let’s try to just convert the Chinook catch values to <code>numeric</code> type using the <code>as.numeric()</code> function, and overwrite the old Chinook column.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="cleaning-and-manipulating-data.html#cb45-1" aria-hidden="true" tabindex="-1"></a>catch_clean <span class="ot">&lt;-</span> catch_data <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="cleaning-and-manipulating-data.html#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Chinook =</span> <span class="fu">as.numeric</span>(Chinook))</span></code></pre></div>
<pre><code>## Warning in mask$eval_all_mutate(quo): NAs introduced by coercion</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="cleaning-and-manipulating-data.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(catch_clean)</span></code></pre></div>
<pre><code>##   Region Year Chinook Sockeye Coho Pink Chum
## 1    SSE 1886       0       5    0    0    0
## 2    SSE 1887       0     155    0    0    0
## 3    SSE 1888       0     224   16    0    0
## 4    SSE 1889       0     182   11   92    0
## 5    SSE 1890       0     251   42    0    0
## 6    SSE 1891       0     274   24    0    0</code></pre>
<p>We get a warning “NAs introduced by coercion” which is R telling us that it couldn’t convert every value to an integer and, for those values it couldn’t convert, it put an <code>NA</code> in its place. This is behavior we commonly experience when cleaning datasets and it’s important to have the skills to deal with it when it crops up.</p>
<p>To investigate, let’s isolate the issue. We can find out which values are NAs with a combination of <code>is.na()</code> and <code>which()</code>, and save that to a variable called <code>i</code>.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="cleaning-and-manipulating-data.html#cb49-1" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">is.na</span>(catch_clean<span class="sc">$</span>Chinook))</span>
<span id="cb49-2"><a href="cleaning-and-manipulating-data.html#cb49-2" aria-hidden="true" tabindex="-1"></a>i</span></code></pre></div>
<pre><code>## [1] 401</code></pre>
<p>It looks like there is only one problem row, lets have a look at it in the original data.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="cleaning-and-manipulating-data.html#cb51-1" aria-hidden="true" tabindex="-1"></a>catch_data[i,]</span></code></pre></div>
<pre><code>##     Region Year Chinook Sockeye Coho Pink Chum
## 401    GSE 1955       I      66    0    0    1</code></pre>
<p>Well that’s odd: The value in <code>catch_thousands</code> is <code>I</code>. It turns out that this dataset is from a PDF which was automatically converted into a CSV and this value of <code>I</code> is actually a 1.</p>
<p>Let’s fix it by incorporating the <code>ifelse</code> function to our <code>mutate</code> call, which will change the value of the <code>Chinook</code> column to 1 if the value is equal to I, otherwise it will use <code>as.numeric</code> to turn the character representations of numbers into numeric typed values.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="cleaning-and-manipulating-data.html#cb53-1" aria-hidden="true" tabindex="-1"></a>catch_clean <span class="ot">&lt;-</span> catch_data <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="cleaning-and-manipulating-data.html#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Chinook =</span> <span class="fu">if_else</span>(Chinook <span class="sc">==</span> <span class="st">&quot;I&quot;</span>, <span class="st">&quot;1&quot;</span>, Chinook)) <span class="sc">%&gt;%</span> </span>
<span id="cb53-3"><a href="cleaning-and-manipulating-data.html#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Chinook =</span> <span class="fu">as.integer</span>(Chinook))</span>
<span id="cb53-4"><a href="cleaning-and-manipulating-data.html#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="cleaning-and-manipulating-data.html#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(catch_clean)</span></code></pre></div>
<pre><code>##   Region Year Chinook Sockeye Coho Pink Chum
## 1    SSE 1886       0       5    0    0    0
## 2    SSE 1887       0     155    0    0    0
## 3    SSE 1888       0     224   16    0    0
## 4    SSE 1889       0     182   11   92    0
## 5    SSE 1890       0     251   42    0    0
## 6    SSE 1891       0     274   24    0    0</code></pre>
</div>
<div id="changing-shape-pivot_longer-and-pivot_wider" class="section level4 unnumbered hasAnchor">
<h4>Changing shape: <code>pivot_longer()</code> and <code>pivot_wider()</code><a href="cleaning-and-manipulating-data.html#changing-shape-pivot_longer-and-pivot_wider" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The next issue is that the data are in a wide format and, we want the data in a tall format instead. <code>pivot_longer()</code> from the <code>tidyr</code> package helps us do just this conversion:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="cleaning-and-manipulating-data.html#cb55-1" aria-hidden="true" tabindex="-1"></a>catch_long <span class="ot">&lt;-</span> catch_clean <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="cleaning-and-manipulating-data.html#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(Region, Year), <span class="at">names_to =</span> <span class="st">&quot;species&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;catch&quot;</span>)</span>
<span id="cb55-3"><a href="cleaning-and-manipulating-data.html#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="cleaning-and-manipulating-data.html#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(catch_long)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   Region  Year species catch
##   &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;   &lt;int&gt;
## 1 SSE     1886 Chinook     0
## 2 SSE     1886 Sockeye     5
## 3 SSE     1886 Coho        0
## 4 SSE     1886 Pink        0
## 5 SSE     1886 Chum        0
## 6 SSE     1887 Chinook     0</code></pre>
<p>The syntax we used above for <code>pivot_longer()</code> might be a bit confusing so let’s walk though it.</p>
<p>The first argument to <code>pivot_longer</code> is the columns over which we are pivoting. You can select these by listing either the names of the columns you do want to pivot, or the names of the columns you are not pivoting over. The <code>names_to</code> argument takes the name of the column that you are creating from the column <strong>names</strong> you are pivoting over. The <code>values_to</code> argument takes the name of the column that you are creating from the <strong>values</strong> in the columns you are pivoting over.</p>
<p>The opposite of <code>pivot_longer()</code>, <code>pivot_wider()</code>, works in a similar declarative fashion:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="cleaning-and-manipulating-data.html#cb57-1" aria-hidden="true" tabindex="-1"></a>catch_wide <span class="ot">&lt;-</span> catch_long <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="cleaning-and-manipulating-data.html#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> species, <span class="at">values_from =</span> catch)</span>
<span id="cb57-3"><a href="cleaning-and-manipulating-data.html#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="cleaning-and-manipulating-data.html#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(catch_wide)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 7
##   Region  Year Chinook Sockeye  Coho  Pink  Chum
##   &lt;chr&gt;  &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1 SSE     1886       0       5     0     0     0
## 2 SSE     1887       0     155     0     0     0
## 3 SSE     1888       0     224    16     0     0
## 4 SSE     1889       0     182    11    92     0
## 5 SSE     1890       0     251    42     0     0
## 6 SSE     1891       0     274    24     0     0</code></pre>
</div>
<div id="renaming-columns-with-rename" class="section level4 unnumbered hasAnchor">
<h4>Renaming columns with <code>rename()</code><a href="cleaning-and-manipulating-data.html#renaming-columns-with-rename" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If you scan through the data, you may notice the values in the <code>catch</code> column are very small (these are supposed to be annual catches). If we look at <a href="https://knb.ecoinformatics.org/#view/df35b.304.2">the metadata</a> we can see that the <code>catch</code> column is in thousands of fish so let’s convert it before moving on.</p>
<p>Let’s first rename the <code>catch</code> column to be called <code>catch_thousands</code>:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="cleaning-and-manipulating-data.html#cb59-1" aria-hidden="true" tabindex="-1"></a>catch_long <span class="ot">&lt;-</span> catch_long <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="cleaning-and-manipulating-data.html#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">catch_thousands =</span> catch)</span>
<span id="cb59-3"><a href="cleaning-and-manipulating-data.html#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="cleaning-and-manipulating-data.html#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(catch_long)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   Region  Year species catch_thousands
##   &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;             &lt;int&gt;
## 1 SSE     1886 Chinook               0
## 2 SSE     1886 Sockeye               5
## 3 SSE     1886 Coho                  0
## 4 SSE     1886 Pink                  0
## 5 SSE     1886 Chum                  0
## 6 SSE     1887 Chinook               0</code></pre>
</div>
<div id="aside-6" class="section level4 unnumbered aside hasAnchor">
<h4>Aside<a href="cleaning-and-manipulating-data.html#aside-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Many people use the base R function <code>names</code> to rename columns, often in combination with column indexing that relies on columns being in a particular order. Column indexing is often also used to select columns instead of the <code>select</code> function from <code>dplyr</code>. Although these methods both work just fine, they do have one major drawback: in most implementations they rely on you knowing exactly the column order your data is in.</p>
<p>To illustrate why your knowledge of column order isn’t reliable enough for these operations, considering the following scenario:</p>
<p>Your colleague emails you letting you know that she has an updated version of the conductivity-temperature-depth data from this year’s research cruise, and sends it along. Excited, you re-run your scripts that use this data for your phytoplankton research. You run the script and suddenly all of your numbers seem off. You spend hours trying to figure out what is going on.</p>
<p>Unbeknownst to you, your colleagues bought a new sensor this year that measures dissolved oxygen. Because of the new variables in the dataset, the column order is different. Your script which previously renamed the 4th column, <code>SAL_PSU</code> to <code>salinity</code> now renames the 4th column, <code>O2_MGpL</code> to <code>salinity</code>. No wonder your results looked so weird, good thing you caught it!</p>
<p>If you had written your code so that it doesn’t rely on column order, but instead renames columns using the <code>rename</code> function, the code would have run just fine (assuming the name of the original salinity column didn’t change, in which case the code would have errored in an obvious way). This is an example of a defensive coding strategy, where you try to anticipate issues before they arise, and write your code in such a way as to keep the issues from happening.</p>
</div>
<div id="adding-columns-mutate" class="section level4 unnumbered hasAnchor">
<h4>Adding columns: <code>mutate()</code><a href="cleaning-and-manipulating-data.html#adding-columns-mutate" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Now let’s use <code>mutate</code> again to create a new column called <code>catch</code> with units of fish (instead of thousands of fish).</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="cleaning-and-manipulating-data.html#cb61-1" aria-hidden="true" tabindex="-1"></a>catch_long <span class="ot">&lt;-</span> catch_long <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="cleaning-and-manipulating-data.html#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">catch =</span> catch_thousands <span class="sc">*</span> <span class="dv">1000</span>)</span>
<span id="cb61-3"><a href="cleaning-and-manipulating-data.html#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="cleaning-and-manipulating-data.html#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(catch_long)</span></code></pre></div>
<p>Now let’s remove the <code>catch_thousands</code> column for now since we don’t need it. Note that here we have added to the expression we wrote above by adding another function call (mutate) to our expression. This takes advantage of the pipe operator by grouping together a similar set of statements, which all aim to clean up the <code>catch_long</code> <code>data.frame</code>.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="cleaning-and-manipulating-data.html#cb62-1" aria-hidden="true" tabindex="-1"></a>catch_long <span class="ot">&lt;-</span> catch_long <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="cleaning-and-manipulating-data.html#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">catch =</span> catch_thousands <span class="sc">*</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb62-3"><a href="cleaning-and-manipulating-data.html#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>catch_thousands)</span>
<span id="cb62-4"><a href="cleaning-and-manipulating-data.html#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="cleaning-and-manipulating-data.html#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(catch_long)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   Region  Year species catch
##   &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt;
## 1 SSE     1886 Chinook     0
## 2 SSE     1886 Sockeye  5000
## 3 SSE     1886 Coho        0
## 4 SSE     1886 Pink        0
## 5 SSE     1886 Chum        0
## 6 SSE     1887 Chinook     0</code></pre>
<p>We’re now ready to start analyzing the data.</p>
</div>
<div id="group_by-and-summarise" class="section level4 unnumbered hasAnchor">
<h4><code>group_by</code> and <code>summarise</code><a href="cleaning-and-manipulating-data.html#group_by-and-summarise" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>As I outlined in the Introduction, <code>dplyr</code> lets us employ the Split-Apply-Combine strategy and this is exemplified through the use of the <code>group_by()</code> and <code>summarise()</code> functions:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="cleaning-and-manipulating-data.html#cb64-1" aria-hidden="true" tabindex="-1"></a>mean_region <span class="ot">&lt;-</span> catch_long <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="cleaning-and-manipulating-data.html#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="cleaning-and-manipulating-data.html#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">catch_mean =</span> <span class="fu">mean</span>(catch))</span>
<span id="cb64-4"><a href="cleaning-and-manipulating-data.html#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="cleaning-and-manipulating-data.html#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mean_region)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   Region catch_mean
##   &lt;chr&gt;       &lt;dbl&gt;
## 1 ALU        40384.
## 2 BER        16373.
## 3 BRB      2709796.
## 4 CHG       315487.
## 5 CKI       683571.
## 6 COP       179223.</code></pre>
<p>Another common use of <code>group_by()</code> followed by <code>summarize()</code> is to count the number of rows in each group. We have to use a special function from <code>dplyr</code>, <code>n()</code>.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="cleaning-and-manipulating-data.html#cb66-1" aria-hidden="true" tabindex="-1"></a>n_region <span class="ot">&lt;-</span> catch_long <span class="sc">%&gt;%</span> </span>
<span id="cb66-2"><a href="cleaning-and-manipulating-data.html#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="cleaning-and-manipulating-data.html#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>())</span>
<span id="cb66-4"><a href="cleaning-and-manipulating-data.html#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="cleaning-and-manipulating-data.html#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(n_region)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   Region     n
##   &lt;chr&gt;  &lt;int&gt;
## 1 ALU      435
## 2 BER      510
## 3 BRB      570
## 4 CHG      550
## 5 CKI      525
## 6 COP      470</code></pre>
</div>
<div id="aside-7" class="section level4 unnumbered aside hasAnchor">
<h4>Aside<a href="cleaning-and-manipulating-data.html#aside-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If you are finding that you are reaching for this combination of <code>group_by()</code>, <code>summarise()</code> and <code>n()</code> a lot, there is a helpful <code>dplyr</code> function <code>count()</code> that accomplishes this in one function!</p>
</div>
<div id="challenge-16" class="section level4 unnumbered exercise hasAnchor">
<h4>Challenge<a href="cleaning-and-manipulating-data.html#challenge-16" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Find another grouping and statistic to calculate for each group.</li>
<li>Find out if you can group by multiple variables.</li>
</ul>
</div>
<div id="filtering-rows-filter" class="section level4 unnumbered hasAnchor">
<h4>Filtering rows: <code>filter()</code><a href="cleaning-and-manipulating-data.html#filtering-rows-filter" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>filter()</code> is the verb we use to filter our <code>data.frame</code> to rows matching some condition. It’s similar to <code>subset()</code> from base R.</p>
<p>Let’s go back to our original <code>data.frame</code> and do some <code>filter()</code>ing:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="cleaning-and-manipulating-data.html#cb68-1" aria-hidden="true" tabindex="-1"></a>SSE_catch <span class="ot">&lt;-</span> catch_long <span class="sc">%&gt;%</span> </span>
<span id="cb68-2"><a href="cleaning-and-manipulating-data.html#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Region <span class="sc">==</span> <span class="st">&quot;SSE&quot;</span>)</span>
<span id="cb68-3"><a href="cleaning-and-manipulating-data.html#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="cleaning-and-manipulating-data.html#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(SSE_catch)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   Region  Year species catch
##   &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt;
## 1 SSE     1886 Chinook     0
## 2 SSE     1886 Sockeye  5000
## 3 SSE     1886 Coho        0
## 4 SSE     1886 Pink        0
## 5 SSE     1886 Chum        0
## 6 SSE     1887 Chinook     0</code></pre>
</div>
<div id="challenge-17" class="section level4 unnumbered exercise hasAnchor">
<h4>Challenge<a href="cleaning-and-manipulating-data.html#challenge-17" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Filter to just catches of over one million fish.</li>
<li>Filter to just Chinook from the SSE region</li>
</ul>
</div>
<div id="sorting-your-data-arrange" class="section level4 unnumbered hasAnchor">
<h4>Sorting your data: <code>arrange()</code><a href="cleaning-and-manipulating-data.html#sorting-your-data-arrange" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>arrange()</code> is how we sort the rows of a <code>data.frame</code>. In my experience, I use <code>arrange()</code> in two common cases:</p>
<ul>
<li>When I want to calculate a cumulative sum (with <code>cumsum()</code>) so row order matters</li>
<li>When I want to display a table (like in an <code>.Rmd</code> document) in sorted order</li>
</ul>
<p>Let’s re-calculate mean catch by region, and then <code>arrange()</code> the output by mean catch:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="cleaning-and-manipulating-data.html#cb70-1" aria-hidden="true" tabindex="-1"></a>mean_region <span class="ot">&lt;-</span> catch_long <span class="sc">%&gt;%</span> </span>
<span id="cb70-2"><a href="cleaning-and-manipulating-data.html#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span> </span>
<span id="cb70-3"><a href="cleaning-and-manipulating-data.html#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_catch =</span> <span class="fu">mean</span>(catch)) <span class="sc">%&gt;%</span> </span>
<span id="cb70-4"><a href="cleaning-and-manipulating-data.html#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean_catch)</span>
<span id="cb70-5"><a href="cleaning-and-manipulating-data.html#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="cleaning-and-manipulating-data.html#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mean_region)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   Region mean_catch
##   &lt;chr&gt;       &lt;dbl&gt;
## 1 BER        16373.
## 2 KTZ        18836.
## 3 ALU        40384.
## 4 NRS        51503.
## 5 KSK        67642.
## 6 YUK        68646.</code></pre>
<p>The default sorting order of <code>arrange()</code> is to sort in ascending order. To reverse the sort order, wrap the column name inside the <code>desc()</code> function:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="cleaning-and-manipulating-data.html#cb72-1" aria-hidden="true" tabindex="-1"></a>mean_region <span class="ot">&lt;-</span> catch_long <span class="sc">%&gt;%</span> </span>
<span id="cb72-2"><a href="cleaning-and-manipulating-data.html#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span> </span>
<span id="cb72-3"><a href="cleaning-and-manipulating-data.html#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_catch =</span> <span class="fu">mean</span>(catch)) <span class="sc">%&gt;%</span> </span>
<span id="cb72-4"><a href="cleaning-and-manipulating-data.html#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_catch))</span>
<span id="cb72-5"><a href="cleaning-and-manipulating-data.html#cb72-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-6"><a href="cleaning-and-manipulating-data.html#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mean_region)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   Region mean_catch
##   &lt;chr&gt;       &lt;dbl&gt;
## 1 SSE      3184661.
## 2 BRB      2709796.
## 3 NSE      1825021.
## 4 KOD      1528350 
## 5 PWS      1419237.
## 6 SOP      1110942.</code></pre>
</div>
</div>
<div id="joins-in-dplyr" class="section level3 hasAnchor" number="8.1.4">
<h3><span class="header-section-number">8.1.4</span> Joins in dplyr<a href="cleaning-and-manipulating-data.html#joins-in-dplyr" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>So now that we’re awesome at manipulating a single <code>data.frame</code>, where do we go from here? Manipulating <strong>more than one</strong> <code>data.frame</code>.</p>
<p>If you’ve ever used a database, you may have heard of or used what’s called a “join”, which allows us to to intelligently merge two tables together into a single table based upon a shared column between the two. We’ve already covered joins in <a href="data-modeling-essentials.html#data-modeling-tidy-data">Data Modeling &amp; Tidy Data</a> so let’s see how it’s done with <code>dplyr</code>.</p>
<p>The dataset we’re working with, <a href="https://knb.ecoinformatics.org/#view/df35b.304.2" class="uri">https://knb.ecoinformatics.org/#view/df35b.304.2</a>, contains a second CSV which has the definition of each <code>Region</code> code. This is a really common way of storing auxiliary information about our dataset of interest (catch) but, for analylitcal purposes, we often want them in the same <code>data.frame</code>. Joins let us do that easily.</p>
<p>Let’s look at a preview of what our join will do by looking at a simplified version of our data:</p>
<div class="figure">
<img src="images/left_join_catchdata.png" alt="" />
<p class="caption">Visualisation of our <code>left_join</code></p>
</div>
<p>First, let’s read in the region definitions data table and select only the columns we want. Note that I have piped my <code>read.csv</code> result into a select call, creating a tidy chunk that reads and selects the data that we need.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="cleaning-and-manipulating-data.html#cb74-1" aria-hidden="true" tabindex="-1"></a>region_defs <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://knb.ecoinformatics.org/knb/d1/mn/v2/object/df35b.303.1&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="cleaning-and-manipulating-data.html#cb74-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(code, mgmtArea)</span>
<span id="cb74-3"><a href="cleaning-and-manipulating-data.html#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="cleaning-and-manipulating-data.html#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(region_defs)</span></code></pre></div>
<pre><code>##      code                                  mgmtArea
## 1     GSE              Unallocated Southeast Alaska
## 2     NSE                 Northern Southeast Alaska
## 3     SSE                 Southern Southeast Alaska
## 4     YAK                                   Yakutat
## 5 PWSmgmt      Prince William Sound Management Area
## 6     BER Bering River Subarea Copper River Subarea</code></pre>
<p>If you examine the <code>region_defs</code> <code>data.frame</code>, you’ll see that the column names don’t exactly match the image above. If the names of the key columns are not the same, you can explicitly specify which are the key columns in the left and right side as shown below:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="cleaning-and-manipulating-data.html#cb76-1" aria-hidden="true" tabindex="-1"></a>catch_joined <span class="ot">&lt;-</span> <span class="fu">left_join</span>(catch_long, region_defs, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Region&quot;</span> <span class="ot">=</span> <span class="st">&quot;code&quot;</span>))</span>
<span id="cb76-2"><a href="cleaning-and-manipulating-data.html#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="cleaning-and-manipulating-data.html#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(catch_joined)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   Region  Year species catch mgmtArea                 
##   &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;                    
## 1 SSE     1886 Chinook     0 Southern Southeast Alaska
## 2 SSE     1886 Sockeye  5000 Southern Southeast Alaska
## 3 SSE     1886 Coho        0 Southern Southeast Alaska
## 4 SSE     1886 Pink        0 Southern Southeast Alaska
## 5 SSE     1886 Chum        0 Southern Southeast Alaska
## 6 SSE     1887 Chinook     0 Southern Southeast Alaska</code></pre>
<p>Notice that I have deviated from our usual pipe syntax (although it does work here!) because I prefer to see the <code>data.frames</code> that I am joining side by side in the syntax.</p>
<p>Another way you can do this join is to use <code>rename</code> to change the column name <code>code</code> to <code>Region</code> in the <code>region_defs</code> <code>data.frame</code>, and run the <code>left_join</code> this way:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="cleaning-and-manipulating-data.html#cb78-1" aria-hidden="true" tabindex="-1"></a>region_defs <span class="ot">&lt;-</span> region_defs <span class="sc">%&gt;%</span> </span>
<span id="cb78-2"><a href="cleaning-and-manipulating-data.html#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Region =</span> code, <span class="at">Region_Name =</span> mgmtArea)</span>
<span id="cb78-3"><a href="cleaning-and-manipulating-data.html#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="cleaning-and-manipulating-data.html#cb78-4" aria-hidden="true" tabindex="-1"></a>catch_joined <span class="ot">&lt;-</span> <span class="fu">left_join</span>(catch_long, region_defs, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Region&quot;</span>))</span>
<span id="cb78-5"><a href="cleaning-and-manipulating-data.html#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="cleaning-and-manipulating-data.html#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(catch_joined)</span></code></pre></div>
<p>Now our catches have the auxiliary information from the region definitions file alongside them. Note: <code>dplyr</code> provides a complete set of joins: inner, left, right, full, semi, anti, not just left_join.</p>
<div id="separate-and-unite" class="section level4 unnumbered hasAnchor">
<h4><code>separate()</code> and <code>unite()</code><a href="cleaning-and-manipulating-data.html#separate-and-unite" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>separate()</code> and its complement, <code>unite()</code> allow us to easily split a single column into numerous (or numerous into a single).</p>
<p>This can come in really handle when we need to split a column into two pieces by a consistent separator (like a dash).</p>
<p>Let’s make a new <code>data.frame</code> with fake data to illustrate this. Here we have a set of site identification codes. with information about the island where the site is (the first 3 letters) and a site number (the 3 numbers). If we want to group and summarize by island, we need a column with just the island information.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="cleaning-and-manipulating-data.html#cb79-1" aria-hidden="true" tabindex="-1"></a>sites_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">site =</span> <span class="fu">c</span>(<span class="st">&quot;HAW-101&quot;</span>,</span>
<span id="cb79-2"><a href="cleaning-and-manipulating-data.html#cb79-2" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;HAW-103&quot;</span>,</span>
<span id="cb79-3"><a href="cleaning-and-manipulating-data.html#cb79-3" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;OAH-320&quot;</span>,</span>
<span id="cb79-4"><a href="cleaning-and-manipulating-data.html#cb79-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;OAH-219&quot;</span>,</span>
<span id="cb79-5"><a href="cleaning-and-manipulating-data.html#cb79-5" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;MAI-039&quot;</span>))</span>
<span id="cb79-6"><a href="cleaning-and-manipulating-data.html#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="cleaning-and-manipulating-data.html#cb79-7" aria-hidden="true" tabindex="-1"></a>sites_df <span class="sc">%&gt;%</span> </span>
<span id="cb79-8"><a href="cleaning-and-manipulating-data.html#cb79-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(site, <span class="fu">c</span>(<span class="st">&quot;island&quot;</span>, <span class="st">&quot;site_number&quot;</span>), <span class="st">&quot;-&quot;</span>)</span></code></pre></div>
<pre><code>##   island site_number
## 1    HAW         101
## 2    HAW         103
## 3    OAH         320
## 4    OAH         219
## 5    MAI         039</code></pre>
<ul>
<li><strong>Exercise:</strong> Split the <code>city</code> column in the following <code>data.frame</code> into <code>city</code> and <code>state_code</code> columns:</li>
</ul>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="cleaning-and-manipulating-data.html#cb81-1" aria-hidden="true" tabindex="-1"></a>cities_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">city =</span> <span class="fu">c</span>(<span class="st">&quot;Juneau AK&quot;</span>, </span>
<span id="cb81-2"><a href="cleaning-and-manipulating-data.html#cb81-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;Sitka AK&quot;</span>, </span>
<span id="cb81-3"><a href="cleaning-and-manipulating-data.html#cb81-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;Anchorage AK&quot;</span>))</span>
<span id="cb81-4"><a href="cleaning-and-manipulating-data.html#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="cleaning-and-manipulating-data.html#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your solution here</span></span></code></pre></div>
<p><code>unite()</code> does just the reverse of <code>separate()</code>. If we have a data.frame that contains columns for year, month, and day, we might want to unite these into a single date column.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="cleaning-and-manipulating-data.html#cb82-1" aria-hidden="true" tabindex="-1"></a>dates_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> <span class="fu">c</span>(<span class="st">&quot;1930&quot;</span>,</span>
<span id="cb82-2"><a href="cleaning-and-manipulating-data.html#cb82-2" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;1930&quot;</span>,</span>
<span id="cb82-3"><a href="cleaning-and-manipulating-data.html#cb82-3" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;1930&quot;</span>),</span>
<span id="cb82-4"><a href="cleaning-and-manipulating-data.html#cb82-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">month =</span> <span class="fu">c</span>(<span class="st">&quot;12&quot;</span>,</span>
<span id="cb82-5"><a href="cleaning-and-manipulating-data.html#cb82-5" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;12&quot;</span>,</span>
<span id="cb82-6"><a href="cleaning-and-manipulating-data.html#cb82-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;12&quot;</span>),</span>
<span id="cb82-7"><a href="cleaning-and-manipulating-data.html#cb82-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">day =</span> <span class="fu">c</span>(<span class="st">&quot;14&quot;</span>,</span>
<span id="cb82-8"><a href="cleaning-and-manipulating-data.html#cb82-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;15&quot;</span>,</span>
<span id="cb82-9"><a href="cleaning-and-manipulating-data.html#cb82-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;16&quot;</span>))</span>
<span id="cb82-10"><a href="cleaning-and-manipulating-data.html#cb82-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-11"><a href="cleaning-and-manipulating-data.html#cb82-11" aria-hidden="true" tabindex="-1"></a>dates_df <span class="sc">%&gt;%</span> </span>
<span id="cb82-12"><a href="cleaning-and-manipulating-data.html#cb82-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(date, year, month, day, <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>)</span></code></pre></div>
<pre><code>##         date
## 1 1930-12-14
## 2 1930-12-15
## 3 1930-12-16</code></pre>
<ul>
<li><strong>Exercise:</strong> Use <code>unite()</code> on your solution above to combine the <code>cities_df</code> back to its original form with just one column, <code>city</code>:</li>
</ul>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="cleaning-and-manipulating-data.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your solution here</span></span></code></pre></div>
</div>
<div id="summary-3" class="section level4 unnumbered hasAnchor">
<h4>Summary<a href="cleaning-and-manipulating-data.html#summary-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We just ran through the various things we can do with <code>dplyr</code> and <code>tidyr</code> but if you’re wondering how this might look in a real analysis. Let’s look at that now:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="cleaning-and-manipulating-data.html#cb85-1" aria-hidden="true" tabindex="-1"></a>catch_original <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">url</span>(<span class="st">&quot;https://knb.ecoinformatics.org/knb/d1/mn/v2/object/df35b.302.1&quot;</span>, <span class="at">method =</span> <span class="st">&quot;libcurl&quot;</span>))</span>
<span id="cb85-2"><a href="cleaning-and-manipulating-data.html#cb85-2" aria-hidden="true" tabindex="-1"></a>region_defs <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">url</span>(<span class="st">&quot;https://knb.ecoinformatics.org/knb/d1/mn/v2/object/df35b.303.1&quot;</span>, <span class="at">method =</span> <span class="st">&quot;libcurl&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb85-3"><a href="cleaning-and-manipulating-data.html#cb85-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(code, mgmtArea)</span>
<span id="cb85-4"><a href="cleaning-and-manipulating-data.html#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="cleaning-and-manipulating-data.html#cb85-5" aria-hidden="true" tabindex="-1"></a>mean_region <span class="ot">&lt;-</span> catch_original <span class="sc">%&gt;%</span></span>
<span id="cb85-6"><a href="cleaning-and-manipulating-data.html#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>All, <span class="sc">-</span>notesRegCode) <span class="sc">%&gt;%</span> </span>
<span id="cb85-7"><a href="cleaning-and-manipulating-data.html#cb85-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Chinook =</span> <span class="fu">ifelse</span>(Chinook <span class="sc">==</span> <span class="st">&quot;I&quot;</span>, <span class="dv">1</span>, Chinook)) <span class="sc">%&gt;%</span> </span>
<span id="cb85-8"><a href="cleaning-and-manipulating-data.html#cb85-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Chinook =</span> <span class="fu">as.numeric</span>(Chinook)) <span class="sc">%&gt;%</span> </span>
<span id="cb85-9"><a href="cleaning-and-manipulating-data.html#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(Region, Year), <span class="at">names_to =</span> <span class="st">&quot;species&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;catch&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb85-10"><a href="cleaning-and-manipulating-data.html#cb85-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">catch =</span> catch<span class="sc">*</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb85-11"><a href="cleaning-and-manipulating-data.html#cb85-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span> </span>
<span id="cb85-12"><a href="cleaning-and-manipulating-data.html#cb85-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_catch =</span> <span class="fu">mean</span>(catch)) <span class="sc">%&gt;%</span> </span>
<span id="cb85-13"><a href="cleaning-and-manipulating-data.html#cb85-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(region_defs, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Region&quot;</span> <span class="ot">=</span> <span class="st">&quot;code&quot;</span>))</span>
<span id="cb85-14"><a href="cleaning-and-manipulating-data.html#cb85-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-15"><a href="cleaning-and-manipulating-data.html#cb85-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mean_region)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   Region mean_catch mgmtArea                                 
##   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;                                    
## 1 ALU        40384. Aleutian Islands Subarea                 
## 2 BER        16373. Bering River Subarea Copper River Subarea
## 3 BRB      2709796. Bristol Bay Management Area              
## 4 CHG       315487. Chignik Management Area                  
## 5 CKI       683571. Cook Inlet Management Area               
## 6 COP       179223. Copper River Subarea</code></pre>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-modeling-essentials.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-visualization-and-publishing-to-the-web.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
