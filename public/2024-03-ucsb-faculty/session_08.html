<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>UCSB Faculty Seminar Series: Grow Your Data &amp; Team Science Skills - 8&nbsp; Git Workflows</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./session_09.html" rel="next">
<link href="./session_07.html" rel="prev">
<link href="./cover.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./session_08.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Git Workflows</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Git Workflows</span></h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Training Materials</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://www.nceas.ucsb.edu/learning-hub" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-house-door-fill"></i></a>
    <a href="https://twitter.com/ucsb_nceas" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/NCEAS/nceas-training/tree/2024-03-ucsb-faculty" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About the course</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session_01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Seminar Series Recap and Reproducibility</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session_02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Visualization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session_03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Text Analysis in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session_04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Accesing Survey Data Using a Reproducible Workflow</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session_05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Visualizing Spatial Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session_06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">GitHub for Project Management</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session_07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Publishing to the Web</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session_08.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Git Workflows</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session_09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Science Communication: Message Box</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session_10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Quarto Dashboards</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session_11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Practice Session</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session_12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Reproducibility and Provenance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session_13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Check and Set your PAT</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link active" data-scroll-target="#learning-objectives"><span class="header-section-number">8.1</span> Learning Objectives</a></li>
  <li><a href="#branches" id="toc-branches" class="nav-link" data-scroll-target="#branches"><span class="header-section-number">8.2</span> Branches</a>
  <ul class="collapse">
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise"><span class="header-section-number">8.2.1</span> Exercise</a></li>
  </ul></li>
  <li><a href="#why-git-workflows-are-important" id="toc-why-git-workflows-are-important" class="nav-link" data-scroll-target="#why-git-workflows-are-important"><span class="header-section-number">8.3</span> Why <code>Git</code> workflows are important</a></li>
  <li><a href="#pull-requests" id="toc-pull-requests" class="nav-link" data-scroll-target="#pull-requests"><span class="header-section-number">8.4</span> Pull Requests</a></li>
  <li><a href="#branch-workflow" id="toc-branch-workflow" class="nav-link" data-scroll-target="#branch-workflow"><span class="header-section-number">8.5</span> Branch Workflow</a>
  <ul class="collapse">
  <li><a href="#how-it-works" id="toc-how-it-works" class="nav-link" data-scroll-target="#how-it-works"><span class="header-section-number">8.5.1</span> How it Works</a></li>
  <li><a href="#branch_exercise" id="toc-branch_exercise" class="nav-link" data-scroll-target="#branch_exercise"><span class="header-section-number">8.5.2</span> Exercise: create a branch, make a change in a file, and submit a Pull Request</a></li>
  </ul></li>
  <li><a href="#forking-workflow" id="toc-forking-workflow" class="nav-link" data-scroll-target="#forking-workflow"><span class="header-section-number">8.6</span> Forking Workflow</a>
  <ul class="collapse">
  <li><a href="#how-it-works-1" id="toc-how-it-works-1" class="nav-link" data-scroll-target="#how-it-works-1"><span class="header-section-number">8.6.1</span> How it Works</a></li>
  </ul></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources"><span class="header-section-number">8.7</span> Resources</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="learning-objectives" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">8.1</span> Learning Objectives</h2>
<p>In this lesson, you will learn:</p>
<ul>
<li>What is a <strong>branch</strong> in Git?</li>
<li>How to use a branch to organize code</li>
<li>What is a <strong>tag</strong> in Git and how is it useful for collaboration?</li>
<li>New mechanisms to collaborate using <strong>Git</strong></li>
<li>What is a <strong>Pull Request</strong> in GitHub?</li>
<li>How to contribute code to colleague’s repository using Pull Requests</li>
</ul>
</section>
<section id="branches" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="branches"><span class="header-section-number">8.2</span> Branches</h2>
<p>Branches are a mechanism to isolate a set of changes in their own thread, allowing multiple types of work to happen in parallel on a repository at the same time. These are most often used for separating work from multiple collaborators so they don’t conflict, or trying out experimental work, or for managing bug fixes for historical releases of software. The default branch in most new repositories is called <code>main</code>, and it is the branch that is typically shown in the GitHub interface and elsewhere.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">%%{init: { 'theme': 'neutral' } }%%
gitGraph
    checkout main
    commit
    commit
    commit
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>The <code>main</code> branch of a repository is shown above with three commits, each representing one specific version of the repository linked to its parent commit.</p>
<p>But <code>main</code> isn’t the only branch you can use in a repository. You can create more. Maybe you’re not so sure that a new idea will work out in code, and this is where a tool like <code>Git</code> shines. Without a tool like <code>Git</code>, we might copy analysis.R to another file called analysis-ml.R which might end up having mostly the same code except for a few lines. This isn’t particularly problematic until you want to make a change to a bit of shared code and now you have to make changes in two files, if you even remember to.</p>
<p>Instead, with <code>Git</code>, we can start a branch. Branches allow us to confidently experiment on our code, all while leaving the old code intact and recoverable.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">%%{init: { 'theme': 'neutral' } }%%
gitGraph
    checkout main
    commit
    commit
    commit
    branch new-analysis-ml
    commit
    commit
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>So you’ve been working in a branch and have made a few commits on it and your boss emails again asking you to update the model in some way. If you weren’t using a tool like <code>Git</code>, you might panic at this point because you’ve rewritten much of your analysis to use a different method but your boss wants the change to the old method.</p>
<p>But with <code>Git</code> and branches, we can continue developing our main analysis at the same time as we are working on any experimental branches. Using <code>git checkout main</code>, you can return the state of your working copy to the <code>main</code> branch, and make the needed change to the original code, all while saving the code in <code>new-analysis-ml</code> for later. Branches are great for experiments but also great for organizing your work generally, especially when each branch is tied to a ticket to discuss progress and issues on that line of work.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">%%{init: { 'theme': 'neutral' } }%%
gitGraph
    checkout main
    commit
    commit
    commit
    branch new-analysis-ml
    commit
    commit
    checkout main
    commit
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>After all that hard work on the machine learning experiment, you and your colleague could decide to scrap it. It’s perfectly fine to leave branches around and switch back to the <code>main</code> line of development, but we can also delete them to tidy up.</p>
<p>If, instead, you and your colleague had decided you liked the machine learning experiment, you could also merge the branch with your <code>main</code> development line. Merging branches is analogous to accepting a change in Word’s Track Changes feature but way more powerful and useful. With the merge, we take all of the changes from the branch, and apply them to the files in the target <code>main</code> branch (or whatever branch we are merging into). This might merge smoothly, or may generate a conflict that will need to be resolved if the same files had already been changed on <code>main</code>. Either way, when complete, there is a new <code>merge commit</code> showing where the two branches came together.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">%%{init: { 'theme': 'neutral' } }%%
gitGraph
    checkout main
    commit
    commit
    commit
    branch new-analysis-ml
    commit
    commit
    checkout main
    commit
    checkout new-analysis-ml
    commit
    checkout main
    merge new-analysis-ml tag: "final-paper-version"
    commit
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>A key takeaway here is that <code>Git</code> can drastically increase your confidence and willingness to make changes to your code and help you avoid problems down the road. Analysis rarely follows a linear path and we need a tool that respects this. The key to that confidence, however, is in understanding what git does with your versions, and how to get back to a previous state when needed.</p>
<p>Finally, imagine that, years later, your colleague asks you to make sure the model you reported in a paper you published together was actually the one you used. Another really powerful feature of <code>Git</code> is tags which allow us to label a particular version of our code with a meaningful name. In this case, we are lucky because we tagged the version of our code we used to run the analysis at the time the paper was submitted. Even if we continued to develop beyond last commit (above) after we submitted our manuscript, we can always go back and run the analysis as it was in the past.</p>
<section id="exercise" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="exercise"><span class="header-section-number">8.2.1</span> Exercise</h3>
<p>Create a new branch in your training repository called <code>new-feature</code>, and then make changes to the RMarkdown files in the directory. Commit and push those changes to the branch. Now you can switch between branches using the GitHub interface.</p>
<p>This can be done directly in the RStudio interface within the <code>Git</code> pane using the new branch icon. Alternatively, you can run this line in the Terminal which will create a new branch and switch to it: <code>git checkout -b new-feature</code></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/git-worfklows-new-branch-button.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>After you click that icon, a new dialog box appears where you can create a new branch. Keep the setting to “origin” and keep the box “Sync branch with remote” checked.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/git-workflows-new-branch.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>You can now work on the <code>new-feature</code> branch in this new workspace independently of the codebase in <code>main</code>, and without affecting it. When you have finished and completed your changes, you can either decide to leave it there, delete it, or merge it back to main. To merge this new feature branch back, first checkout the main branch with <code>git checkout main</code>, and make a change to one of the files in your main branch – commit that change, and you will see how you can have different changes stored in different branches. Your repository history should look something like this:</p>
<p><img src="images/git-workflows-two-branches.png" class="img-fluid"></p>
<p>When you are ready to merge the feature branch back into <code>main</code>, all you have to do is run <code>git merge new-feature</code> from the commandline. After that is complete, your new feature will now be merged back into main and visible from the git history:</p>
<p><img src="images/git-workflows-merged-branch.png" class="img-fluid"></p>
<!--
## Learning Objectives {.unnumbered}

- Become familiar with additional mechanisms to collaborate using `Git`
- Contribute code to a colleague’s repository using Pull Requests
-->
</section>
</section>
<section id="why-git-workflows-are-important" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="why-git-workflows-are-important"><span class="header-section-number">8.3</span> Why <code>Git</code> workflows are important</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/git-workflows.png" class="img-fluid figure-img"></p>
<figcaption>Source: Atlassian</figcaption>
</figure>
</div>
<p>When working with a team on a <code>Git</code>-managed project, it’s important to make sure the team is in agreement on how the flow of changes will be applied. To ensure the team is on the same page, an agreed-upon <code>Git</code> workflow should be developed or selected (maybe something to add your <a href="https://learning.nceas.ucsb.edu/2023-04-coreR/session_14.html">DMP</a>). There are several documented <code>Git</code> workflows that may be a good fit for your team. In this lesson, we will discuss two of these <code>Git</code> workflow options:</p>
<ol type="1">
<li><a href="#branch-workflow">Branch Workflow</a></li>
<li><a href="#forking-workflow">Forking Workflow</a></li>
</ol>
<p>Remember that these workflows are designed to be guidelines rather than concrete rules. We want to show you what’s possible, so you can mix and match aspects from different workflows to suit your project’s needs.</p>
</section>
<section id="pull-requests" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="pull-requests"><span class="header-section-number">8.4</span> Pull Requests</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/git-workflow-branch-pr.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>Source: Atlassian</figcaption>
</figure>
</div>
<p>In previous chapters, we’ve gone over how to directly collaborate on a repository with colleagues by granting them <code>write</code> privileges as a Collaborator to your repository. This is useful with close collaborators, but also grants them tremendous latitude to change files and analyses, to remove files from the working copy, and to modify all files in the repository.</p>
<p>Pull requests represent a mechanism to more judiciously collaborate, one in which:</p>
<ol type="1">
<li>First, a Collaborator can suggest changes to a repository</li>
<li>Then, the Owner and Collaborator can discuss those changes in a structured way</li>
<li>Finally, the Owner can review and accept all or only some of those changes to the repository</li>
</ol>
<p>This is useful with open source code where a community is contributing to shared analytical software, to students in a lab working on related but not identical projects, and to others who want the capability to review changes as they are submitted.</p>
<p>We’ll be using Pull Requests in both the branch and forking workflow. Using pull requests with each of these workflows is slightly different, but the general process is as follows:</p>
<ol type="1">
<li>A Collaborator creates a feature in their local repository</li>
<li>Collaborator pushes the branch to the GitHub repository they’re collaborating on</li>
<li>Collaborator opens a Pull Request on GitHub</li>
<li>Owner or the rest of the team reviews the code, discusses it, and alters it (as neded)</li>
<li>Owner or project maintainer merges the feature into the repository and closes the Pull Request</li>
</ol>
</section>
<section id="branch-workflow" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="branch-workflow"><span class="header-section-number">8.5</span> Branch Workflow</h2>
<p>Branches are a mechanism to isolate a set of changes in their own thread, allowing multiple types of work to happen in parallel on a repository at the same time. These are most often used for trying out experimental work, or for managing bug fixes for historical releases of software. Here’s an example graph showing a <code>branch2.1</code> that has changes in parallel to the main branch of development:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/version-graph.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>The default branch in almost all repositories is called <code>main</code>, and it is the branch that is typically shown in the GitHub interface and elsewhere. There are many mechanisms to create branches. The one we will try is through RStudio, in which we use the branch dialog to create and switch between branches.</p>
<section id="how-it-works" class="level3" data-number="8.5.1">
<h3 data-number="8.5.1" class="anchored" data-anchor-id="how-it-works"><span class="header-section-number">8.5.1</span> How it Works</h3>
<p>The core idea behind the Branch Workflow is that all project development should take place in a dedicated branch instead of the <code>main</code> branch. This makes it easy for multiple Collaborators to work on a particular part of the project without disturbing the <code>main</code> codebase. It also means the <code>main</code> branch will never contain broken code.</p>
<p>In general a branch workflow follows these steps:</p>
<div class="callout callout-style-default callout-caution no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
BIG IDEA
</div>
</div>
<div class="callout-body-container callout-body">
<p>Owner and Collaborator work in the same repository, but in different branches outside of <code>main</code></p>
</div>
</div>
<section id="collaborator-in-their-workspace-creates-a-new-branch-for-the-feature-or-development-theyre-working-on" class="level4" data-number="8.5.1.1">
<h4 data-number="8.5.1.1" class="anchored" data-anchor-id="collaborator-in-their-workspace-creates-a-new-branch-for-the-feature-or-development-theyre-working-on"><span class="header-section-number">8.5.1.1</span> Collaborator, in their workspace, creates a new branch for the feature or development they’re working on</h4>
<p>This can be done directly in the RStudio interface within the <code>Git</code> pane using the new branch icon. Alternatively, you can run this line in the Terminal which will create a new branch and switch to it: <code>git checkout -b ＜new-branch＞</code></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/git-worfklows-new-branch-button.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>After you click that icon, a new dialog box appears where you can create a new branch. Keep the setting to “origin” and keep the box “Sync branch with remote” checked.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/git-workflows-new-branch.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>This new branch has effectively created a copy of the <code>main</code> in this new workspace where you can work on a new feature independently of the codebase in <code>main</code> without affecting it.</p>
</section>
<section id="when-collaborator-has-finalized-their-work-the-will-open-and-submit-a-pull-request-to-the-main-branch" class="level4" data-number="8.5.1.2">
<h4 data-number="8.5.1.2" class="anchored" data-anchor-id="when-collaborator-has-finalized-their-work-the-will-open-and-submit-a-pull-request-to-the-main-branch"><span class="header-section-number">8.5.1.2</span> When Collaborator has finalized their work, the will open and submit a Pull Request to the <code>main</code> branch</h4>
<p>When you go to GitHub to open a Pull Request, GitHub will recognize that a new change has been pushed to the remote repository and will suggest opening a pull request.</p>
<p><img src="images/git-workflows-notification-new-pr.png" class="img-fluid"></p>
<p>When you open a new Pull Request, you will be pushing your changes from your new branch to <code>main</code>. The Pull Request will automatically compare the codebase for both workspaces to determine if the two can be successfully merged. If not, you will need to reconcile the merge conflict before completing the Pull Request. If you see that you are “Able to merge” the two branches, then move forward by clicking “Create pull request.</p>
<p><img src="images/git-workflows-open-new-pr.png" class="img-fluid"></p>
</section>
<section id="ideally-owner-reviews-the-pull-request-and-discusses-new-code-changes-as-necessary-with-collaborator" class="level4" data-number="8.5.1.3">
<h4 data-number="8.5.1.3" class="anchored" data-anchor-id="ideally-owner-reviews-the-pull-request-and-discusses-new-code-changes-as-necessary-with-collaborator"><span class="header-section-number">8.5.1.3</span> Ideally, Owner reviews the Pull Request and discusses new code changes as necessary with Collaborator</h4>
<p>It’s important to have a review process to avoid potential issues. In this case, the author of the Pull Request is being closed (and therefore not merged) since the pull request does not target the correct branch of the workflow. Ultimately, these discussions lead to greater successfull and smoother workflows on a collaborative project.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/git-workflows-pr-not-accepted.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</section>
<section id="owner-merges-the-new-feature-or-development-into-main-and-closes-the-pull-request" class="level4" data-number="8.5.1.4">
<h4 data-number="8.5.1.4" class="anchored" data-anchor-id="owner-merges-the-new-feature-or-development-into-main-and-closes-the-pull-request"><span class="header-section-number">8.5.1.4</span> Owner merges the new feature or development into <code>main</code> and closes the Pull Request</h4>
<p>Once the Pull Request has been reviewed, the reviewer can merge in the new feature which automatically closes the pull request.</p>
<p><img src="images/git-workflows-pr-success-close.png" class="img-fluid"></p>
</section>
<section id="everyone-switches-to-main-in-their-local-workspace-and-pulls-so-that-theyre-in-sync-with-the-new-changes-in-the-remote-main" class="level4" data-number="8.5.1.5">
<h4 data-number="8.5.1.5" class="anchored" data-anchor-id="everyone-switches-to-main-in-their-local-workspace-and-pulls-so-that-theyre-in-sync-with-the-new-changes-in-the-remote-main"><span class="header-section-number">8.5.1.5</span> Everyone switches to <code>main</code> in their local workspace and <code>Pull</code>s so that they’re in sync with the new changes in the remote <code>main</code></h4>
<p>If you have merged all your new features into <code>main</code> from the new branch and will no longer need use the new branch, <code>pull</code> to sync up your local workspace (because merging creates a new commit and this commit exists on GitHub since it was created in GitHub). And to keep your repository clean, delete the branch. And note that you can always restore the branch if you need to return to it.</p>
<p>Now pair up with a partner and try this flow out in the <a href="#branch_exercise">Branch exercise</a>.</p>
</section>
</section>
<section id="branch_exercise" class="level3" data-number="8.5.2">
<h3 data-number="8.5.2" class="anchored" data-anchor-id="branch_exercise"><span class="header-section-number">8.5.2</span> Exercise: create a branch, make a change in a file, and submit a Pull Request</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Instructions
</div>
</div>
<div class="callout-body-container callout-body">
<ol start="0" type="1">
<li>Make sure you’re in your <code>{ownerName}-{collaboratorName}</code> repository that you created in the <a href="https://learning.nceas.ucsb.edu/2023-04-coreR/session_13.html">R Practice: Collaborating on, Wrangling &amp; Visualizing Data</a> session</li>
<li>Choose who is the Owner and who is the Collaborator</li>
<li>Have the Collaborator make a new branch called <code>new-data-viz</code></li>
<li>In the new, <code>new-data-viz</code> branch, the Collaborator will open the <code>lobster-report.Rmd</code> file and add some new visualization code to the file.</li>
<li>Collaborator uses the <code>Git</code> workflow: <code>Save -&gt; Stage -&gt; Commit -&gt; Pull -&gt; Push</code></li>
<li>Collaborator submits a Pull Request where they want to merge changes from <code>new-data-viz</code> to <code>main</code></li>
<li>Owner reviews the Pull Request and discusses new code with Collaborator, if needed</li>
<li>After the review, Owner accepts the Pull Request, which will merge the new changes and close it</li>
<li>Switch roles and repeat steps 1-8, where the Owner will add new vizualization code to the <code>lobster-report.Rmd</code></li>
</ol>
</div>
</div>
</section>
</section>
<section id="forking-workflow" class="level2" data-number="8.6">
<h2 data-number="8.6" class="anchored" data-anchor-id="forking-workflow"><span class="header-section-number">8.6</span> Forking Workflow</h2>
<p>The Forking Workflow is fundamentally different than other popular Git workflows. Instead of using a single <code>Git</code> repository to act as the “central” codebase, it gives every Collaborator their own repository to work in. This means they are not a Collaborator on the repository they have forked from and therefore do not have write access to that original repository.</p>
<p>The Forking Workflow is most often seen in public open source projects.</p>
<p>The main advantage of the Forking Workflow is that contributions can be integrated without the need for everybody to push to a single central repository. Collaborators push to their own repositories, and only the Owner can push to the official repository. This allows the Owner to accept commits from any Collaborator without giving them write access to the official codebase.</p>
<p>The result is a distributed workflow that provides a flexible way for large, organic teams (including untrusted third-parties) to collaborate securely. This also makes it an ideal workflow for open source projects.</p>
<section id="how-it-works-1" class="level3" data-number="8.6.1">
<h3 data-number="8.6.1" class="anchored" data-anchor-id="how-it-works-1"><span class="header-section-number">8.6.1</span> How it Works</h3>
<div class="callout callout-style-default callout-caution no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
BIG IDEA
</div>
</div>
<div class="callout-body-container callout-body">
<p>Owner and Collaborator work in their own different repositories, where the Collaborator has <code>forked</code> the Owner’s repository (aka the Owner repository is the “original” repository). The <code>fork</code> is a link to the original repository that allows the Collaborator to submit Pull Requests.</p>
</div>
</div>
<p>In the following example, <code>mbjones</code> will be the repository Owner, and <code>metamattj</code> will be the Collaborator.</p>
<section id="collaborator-first-creates-a-fork-of-the-owners-repository" class="level4" data-number="8.6.1.1">
<h4 data-number="8.6.1.1" class="anchored" data-anchor-id="collaborator-first-creates-a-fork-of-the-owners-repository"><span class="header-section-number">8.6.1.1</span> Collaborator first creates a <code>fork</code> of the owner’s repository</h4>
<p>This <code>fork</code> is a cloned copy of the Owner’s repository that is separate but linked to the Owner’s repository. Here we see that the <code>mbjones/training-test</code> repository has been <code>forked</code> once.</p>
<p>To create a <code>forked</code> repository, visit the GitHub page for the Owner’s repository that you’d like to make changes to, and click the <code>Fork</code> button. This will create a clone of that repository in your own GitHub account that can be <code>cloned</code> to your local computer.</p>
<p><img src="images/git-pr-01-owner-repo.png" class="img-fluid"></p>
</section>
<section id="collaborator-clones-their-new-forked-repository-into-their-local-workspace" class="level4" data-number="8.6.1.2">
<h4 data-number="8.6.1.2" class="anchored" data-anchor-id="collaborator-clones-their-new-forked-repository-into-their-local-workspace"><span class="header-section-number">8.6.1.2</span> Collaborator <code>clone</code>s their new <code>forked</code> repository into their local workspace</h4>
<p>This cloned copy is in the Collaborator’s GitHub account, which means they have the ability to make changes to it. But they don’t have the right to change the original owner’s copy. So instead, they <code>clone</code> their GitHub copy onto their local machine, which makes the collaborator’s GitHub copy the <code>origin</code> as far as they are concerned. In this scenario, we generally refer to the Collaborator’s repository as the remote <code>origin</code>, and the Owner’s repository as <code>upstream</code>.</p>
</section>
<section id="collaborator-makes-changes-to-forked-repository" class="level4" data-number="8.6.1.3">
<h4 data-number="8.6.1.3" class="anchored" data-anchor-id="collaborator-makes-changes-to-forked-repository"><span class="header-section-number">8.6.1.3</span> Collaborator makes changes to <code>forked</code> repository</h4>
<p>Again, these changes are independent of the Owner’s repository that the Collaborator <code>forked</code> from. When they have completed their changes, they complete the <code>Git</code> workflow and <code>push</code> the changes to their remote forked repository.</p>
<p>At this point, the Collaborator’s local repository and their GitHub copy both have the changes that they made, but the Owner’s repository has not yet been changed.</p>
<p><img src="images/git-pr-03-fork-changed.png" class="img-fluid"></p>
</section>
<section id="open-a-pull-request-to-the-upstream-repository" class="level4" data-number="8.6.1.4">
<h4 data-number="8.6.1.4" class="anchored" data-anchor-id="open-a-pull-request-to-the-upstream-repository"><span class="header-section-number">8.6.1.4</span> Open a Pull Request to the <code>upstream</code> repository</h4>
<p>Similar to the branch workflow, Collaborator submits a Pull Request (there may be be a notification on their repository from GitHub saying to compare and open a pull request). But dissimilar from the branch workflow, the Pull Request will be asking to submit changes from the Collaborator’s <code>forked</code> repository to the Owner’s <code>upstream</code> repository.</p>
<p>When the Collaborator’s visits their respository on GitHub, they will also see a message that says: <code>This branch is 1 commit ahead of mbjones:main.</code></p>
<p><img src="images/git-pr-04-config-pr.png" class="img-fluid"></p>
<p>When the Collaborator clicks the named Pull Request button to create a pull request for the Owner to review, the Collaborator can provide a brief summary of the request, and a more detailed message to start a conversation about what you are requesting. It’s helpful to be polite and concise while providing adequate context for your request. This will start a conversation with the Owner in which you can discuss your changes, they can easily review the changes, and they can ask for further changes before the accept and pull them in. The Owner of the repository is in control and determines if and when the changes are merged.</p>
<p><img src="images/git-pr-05-create-pr.png" class="img-fluid"></p>
</section>
<section id="owner-reviews-pull-request" class="level4" data-number="8.6.1.5">
<h4 data-number="8.6.1.5" class="anchored" data-anchor-id="owner-reviews-pull-request"><span class="header-section-number">8.6.1.5</span> Owner reviews Pull Request</h4>
<p>Owner will get an email or GitHub notification that the Pull Request was created, and can see the pull request listed in their “Pull requests” tab of their repository.</p>
<p><img src="images/git-pr-06-pr-list.png" class="img-fluid"></p>
<p>The Owner can initiate a conversation about the change, or request further changes. The GitHub interface indicates whether there are any conflicts with the changes, and if not, gives the Owner the option to “Merge pull request”.</p>
<p><img src="images/git-pr-07-pr-view.png" class="img-fluid"></p>
</section>
<section id="owner-merges-pull-request" class="level4" data-number="8.6.1.6">
<h4 data-number="8.6.1.6" class="anchored" data-anchor-id="owner-merges-pull-request"><span class="header-section-number">8.6.1.6</span> Owner merges Pull Request</h4>
<p>Once the Owner thinks the changes look good, they can click the “Merge pull request” button to accept the changes and pull them into their repository copy. The Owner can edit the message, and then click “Confirm merge”.</p>
<p><img src="images/git-pr-08-pr-merge.png" class="img-fluid"></p>
<p>Yay, the Pull Request has now been merged into the Owner’s copy, and has been closed with a note indicating that the changes have been made!</p>
<p><img src="images/git-pr-09-merged.png" class="img-fluid"></p>
</section>
<section id="collaborator-syncs-their-forked-repository-with-owners-repository" class="level4" data-number="8.6.1.7">
<h4 data-number="8.6.1.7" class="anchored" data-anchor-id="collaborator-syncs-their-forked-repository-with-owners-repository"><span class="header-section-number">8.6.1.7</span> Collaborator syncs their forked repository with Owner’s repository</h4>
<p>Now that the pull request has been merged, there is a new merge commit in the Owner’s repository that is not present in either of the Collaborator’s repositories. To fix that, Collaborator needs to <code>sync</code> changes from the <code>upstream</code> repository into the Collaborator’s forked repository on GitHub, and then <code>pull</code> those changes into their local repository.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/git-workflows-sync-fork.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
<div class="callout callout-style-default callout-caution no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Using <code>Git</code> in the Terminal to set and <code>pull</code> from <code>upstream</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>To add a reference to the <code>upstream</code> remote (the repository you made your fork from) run this in the Terminal: <code>git remote add upstream https://github.com/ORIGINAL_OWNER/ORIGINAL_REPOSITORY.git</code></p>
<p>Then to <code>pull</code> from the <code>main</code> branch of the <code>upstream</code> repository run in the Terminal: <code>git pull upstream main</code></p>
</div>
</div>
<p>At this point, the collaborator is fully up to date.</p>
<p>As a final overview, when working with forked pull requests, there are four copies of the git repository (2 on the GitHub server for the owner and collaborator, and two on their local machines). In this diagram, you can see that, from the collaborator’s point of view, a <code>git push</code> will affect their <code>origin</code> repository, but they also need to <code>git pull</code> from the Owner’s <code>upstream</code> repository in order to sync their changes.</p>
<p><img src="images/github-workflows-upstream.png" class="img-fluid"></p>
<p><strong>Remember: there is more than one way to do it!</strong></p>
<p>There is no one-size-fits-all Git workflow, but ultimately a workflow should be simple and enhance the productivity of your team.</p>
</section>
</section>
</section>
<section id="resources" class="level2" data-number="8.7">
<h2 data-number="8.7" class="anchored" data-anchor-id="resources"><span class="header-section-number">8.7</span> Resources</h2>
<ul>
<li><a href="https://www.atlassian.com/git/tutorials/comparing-workflows">Atlassian’s Comparing <code>Git</code> Workflows</a></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./session_07.html" class="pagination-link" aria-label="Publishing to the Web">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Publishing to the Web</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./session_09.html" class="pagination-link" aria-label="Science Communication: Message Box">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Science Communication: Message Box</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>