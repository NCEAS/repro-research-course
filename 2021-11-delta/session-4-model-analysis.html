<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Session 4: Model Analysis | Open Science Synthesis for the Delta Science Program: Week 3</title>
  <meta name="description" content="4 Session 4: Model Analysis | Open Science Synthesis for the Delta Science Program: Week 3" />
  <meta name="generator" content="bookdown 0.24.4 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Session 4: Model Analysis | Open Science Synthesis for the Delta Science Program: Week 3" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Session 4: Model Analysis | Open Science Synthesis for the Delta Science Program: Week 3" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="session-3-programmatic-metadata-and-data-access.html"/>
<link rel="next" href="session-5-shiny.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Open Science Synthesis for the Delta Science Program: Week 3</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i><b>0.1</b> Schedule</a>
<ul>
<li class="chapter" data-level="0.1.1" data-path="index.html"><a href="index.html#code-of-conduct"><i class="fa fa-check"></i><b>0.1.1</b> Code of Conduct</a></li>
<li class="chapter" data-level="0.1.2" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i><b>0.1.2</b> About this book</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="session-1-time-series-and-forecasting.html"><a href="session-1-time-series-and-forecasting.html"><i class="fa fa-check"></i><b>1</b> Session 1: Time Series and Forecasting</a>
<ul>
<li class="chapter" data-level="1.1" data-path="session-1-time-series-and-forecasting.html"><a href="session-1-time-series-and-forecasting.html#learning-objectives"><i class="fa fa-check"></i><b>1.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="1.2" data-path="session-1-time-series-and-forecasting.html"><a href="session-1-time-series-and-forecasting.html#linear-regression-with-time-as-a-predictor"><i class="fa fa-check"></i><b>1.2</b> Linear regression, with time as a predictor</a></li>
<li class="chapter" data-level="1.3" data-path="session-1-time-series-and-forecasting.html"><a href="session-1-time-series-and-forecasting.html#time-series-feature-extraction"><i class="fa fa-check"></i><b>1.3</b> Time series ‘feature extraction’</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="session-1-time-series-and-forecasting.html"><a href="session-1-time-series-and-forecasting.html#the-predict-function-forecasting-with-a-fitted-regression-model"><i class="fa fa-check"></i><b>1.3.1</b> The ‘predict’ function: forecasting with a fitted regression model</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="session-1-time-series-and-forecasting.html"><a href="session-1-time-series-and-forecasting.html#time-series-objects-in-r"><i class="fa fa-check"></i><b>1.4</b> Time Series objects in R</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="session-1-time-series-and-forecasting.html"><a href="session-1-time-series-and-forecasting.html#autocorrelation-plots"><i class="fa fa-check"></i><b>1.4.1</b> Autocorrelation plots</a></li>
<li class="chapter" data-level="1.4.2" data-path="session-1-time-series-and-forecasting.html"><a href="session-1-time-series-and-forecasting.html#seasonal-trend-with-loess-smoothing-stl-decomposition"><i class="fa fa-check"></i><b>1.4.2</b> Seasonal Trend with Loess smoothing (STL) decomposition</a></li>
<li class="chapter" data-level="1.4.3" data-path="session-1-time-series-and-forecasting.html"><a href="session-1-time-series-and-forecasting.html#now-we-can-analyze-the-trend"><i class="fa fa-check"></i><b>1.4.3</b> Now we can analyze the trend</a></li>
<li class="chapter" data-level="1.4.4" data-path="session-1-time-series-and-forecasting.html"><a href="session-1-time-series-and-forecasting.html#some-time-series-model-acronyms"><i class="fa fa-check"></i><b>1.4.4</b> Some Time Series Model Acronyms</a></li>
<li class="chapter" data-level="1.4.5" data-path="session-1-time-series-and-forecasting.html"><a href="session-1-time-series-and-forecasting.html#state-space-models"><i class="fa fa-check"></i><b>1.4.5</b> State Space Models</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="session-1-time-series-and-forecasting.html"><a href="session-1-time-series-and-forecasting.html#ecological-forecasting"><i class="fa fa-check"></i><b>1.5</b> Ecological Forecasting</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="session-1-time-series-and-forecasting.html"><a href="session-1-time-series-and-forecasting.html#forecasting-challenges"><i class="fa fa-check"></i><b>1.5.1</b> Forecasting Challenges</a></li>
<li class="chapter" data-level="1.5.2" data-path="session-1-time-series-and-forecasting.html"><a href="session-1-time-series-and-forecasting.html#the-forecasting-toolbox"><i class="fa fa-check"></i><b>1.5.2</b> The forecasting toolbox</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="session-1-time-series-and-forecasting.html"><a href="session-1-time-series-and-forecasting.html#your-turn---some-actual-data"><i class="fa fa-check"></i><b>1.6</b> Your Turn - Some Actual Data!</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="session-1-time-series-and-forecasting.html"><a href="session-1-time-series-and-forecasting.html#example-1-a-twenty-year-history-of-weather-in-maricopa-az"><i class="fa fa-check"></i><b>1.6.1</b> Example 1: A twenty year history of weather in Maricopa, AZ</a></li>
<li class="chapter" data-level="1.6.2" data-path="session-1-time-series-and-forecasting.html"><a href="session-1-time-series-and-forecasting.html#autocorrelation"><i class="fa fa-check"></i><b>1.6.2</b> Autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="session-1-time-series-and-forecasting.html"><a href="session-1-time-series-and-forecasting.html#growth-curves"><i class="fa fa-check"></i><b>1.7</b> Growth Curves</a></li>
<li class="chapter" data-level="1.8" data-path="session-1-time-series-and-forecasting.html"><a href="session-1-time-series-and-forecasting.html#references"><i class="fa fa-check"></i><b>1.8</b> References</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="session-2-web-based-data-archival.html"><a href="session-2-web-based-data-archival.html"><i class="fa fa-check"></i><b>2</b> Session 2: Web based data archival</a>
<ul>
<li class="chapter" data-level="2.1" data-path="session-2-web-based-data-archival.html"><a href="session-2-web-based-data-archival.html#best-practices-data-and-metadata"><i class="fa fa-check"></i><b>2.1</b> Best Practices: Data and Metadata</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="session-2-web-based-data-archival.html"><a href="session-2-web-based-data-archival.html#learning-objectives-1"><i class="fa fa-check"></i><b>2.1.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="2.1.2" data-path="session-2-web-based-data-archival.html"><a href="session-2-web-based-data-archival.html#best-practices-overview"><i class="fa fa-check"></i><b>2.1.2</b> Best Practices: Overview</a></li>
<li class="chapter" data-level="2.1.3" data-path="session-2-web-based-data-archival.html"><a href="session-2-web-based-data-archival.html#data-identifiers"><i class="fa fa-check"></i><b>2.1.3</b> Data Identifiers</a></li>
<li class="chapter" data-level="2.1.4" data-path="session-2-web-based-data-archival.html"><a href="session-2-web-based-data-archival.html#data-citation"><i class="fa fa-check"></i><b>2.1.4</b> Data Citation</a></li>
<li class="chapter" data-level="2.1.5" data-path="session-2-web-based-data-archival.html"><a href="session-2-web-based-data-archival.html#provanance-preserving-computational-workflows"><i class="fa fa-check"></i><b>2.1.5</b> Provanance &amp; Preserving Computational Workflows</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="session-2-web-based-data-archival.html"><a href="session-2-web-based-data-archival.html#data-documentation-and-publishing"><i class="fa fa-check"></i><b>2.2</b> Data Documentation and Publishing</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="session-2-web-based-data-archival.html"><a href="session-2-web-based-data-archival.html#learning-objectives-2"><i class="fa fa-check"></i><b>2.2.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="2.2.2" data-path="session-2-web-based-data-archival.html"><a href="session-2-web-based-data-archival.html#data-sharing-and-preservation"><i class="fa fa-check"></i><b>2.2.2</b> Data sharing and preservation</a></li>
<li class="chapter" data-level="2.2.3" data-path="session-2-web-based-data-archival.html"><a href="session-2-web-based-data-archival.html#data-repositories-built-for-data-and-code"><i class="fa fa-check"></i><b>2.2.3</b> Data repositories: built for data (and code)</a></li>
<li class="chapter" data-level="2.2.4" data-path="session-2-web-based-data-archival.html"><a href="session-2-web-based-data-archival.html#metadata"><i class="fa fa-check"></i><b>2.2.4</b> Metadata</a></li>
<li class="chapter" data-level="2.2.5" data-path="session-2-web-based-data-archival.html"><a href="session-2-web-based-data-archival.html#structure-of-a-data-package"><i class="fa fa-check"></i><b>2.2.5</b> Structure of a data package</a></li>
<li class="chapter" data-level="2.2.6" data-path="session-2-web-based-data-archival.html"><a href="session-2-web-based-data-archival.html#dataone-federation"><i class="fa fa-check"></i><b>2.2.6</b> DataONE Federation</a></li>
<li class="chapter" data-level="" data-path="session-2-web-based-data-archival.html"><a href="session-2-web-based-data-archival.html#publishing-data-from-the-web"><i class="fa fa-check"></i>Publishing data from the web</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="session-3-programmatic-metadata-and-data-access.html"><a href="session-3-programmatic-metadata-and-data-access.html"><i class="fa fa-check"></i><b>3</b> Session 3: Programmatic metadata and data access</a>
<ul>
<li class="chapter" data-level="3.1" data-path="session-3-programmatic-metadata-and-data-access.html"><a href="session-3-programmatic-metadata-and-data-access.html#reproducible-data-access"><i class="fa fa-check"></i><b>3.1</b> Reproducible Data Access</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="session-3-programmatic-metadata-and-data-access.html"><a href="session-3-programmatic-metadata-and-data-access.html#learning-objectives-3"><i class="fa fa-check"></i><b>3.1.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="3.1.2" data-path="session-3-programmatic-metadata-and-data-access.html"><a href="session-3-programmatic-metadata-and-data-access.html#barriers-to-data-access"><i class="fa fa-check"></i><b>3.1.2</b> Barriers to data access</a></li>
<li class="chapter" data-level="3.1.3" data-path="session-3-programmatic-metadata-and-data-access.html"><a href="session-3-programmatic-metadata-and-data-access.html#persistent-and-portable-data-access-for-improving-reproducibility"><i class="fa fa-check"></i><b>3.1.3</b> Persistent and portable data access for improving reproducibility</a></li>
<li class="chapter" data-level="3.1.4" data-path="session-3-programmatic-metadata-and-data-access.html"><a href="session-3-programmatic-metadata-and-data-access.html#storing-a-content-identifier-from-a-uri"><i class="fa fa-check"></i><b>3.1.4</b> Storing a content identifier from a URI</a></li>
<li class="chapter" data-level="3.1.5" data-path="session-3-programmatic-metadata-and-data-access.html"><a href="session-3-programmatic-metadata-and-data-access.html#loading-data-from-a-content-identifier"><i class="fa fa-check"></i><b>3.1.5</b> Loading data from a content identifier</a></li>
<li class="chapter" data-level="3.1.6" data-path="session-3-programmatic-metadata-and-data-access.html"><a href="session-3-programmatic-metadata-and-data-access.html#storing-and-using-local-data-identifiers"><i class="fa fa-check"></i><b>3.1.6</b> Storing and using local data identifiers</a></li>
<li class="chapter" data-level="3.1.7" data-path="session-3-programmatic-metadata-and-data-access.html"><a href="session-3-programmatic-metadata-and-data-access.html#improvements-to-content-identifiers"><i class="fa fa-check"></i><b>3.1.7</b> Improvements to content identifiers</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="session-3-programmatic-metadata-and-data-access.html"><a href="session-3-programmatic-metadata-and-data-access.html#programming-metadata-and-data-publishing"><i class="fa fa-check"></i><b>3.2</b> Programming Metadata and Data Publishing</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="session-3-programmatic-metadata-and-data-access.html"><a href="session-3-programmatic-metadata-and-data-access.html#learning-objectives-4"><i class="fa fa-check"></i><b>3.2.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="3.2.2" data-path="session-3-programmatic-metadata-and-data-access.html"><a href="session-3-programmatic-metadata-and-data-access.html#creating-metadata"><i class="fa fa-check"></i><b>3.2.2</b> Creating Metadata</a></li>
<li class="chapter" data-level="3.2.3" data-path="session-3-programmatic-metadata-and-data-access.html"><a href="session-3-programmatic-metadata-and-data-access.html#publish-data-to-the-arctic-data-center-test-site"><i class="fa fa-check"></i><b>3.2.3</b> Publish data to the Arctic Data Center test site</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="session-4-model-analysis.html"><a href="session-4-model-analysis.html"><i class="fa fa-check"></i><b>4</b> Session 4: Model Analysis</a>
<ul>
<li class="chapter" data-level="4.1" data-path="session-4-model-analysis.html"><a href="session-4-model-analysis.html#learning-objectives-5"><i class="fa fa-check"></i><b>4.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="4.2" data-path="session-4-model-analysis.html"><a href="session-4-model-analysis.html#comparing-models-to-data"><i class="fa fa-check"></i><b>4.2</b> Comparing models to data</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="session-4-model-analysis.html"><a href="session-4-model-analysis.html#statistical-tests-of-model-performance"><i class="fa fa-check"></i><b>4.2.1</b> Statistical tests of model performance</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="session-4-model-analysis.html"><a href="session-4-model-analysis.html#simulation-models"><i class="fa fa-check"></i><b>4.3</b> Simulation Models</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="session-4-model-analysis.html"><a href="session-4-model-analysis.html#example-a-leaf-level-model-of-photosynthesis"><i class="fa fa-check"></i><b>4.3.1</b> Example: A leaf level model of photosynthesis</a></li>
<li class="chapter" data-level="4.3.2" data-path="session-4-model-analysis.html"><a href="session-4-model-analysis.html#lets-run-this-model"><i class="fa fa-check"></i><b>4.3.2</b> Let’s run this model!</a></li>
<li class="chapter" data-level="4.3.3" data-path="session-4-model-analysis.html"><a href="session-4-model-analysis.html#variance-decomposition---which-of-these-parameters-are-most-important"><i class="fa fa-check"></i><b>4.3.3</b> Variance Decomposition - which of these parameters are most important?</a></li>
<li class="chapter" data-level="4.3.4" data-path="session-4-model-analysis.html"><a href="session-4-model-analysis.html#propagate-met-and-use-met-as-a-variable-sample-over-variation-within-the-hour"><i class="fa fa-check"></i><b>4.3.4</b> Propagate met and Use met as a variable, sample over variation within the hour</a></li>
<li class="chapter" data-level="4.3.5" data-path="session-4-model-analysis.html"><a href="session-4-model-analysis.html#references-1"><i class="fa fa-check"></i><b>4.3.5</b> References</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="session-5-shiny.html"><a href="session-5-shiny.html"><i class="fa fa-check"></i><b>5</b> Session 5: Shiny</a>
<ul>
<li class="chapter" data-level="5.1" data-path="session-5-shiny.html"><a href="session-5-shiny.html#introduction-to-shiny"><i class="fa fa-check"></i><b>5.1</b> Introduction to Shiny</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="session-5-shiny.html"><a href="session-5-shiny.html#learning-objectives-6"><i class="fa fa-check"></i><b>5.1.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="5.1.2" data-path="session-5-shiny.html"><a href="session-5-shiny.html#overview"><i class="fa fa-check"></i><b>5.1.2</b> Overview</a></li>
<li class="chapter" data-level="5.1.3" data-path="session-5-shiny.html"><a href="session-5-shiny.html#create-a-sample-shiny-application"><i class="fa fa-check"></i><b>5.1.3</b> Create a sample shiny application</a></li>
<li class="chapter" data-level="5.1.4" data-path="session-5-shiny.html"><a href="session-5-shiny.html#shiny-architecture"><i class="fa fa-check"></i><b>5.1.4</b> Shiny architecture</a></li>
<li class="chapter" data-level="5.1.5" data-path="session-5-shiny.html"><a href="session-5-shiny.html#interactive-scatterplots"><i class="fa fa-check"></i><b>5.1.5</b> Interactive scatterplots</a></li>
<li class="chapter" data-level="5.1.6" data-path="session-5-shiny.html"><a href="session-5-shiny.html#extending-the-user-interface-with-dynamic-plots"><i class="fa fa-check"></i><b>5.1.6</b> Extending the user interface with dynamic plots</a></li>
<li class="chapter" data-level="5.1.7" data-path="session-5-shiny.html"><a href="session-5-shiny.html#finishing-touches-data-citation"><i class="fa fa-check"></i><b>5.1.7</b> Finishing touches: data citation</a></li>
<li class="chapter" data-level="5.1.8" data-path="session-5-shiny.html"><a href="session-5-shiny.html#publishing-shiny-applications"><i class="fa fa-check"></i><b>5.1.8</b> Publishing Shiny applications</a></li>
<li class="chapter" data-level="5.1.9" data-path="session-5-shiny.html"><a href="session-5-shiny.html#summary"><i class="fa fa-check"></i><b>5.1.9</b> Summary</a></li>
<li class="chapter" data-level="5.1.10" data-path="session-5-shiny.html"><a href="session-5-shiny.html#full-source-code-for-the-final-application"><i class="fa fa-check"></i><b>5.1.10</b> Full source code for the final application</a></li>
<li class="chapter" data-level="5.1.11" data-path="session-5-shiny.html"><a href="session-5-shiny.html#a-shinier-app-with-tabs-and-a-map"><i class="fa fa-check"></i><b>5.1.11</b> A shinier app with tabs and a map!</a></li>
<li class="chapter" data-level="5.1.12" data-path="session-5-shiny.html"><a href="session-5-shiny.html#resources"><i class="fa fa-check"></i><b>5.1.12</b> Resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html"><i class="fa fa-check"></i><b>6</b> Session 6: Reproducible workflows revisited</a>
<ul>
<li class="chapter" data-level="6.1" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#workflows-and-continuous-integration"><i class="fa fa-check"></i><b>6.1</b> Workflows and Continuous Integration</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#learning-outcomes"><i class="fa fa-check"></i><b>6.1.1</b> Learning Outcomes</a></li>
<li class="chapter" data-level="6.1.2" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#introduction"><i class="fa fa-check"></i><b>6.1.2</b> Introduction</a></li>
<li class="chapter" data-level="6.1.3" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#workflow-dependencies-and-encapsulation"><i class="fa fa-check"></i><b>6.1.3</b> Workflow dependencies and encapsulation</a></li>
<li class="chapter" data-level="" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#dependencies"><i class="fa fa-check"></i>Dependencies</a></li>
<li class="chapter" data-level="6.1.4" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#benefits"><i class="fa fa-check"></i><b>6.1.4</b> Benefits</a></li>
<li class="chapter" data-level="6.1.5" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#organizing-code-in-packages"><i class="fa fa-check"></i><b>6.1.5</b> Organizing code in packages</a></li>
<li class="chapter" data-level="6.1.6" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#workflow-systems"><i class="fa fa-check"></i><b>6.1.6</b> Workflow systems</a></li>
<li class="chapter" data-level="6.1.7" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#exercise"><i class="fa fa-check"></i><b>6.1.7</b> Exercise</a></li>
<li class="chapter" data-level="6.1.8" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#readings-and-tutorials"><i class="fa fa-check"></i><b>6.1.8</b> Readings and tutorials</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#parallel-computing-in-r"><i class="fa fa-check"></i><b>6.2</b> Parallel Computing in R</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#learning-outcomes-1"><i class="fa fa-check"></i><b>6.2.1</b> Learning Outcomes</a></li>
<li class="chapter" data-level="6.2.2" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#introduction-1"><i class="fa fa-check"></i><b>6.2.2</b> Introduction</a></li>
<li class="chapter" data-level="6.2.3" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#why-parallelism"><i class="fa fa-check"></i><b>6.2.3</b> Why parallelism?</a></li>
<li class="chapter" data-level="6.2.4" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#processors-cpus-and-cores"><i class="fa fa-check"></i><b>6.2.4</b> Processors (CPUs) and Cores</a></li>
<li class="chapter" data-level="6.2.5" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#when-to-parallelize"><i class="fa fa-check"></i><b>6.2.5</b> When to parallelize</a></li>
<li class="chapter" data-level="6.2.6" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#loops-and-repetitive-tasks-using-lapply"><i class="fa fa-check"></i><b>6.2.6</b> Loops and repetitive tasks using lapply</a></li>
<li class="chapter" data-level="6.2.7" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#approaches-to-parallelization"><i class="fa fa-check"></i><b>6.2.7</b> Approaches to parallelization</a></li>
<li class="chapter" data-level="6.2.8" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#parallelize-using-mclapply"><i class="fa fa-check"></i><b>6.2.8</b> Parallelize using: mclapply</a></li>
<li class="chapter" data-level="6.2.9" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#parallelize-using-foreach-and-doparallel"><i class="fa fa-check"></i><b>6.2.9</b> Parallelize using: foreach and doParallel</a></li>
<li class="chapter" data-level="6.2.10" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#summary-1"><i class="fa fa-check"></i><b>6.2.10</b> Summary</a></li>
<li class="chapter" data-level="6.2.11" data-path="session-6-reproducible-workflows-revisited.html"><a href="session-6-reproducible-workflows-revisited.html#readings-and-tutorials-1"><i class="fa fa-check"></i><b>6.2.11</b> Readings and tutorials</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="session-7-communicating-your-research-the-message-box.html"><a href="session-7-communicating-your-research-the-message-box.html"><i class="fa fa-check"></i><b>7</b> Session 7: Communicating Your Research: The Message Box</a>
<ul>
<li class="chapter" data-level="7.1" data-path="session-7-communicating-your-research-the-message-box.html"><a href="session-7-communicating-your-research-the-message-box.html#communication-principles-and-practices"><i class="fa fa-check"></i><b>7.1</b> Communication Principles and Practices</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="session-7-communicating-your-research-the-message-box.html"><a href="session-7-communicating-your-research-the-message-box.html#scholarly-publications"><i class="fa fa-check"></i><b>7.1.1</b> Scholarly publications</a></li>
<li class="chapter" data-level="7.1.2" data-path="session-7-communicating-your-research-the-message-box.html"><a href="session-7-communicating-your-research-the-message-box.html#other-communications"><i class="fa fa-check"></i><b>7.1.2</b> Other communications</a></li>
<li class="chapter" data-level="7.1.3" data-path="session-7-communicating-your-research-the-message-box.html"><a href="session-7-communicating-your-research-the-message-box.html#the-message-box"><i class="fa fa-check"></i><b>7.1.3</b> The Message Box</a></li>
<li class="chapter" data-level="7.1.4" data-path="session-7-communicating-your-research-the-message-box.html"><a href="session-7-communicating-your-research-the-message-box.html#resources-1"><i class="fa fa-check"></i><b>7.1.4</b> Resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="session-8-wrap-up.html"><a href="session-8-wrap-up.html"><i class="fa fa-check"></i><b>8</b> Session 8: Wrap Up</a>
<ul>
<li class="chapter" data-level="8.0.1" data-path="session-8-wrap-up.html"><a href="session-8-wrap-up.html#material-to-include"><i class="fa fa-check"></i><b>8.0.1</b> Material to include:</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="session-9-one-day-workshop.html"><a href="session-9-one-day-workshop.html"><i class="fa fa-check"></i><b>9</b> Session 9: One-day workshop</a>
<ul>
<li class="chapter" data-level="9.1" data-path="session-9-one-day-workshop.html"><a href="session-9-one-day-workshop.html#spatial-vector-analysis-using-sf"><i class="fa fa-check"></i><b>9.1</b> Spatial vector analysis using <code>sf</code></a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="session-9-one-day-workshop.html"><a href="session-9-one-day-workshop.html#learning-objectives-7"><i class="fa fa-check"></i><b>9.1.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="9.1.2" data-path="session-9-one-day-workshop.html"><a href="session-9-one-day-workshop.html#introduction-2"><i class="fa fa-check"></i><b>9.1.2</b> Introduction</a></li>
<li class="chapter" data-level="9.1.3" data-path="session-9-one-day-workshop.html"><a href="session-9-one-day-workshop.html#working-with-geospatial-data"><i class="fa fa-check"></i><b>9.1.3</b> Working with geospatial data</a></li>
<li class="chapter" data-level="9.1.4" data-path="session-9-one-day-workshop.html"><a href="session-9-one-day-workshop.html#sf-the-tidyverse"><i class="fa fa-check"></i><b>9.1.4</b> <code>sf</code> &amp; the Tidyverse</a></li>
<li class="chapter" data-level="9.1.5" data-path="session-9-one-day-workshop.html"><a href="session-9-one-day-workshop.html#visualize-with-ggplot"><i class="fa fa-check"></i><b>9.1.5</b> Visualize with ggplot</a></li>
<li class="chapter" data-level="9.1.6" data-path="session-9-one-day-workshop.html"><a href="session-9-one-day-workshop.html#visualize-sf-objects-with-leaflet"><i class="fa fa-check"></i><b>9.1.6</b> Visualize <code>sf</code> objects with leaflet</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Open Science Synthesis for the Delta Science Program: Week 3</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="session-4-model-analysis" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Session 4: Model Analysis</h1>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="session-4-model-analysis.html#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(daymetr)</span>
<span id="cb161-2"><a href="session-4-model-analysis.html#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb161-3"><a href="session-4-model-analysis.html#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb161-4"><a href="session-4-model-analysis.html#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb161-5"><a href="session-4-model-analysis.html#cb161-5" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<div id="learning-objectives-5" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Learning Objectives</h2>
<p>Today you will learn to</p>
<ul>
<li>Use visual and statistical approaches to compare model output to data</li>
<li>Investigate the relationships between model inputs and outputs using sensitivity analysis and variance decomposition</li>
</ul>
</div>
<div id="comparing-models-to-data" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Comparing models to data</h2>
<p>DayMet is a gridded weather data product. It provides daily weather statistics for North America on a
1 km grid. The primary input to DayMet is data from weather stations. Using a number of statistical methods, values for each square on the grid are imputed.</p>
<p>Today we are going to use these as our ‘model’, and we are going to compare the output of this model
to data from a weather station in Maricopa, AZ.</p>
<p>Lets download the daily weather data from DayMet:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="session-4-model-analysis.html#cb162-1" aria-hidden="true" tabindex="-1"></a>mac_daymet_list <span class="ot">&lt;-</span> <span class="fu">download_daymet</span>(<span class="at">site =</span> <span class="st">&quot;Maricopa Agricultural Center&quot;</span>,</span>
<span id="cb162-2"><a href="session-4-model-analysis.html#cb162-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">lat =</span> <span class="fl">33.07</span>,</span>
<span id="cb162-3"><a href="session-4-model-analysis.html#cb162-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">lon =</span>  <span class="sc">-</span><span class="fl">111.97</span>,</span>
<span id="cb162-4"><a href="session-4-model-analysis.html#cb162-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">start =</span> <span class="dv">2020</span>,</span>
<span id="cb162-5"><a href="session-4-model-analysis.html#cb162-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">end =</span> <span class="dv">2020</span>, </span>
<span id="cb162-6"><a href="session-4-model-analysis.html#cb162-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">internal =</span> <span class="cn">TRUE</span>) </span></code></pre></div>
<pre><code>## Downloading DAYMET data for: Maricopa Agricultural Center at 33.07/-111.97 latitude/longitude !</code></pre>
<pre><code>## Done !</code></pre>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="session-4-model-analysis.html#cb165-1" aria-hidden="true" tabindex="-1"></a>mac_daymet <span class="ot">&lt;-</span> mac_daymet_list<span class="sc">$</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb165-2"><a href="session-4-model-analysis.html#cb165-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tmin =</span> tmin..deg.c., <span class="at">tmax =</span>  tmax..deg.c., <span class="at">tmean =</span> (tmin <span class="sc">+</span> tmax)  <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb165-3"><a href="session-4-model-analysis.html#cb165-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">doy =</span> yday, tmean, tmax, tmin)</span></code></pre></div>
<p>Before we look at the ground truth, lets visualize these outputs and assess them for meaning.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="session-4-model-analysis.html#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mac_daymet, <span class="fu">aes</span>(doy, tmean)) <span class="sc">+</span></span>
<span id="cb166-2"><a href="session-4-model-analysis.html#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb166-3"><a href="session-4-model-analysis.html#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="reproducible-research-short-course_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<p>Lets get some truth to compare our model to data measured at a weather station.</p>
<p>The AZMet data format is described here: <a href="https://cals.arizona.edu/azmet/raw2003.htm" class="uri">https://cals.arizona.edu/azmet/raw2003.htm</a>. On that page you can see that these are the columns we are interested in:</p>
<table>
<thead>
<tr class="header">
<th align="left">col</th>
<th align="left">variable</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2</td>
<td align="left">day of year</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">max temperature</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">min temperature</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="left">mean temperature</td>
</tr>
</tbody>
</table>
<p>We can read in the data and rename the columns of interest in the following steps:</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="session-4-model-analysis.html#cb167-1" aria-hidden="true" tabindex="-1"></a>mac_azmet <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;https://cals.arizona.edu/azmet/data/0621rd.txt&#39;</span>, <span class="at">header =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb167-2"><a href="session-4-model-analysis.html#cb167-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">doy =</span> V2, <span class="at">tmean =</span> V6, <span class="at">tmax =</span> V4, <span class="at">tmin =</span> V5)</span></code></pre></div>
<p>Now, lets join the data frames. We will use the suffix to identify model (DayMet) and observed station (AZMet) data.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="session-4-model-analysis.html#cb168-1" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> mac_daymet <span class="sc">%&gt;%</span> </span>
<span id="cb168-2"><a href="session-4-model-analysis.html#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mac_azmet, <span class="at">by =</span> <span class="st">&#39;doy&#39;</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&#39;_model&#39;</span>, <span class="st">&#39;_obs&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb168-3"><a href="session-4-model-analysis.html#cb168-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(tmean_obs))</span>
<span id="cb168-4"><a href="session-4-model-analysis.html#cb168-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-5"><a href="session-4-model-analysis.html#cb168-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(comparison)</span></code></pre></div>
<pre><code>##   doy tmean_model tmax_model tmin_model tmean_obs tmax_obs tmin_obs
## 1   1        9.04       16.1       1.98       7.7     18.7     -1.1
## 2   2        9.97       17.0       2.94       7.5     17.9     -1.9
## 3   3       10.09       18.0       2.16       7.3     18.7     -1.6
## 4   4       11.22       19.9       2.57       8.7     21.1     -1.1
## 5   5       11.44       20.3       2.58      10.4     21.4      1.0
## 6   6       12.25       21.3       3.23       9.4     20.7     -0.5</code></pre>
<p>Just looking at the table, what do you notice about the observed and modeled temperatures?</p>
<details>
<ul>
<li>looks like the tmax observed is generally higher and tmin is generally lower!</li>
<li>the station observed five days below freezing in the first six days of the year!</li>
</ul>
</details>
<p>Now, lets see how the model and data compare:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="session-4-model-analysis.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> comparison) <span class="sc">+</span> </span>
<span id="cb170-2"><a href="session-4-model-analysis.html#cb170-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(doy, tmean_model)) <span class="sc">+</span> </span>
<span id="cb170-3"><a href="session-4-model-analysis.html#cb170-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(doy, tmin_model), <span class="at">color =</span> <span class="st">&#39;grey&#39;</span>) <span class="sc">+</span> </span>
<span id="cb170-4"><a href="session-4-model-analysis.html#cb170-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(doy, tmax_model), <span class="at">color =</span> <span class="st">&#39;grey&#39;</span>) <span class="sc">+</span></span>
<span id="cb170-5"><a href="session-4-model-analysis.html#cb170-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(doy, tmean_obs), <span class="at">color =</span> <span class="st">&#39;red&#39;</span>) <span class="sc">+</span> </span>
<span id="cb170-6"><a href="session-4-model-analysis.html#cb170-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(doy, tmin_obs), <span class="at">color =</span> <span class="st">&#39;pink&#39;</span>) <span class="sc">+</span> </span>
<span id="cb170-7"><a href="session-4-model-analysis.html#cb170-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(doy, tmax_obs), <span class="at">color =</span> <span class="st">&#39;pink&#39;</span>) </span></code></pre></div>
<p><img src="reproducible-research-short-course_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="session-4-model-analysis.html#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> comparison) <span class="sc">+</span> </span>
<span id="cb171-2"><a href="session-4-model-analysis.html#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(doy, tmean_model <span class="sc">-</span> tmean_obs))</span></code></pre></div>
<p><img src="reproducible-research-short-course_files/figure-html/unnamed-chunk-78-2.png" width="672" /></p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="session-4-model-analysis.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> comparison) <span class="sc">+</span> </span>
<span id="cb172-2"><a href="session-4-model-analysis.html#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(tmean_model, tmean_obs)) <span class="sc">+</span></span>
<span id="cb172-3"><a href="session-4-model-analysis.html#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb172-4"><a href="session-4-model-analysis.html#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">40</span>) <span class="sc">+</span></span>
<span id="cb172-5"><a href="session-4-model-analysis.html#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">40</span>)</span></code></pre></div>
<p><img src="reproducible-research-short-course_files/figure-html/unnamed-chunk-78-3.png" width="672" /></p>
<div id="statistical-tests-of-model-performance" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Statistical tests of model performance</h3>
<p>We are going to talk about a set of key metrics for comparing models to data:</p>
<p>Slope, RMSE, R^2, Bias, SD ratio</p>
<div id="slope" class="section level4" number="4.2.1.1">
<h4><span class="header-section-number">4.2.1.1</span> Slope</h4>
<p>The slope of regression of predicted on observed: <span class="math inline">\(Y_{obs}= bY_{mod}+\epsilon\)</span>. Does slope <span class="math inline">\(b=1\)</span>?</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="session-4-model-analysis.html#cb173-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> comparison<span class="sc">$</span>tmean_model</span>
<span id="cb173-2"><a href="session-4-model-analysis.html#cb173-2" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">&lt;-</span> comparison<span class="sc">$</span>tmean_obs</span>
<span id="cb173-3"><a href="session-4-model-analysis.html#cb173-3" aria-hidden="true" tabindex="-1"></a>reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(obs<span class="sc">~</span> mod)</span>
<span id="cb173-4"><a href="session-4-model-analysis.html#cb173-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-5"><a href="session-4-model-analysis.html#cb173-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod, obs, <span class="at">xlab =</span> <span class="st">&#39;model tmean&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;obs tmean&#39;</span>) <span class="sc">+</span></span>
<span id="cb173-6"><a href="session-4-model-analysis.html#cb173-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb173-7"><a href="session-4-model-analysis.html#cb173-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">coef</span>(reg), <span class="at">lty =</span> <span class="dv">2</span>) </span></code></pre></div>
<p><img src="reproducible-research-short-course_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
<pre><code>## integer(0)</code></pre>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="session-4-model-analysis.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(reg)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = obs ~ mod)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -10.194  -2.682  -0.295   2.338  10.197 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   2.3081     0.5647    4.09  5.4e-05 ***
## mod           0.8441     0.0223   37.91  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.81 on 363 degrees of freedom
## Multiple R-squared:  0.798,  Adjusted R-squared:  0.798 
## F-statistic: 1.44e+03 on 1 and 363 DF,  p-value: &lt;2e-16</code></pre>
<p>Does the regression model includes the 1:1 line? Why is the P-value so low?</p>
<details>
because the default hypothesis test is that the slope is different than 0, not different than 1
</details>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="session-4-model-analysis.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(reg)</span></code></pre></div>
<pre><code>## (Intercept)         mod 
##       2.308       0.844</code></pre>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="session-4-model-analysis.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(reg)</span></code></pre></div>
<pre><code>##             2.5 % 97.5 %
## (Intercept)   1.2  3.418
## mod           0.8  0.888</code></pre>
<p>Is the slope 1:1?</p>
<p>What about for tmin and tmax?</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="session-4-model-analysis.html#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(tmin_obs <span class="sc">~</span> tmin_model, <span class="at">data =</span> comparison))</span>
<span id="cb181-2"><a href="session-4-model-analysis.html#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(tmax_obs <span class="sc">~</span> tmax_model, <span class="at">data =</span> comparison))</span></code></pre></div>
</div>
<div id="rmse-root-mean-square-error" class="section level4" number="4.2.1.2">
<h4><span class="header-section-number">4.2.1.2</span> RMSE Root Mean Square Error</h4>
<p>This is the most common model metric. It is the standard deviation of the residuals.</p>
<p><span class="math display">\[RMSE=\sqrt{\frac{1}{n}(Y_{model}-Y_{obs})^2}\]</span></p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="session-4-model-analysis.html#cb182-1" aria-hidden="true" tabindex="-1"></a>RMSE <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((mod <span class="sc">-</span> obs)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb182-2"><a href="session-4-model-analysis.html#cb182-2" aria-hidden="true" tabindex="-1"></a>RMSE  </span></code></pre></div>
<pre><code>## [1] 4.28</code></pre>
<p>Sometimes you want a “Normalized” estimate of model error. That way the magnitude of the
error is on the same scale as the observations. There are many ways to do this, a
common approach is to divide by the mean of the observations. <span class="math inline">\(NRMSE=RMSE/\bar{Y}_{obs}\)</span> is equivalent to coefficient of variance <span class="math inline">\(CV=\frac{\sigma}{\bar{x}}\)</span>.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="session-4-model-analysis.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="do">## to normalize, divide by sd(obs) </span></span>
<span id="cb184-2"><a href="session-4-model-analysis.html#cb184-2" aria-hidden="true" tabindex="-1"></a>NRMSE <span class="ot">&lt;-</span> RMSE<span class="sc">/</span><span class="fu">sd</span>(obs)</span></code></pre></div>
<p>Other approaches to normalization:</p>
<ul>
<li><span class="math inline">\(RMSE/sd(obs)\)</span></li>
<li><span class="math inline">\(RMSE/\bar{Y_{obs}}\)</span></li>
<li><span class="math inline">\(RMSE/IQR\)</span></li>
</ul>
</div>
<div id="r2-corellation-coefficient" class="section level4" number="4.2.1.3">
<h4><span class="header-section-number">4.2.1.3</span> <span class="math inline">\(R^2\)</span> Corellation Coefficient</h4>
<p>When comparing models to data, it is common to calculate the Correlation Coefficient in terms of deviation from the 1:1 line</p>
<p><span class="math display">\[R^2=1-\frac{\sum{(Y_{mod}-Y_{obs})^2}}{\sum{(Y_{obs}-\bar{Y}_{obs})^2}}\]</span></p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="session-4-model-analysis.html#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(mod, obs)</span></code></pre></div>
<pre><code>## [1] 0.894</code></pre>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="session-4-model-analysis.html#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(mod, obs)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  mod and obs
## t = 38, df = 363, p-value &lt;2e-16
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.871 0.912
## sample estimates:
##   cor 
## 0.894</code></pre>
</div>
<div id="bias" class="section level4" number="4.2.1.4">
<h4><span class="header-section-number">4.2.1.4</span> Bias</h4>
<p>Do you over or under predict?</p>
<p><span class="math display">\[Y_{model}-Y_{obs}\]</span></p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="session-4-model-analysis.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(mod <span class="sc">-</span> obs)</span></code></pre></div>
<pre><code>## [1] 1.39</code></pre>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="session-4-model-analysis.html#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># normalized</span></span>
<span id="cb191-2"><a href="session-4-model-analysis.html#cb191-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3"><a href="session-4-model-analysis.html#cb191-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(mod <span class="sc">-</span> obs)<span class="sc">/</span><span class="fu">mean</span>(obs)</span></code></pre></div>
<pre><code>## [1] 0.0623</code></pre>
<p>It is also useful to visualize and compute statistics on these differences.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="session-4-model-analysis.html#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(mod<span class="sc">-</span>obs)</span></code></pre></div>
<p><img src="reproducible-research-short-course_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p>
<p>What fraction of the time is the model above the observation?</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="session-4-model-analysis.html#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(mod <span class="sc">&gt;</span> obs) <span class="sc">/</span> <span class="fu">length</span>(obs)</span></code></pre></div>
<pre><code>## [1] 0.655</code></pre>
</div>
<div id="ratio-of-variances" class="section level4" number="4.2.1.5">
<h4><span class="header-section-number">4.2.1.5</span> Ratio of variances</h4>
<p>Does the model capture the observed variance? Often a model will have lower variances … why?</p>
<p><span class="math display">\[\frac{SD_{Y_{model}}}{SD_{Y_{obs}}}\]</span></p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="session-4-model-analysis.html#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(obs) <span class="sc">/</span> <span class="fu">sd</span>(mod)</span></code></pre></div>
<pre><code>## [1] 0.945</code></pre>
</div>
<div id="taylor-diagram---three-metrics-in-two-dimensions" class="section level4" number="4.2.1.6">
<h4><span class="header-section-number">4.2.1.6</span> Taylor Diagram - three metrics in two dimensions</h4>
<p>A Taylor Diagram allows you to plot three metrics of model performance - the RMSE, R^2, and SD ratio in two dimensions, taking advantage of the mathematical relationships among these scores.</p>
<p>It is common to plot multiple points representing different models or model parameterizations, also different years or locations that the model is evaluated at. Plotting these as normalized values allows comparison across variables being predicted.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="session-4-model-analysis.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotrix)</span>
<span id="cb198-2"><a href="session-4-model-analysis.html#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="fu">taylor.diagram</span>(<span class="at">ref=</span>obs, <span class="at">model =</span> mod, <span class="at">normalize =</span> <span class="cn">TRUE</span>, <span class="at">ref.sd =</span> <span class="cn">TRUE</span>) </span></code></pre></div>
<p><img src="images/taylor_plot.png" /></p>
</div>
</div>
</div>
<div id="simulation-models" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Simulation Models</h2>
<p>Yesterday I introduced the concept and application of simulation models, with examples related to simulating plant growth. In a regression model, it is often possible to see how each parameter relates to the model output (e.g. slope, intercept).</p>
<p>For a complex model, it is often not possible to understand the high level dynamics of the system by analyzing the mathematics. Another approach is to treat the model as a ‘black box’. Then we can treat the black box as an experimental system, purturb it and see how it responds.</p>
<p>Lets look at this in more detail.</p>
<div id="example-a-leaf-level-model-of-photosynthesis" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Example: A leaf level model of photosynthesis</h3>
<p>Based on the coupled C4 photosynthesis - conductance model developed by Collatz and Ball Berry</p>
<blockquote>
<p>G. Collatz, M. Ribas-Carbo, J. Berry. (1992). Coupled photosynthesis-stomatal conductance model for leaves of C4 plants. Australian Journal of Plant Physiology 519–538.</p>
</blockquote>
<p>Water transpiration is coupled to photosynthesis through stomatal conductance, since plants need to regulate water loss as they uptake <span class="math inline">\(CO_2\)</span>:</p>
<p><span class="math display">\[g_s = m\frac{A_n h_s}{c_a}p + b\]</span></p>
<p>Where <span class="math inline">\(g_s\)</span> is stomatal conducatnce, <span class="math inline">\(A_n\)</span> is net photosynthesis, <span class="math inline">\(h_s\)</span> is relative humidity, <span class="math inline">\(c_a\)</span> is <span class="math inline">\(CO_2\)</span> at leaf surface.</p>
<p>and Photosynthesis is</p>
<p><span class="math display">\[A_n=min(A_c, A_L)-R_d\]</span>
Where Rubisco-limited rate is <span class="math inline">\(A_c\)</span> and RuBP limited rate is <span class="math inline">\(A_L\)</span></p>
<p><span class="math display">\[A_c=V_m\left[\frac{c_i-\Gamma}{c_i+K_c(1+O_2/K_o)}\right]\]</span></p>
<p><span class="math display">\[A_L=\]</span>
This is a non-linear equation with key plant physiological traits:</p>
<table>
<colgroup>
<col width="45%" />
<col width="54%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Vmax</strong></td>
<td align="left">maximum carboxylation of Rubisco according to the Collatz model.</td>
</tr>
<tr class="even">
<td align="left">alpha</td>
<td align="left">alpha parameter according to the Collatz model. Initial slope of the response to Irradiance.</td>
</tr>
<tr class="odd">
<td align="left">kparm</td>
<td align="left">k parameter according to the Collatz model. Initial slope of the response to CO2.</td>
</tr>
<tr class="even">
<td align="left">theta</td>
<td align="left">theta parameter according to the Collatz model. Curvature for light response.</td>
</tr>
<tr class="odd">
<td align="left">beta</td>
<td align="left">beta parameter according to the Collatz model. Curvature for response to CO2.</td>
</tr>
<tr class="even">
<td align="left"><strong>Rd</strong></td>
<td align="left">Rd parameter according to the Collatz model. Dark respiration.</td>
</tr>
<tr class="odd">
<td align="left"><strong>b0</strong></td>
<td align="left">intercept for the Ball-Berry stomatal conductance model.</td>
</tr>
<tr class="even">
<td align="left">b1</td>
<td align="left">slope for the Ball-Berry stomatal conductance model.</td>
</tr>
</tbody>
</table>
<p>The rate of photosynthesis is determined by environmental factors:</p>
<table>
<colgroup>
<col width="45%" />
<col width="54%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Tl</td>
<td align="left">temperature of the leaf (Celsius).</td>
</tr>
<tr class="even">
<td align="left">RH</td>
<td align="left">relative humidity (as a fraction, i.e. 0-1).</td>
</tr>
<tr class="odd">
<td align="left">Qp</td>
<td align="left">quantum flux (direct light), (micro mol m-2 s-1).</td>
</tr>
<tr class="even">
<td align="left">Catm</td>
<td align="left">Atmospheric CO2 in ppm (or micromol/mol).</td>
</tr>
</tbody>
</table>
<p>In the end:</p>
<p><span class="math display">\[[Gs, A, C_i]=f(T, RH, Light, CO_2, v_{max}, \alpha, k, \theta, R_d, b_0, b_1)\]</span></p>
</div>
<div id="lets-run-this-model" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Let’s run this model!</h3>
<p>First, lets load some meteorological data:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="session-4-model-analysis.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BioCro) <span class="co">#devtools::install_github(&#39;ebimodeling/biocro&#39;)</span></span>
<span id="cb199-2"><a href="session-4-model-analysis.html#cb199-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb199-3"><a href="session-4-model-analysis.html#cb199-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb199-4"><a href="session-4-model-analysis.html#cb199-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-5"><a href="session-4-model-analysis.html#cb199-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-6"><a href="session-4-model-analysis.html#cb199-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;weather04&quot;</span>)</span>
<span id="cb199-7"><a href="session-4-model-analysis.html#cb199-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-8"><a href="session-4-model-analysis.html#cb199-8" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">&#39;2004-01-01&#39;</span>) <span class="sc">+</span> <span class="fu">days</span>(weather04<span class="sc">$</span>doy<span class="dv">-1</span>) <span class="sc">+</span> <span class="fu">hours</span>(weather04<span class="sc">$</span>hour)</span>
<span id="cb199-9"><a href="session-4-model-analysis.html#cb199-9" aria-hidden="true" tabindex="-1"></a>par <span class="ot">&lt;-</span> weather04<span class="sc">$</span>solarR</span>
<span id="cb199-10"><a href="session-4-model-analysis.html#cb199-10" aria-hidden="true" tabindex="-1"></a>rh <span class="ot">&lt;-</span> weather04<span class="sc">$</span>RH</span>
<span id="cb199-11"><a href="session-4-model-analysis.html#cb199-11" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> weather04<span class="sc">$</span>DailyTemp.C</span></code></pre></div>
<p>Now, estimate photosynthesis rate at each time step. This is isn’t the entire model - just what would be happening to the leaf of a plant with C4 photosynthesis in full sunlight.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="session-4-model-analysis.html#cb200-1" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">c4photo</span>(<span class="at">Qp =</span> par, <span class="at">Tl =</span> temp, <span class="at">RH =</span> rh)<span class="sc">$</span>Assim</span>
<span id="cb200-2"><a href="session-4-model-analysis.html#cb200-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-3"><a href="session-4-model-analysis.html#cb200-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="fu">data.frame</span>(A, par, temp, rh))</span></code></pre></div>
<p><img src="reproducible-research-short-course_files/figure-html/unnamed-chunk-90-1.png" width="672" /></p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="session-4-model-analysis.html#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="do">## whoa this is wierd! What is going on?</span></span>
<span id="cb201-2"><a href="session-4-model-analysis.html#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(temp, rh)</span></code></pre></div>
<p><img src="reproducible-research-short-course_files/figure-html/unnamed-chunk-91-1.png" width="672" /></p>
<details>
<p>a strange scaling algorithm, interpolating from daily to hourly</p>
see also <a href="https://rpubs.com/dlebauer/metdriver_comparisons" class="uri">https://rpubs.com/dlebauer/metdriver_comparisons</a>
</details>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="session-4-model-analysis.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb202-2"><a href="session-4-model-analysis.html#cb202-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb202-3"><a href="session-4-model-analysis.html#cb202-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(time, A)) <span class="sc">+</span></span>
<span id="cb202-4"><a href="session-4-model-analysis.html#cb202-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_datetime</span>(<span class="at">limits =</span> <span class="fu">ymd_h</span>(<span class="fu">c</span>(<span class="st">&#39;2004-05-01 0&#39;</span>, <span class="st">&#39;2004-06-01 23&#39;</span>)))</span></code></pre></div>
<pre><code>## Warning: Removed 7992 row(s) containing missing values (geom_path).</code></pre>
<p><img src="reproducible-research-short-course_files/figure-html/unnamed-chunk-92-1.png" width="672" /></p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="session-4-model-analysis.html#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb204-2"><a href="session-4-model-analysis.html#cb204-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(time, rh)) <span class="sc">+</span></span>
<span id="cb204-3"><a href="session-4-model-analysis.html#cb204-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_datetime</span>(<span class="at">limits =</span> <span class="fu">ymd_h</span>(<span class="fu">c</span>(<span class="st">&#39;2004-05-01 0&#39;</span>, <span class="st">&#39;2004-06-01 23&#39;</span>)))</span></code></pre></div>
<pre><code>## Warning: Removed 7992 row(s) containing missing values (geom_path).</code></pre>
<p><img src="reproducible-research-short-course_files/figure-html/unnamed-chunk-92-2.png" width="672" /></p>
<blockquote>
<p>question: is f(mean(X)) = mean(f(X))?</p>
</blockquote>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="session-4-model-analysis.html#cb206-1" aria-hidden="true" tabindex="-1"></a>testQp <span class="ot">&lt;-</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">20</span><span class="sc">*</span><span class="dv">100</span></span>
<span id="cb206-2"><a href="session-4-model-analysis.html#cb206-2" aria-hidden="true" tabindex="-1"></a>testTl <span class="ot">&lt;-</span> <span class="dv">21</span><span class="sc">:</span><span class="dv">30</span></span>
<span id="cb206-3"><a href="session-4-model-analysis.html#cb206-3" aria-hidden="true" tabindex="-1"></a>testRH <span class="ot">&lt;-</span> <span class="dv">21</span><span class="sc">:</span><span class="dv">30</span><span class="sc">/</span><span class="dv">50</span></span>
<span id="cb206-4"><a href="session-4-model-analysis.html#cb206-4" aria-hidden="true" tabindex="-1"></a>A1 <span class="ot">&lt;-</span> <span class="fu">c4photo</span>(<span class="at">Qp =</span> <span class="fu">mean</span>(testQp),</span>
<span id="cb206-5"><a href="session-4-model-analysis.html#cb206-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">Tl =</span> <span class="fu">mean</span>(testTl),</span>
<span id="cb206-6"><a href="session-4-model-analysis.html#cb206-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">RH =</span> <span class="fu">mean</span>(testRH))</span>
<span id="cb206-7"><a href="session-4-model-analysis.html#cb206-7" aria-hidden="true" tabindex="-1"></a>A2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">c4photo</span>(<span class="at">Qp =</span> testQp, <span class="at">Tl =</span> testTl, <span class="at">RH =</span> testRH), mean)</span>
<span id="cb206-8"><a href="session-4-model-analysis.html#cb206-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-9"><a href="session-4-model-analysis.html#cb206-9" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="at">A1 =</span> A1, <span class="at">A2 =</span> A2)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 4
##      Gs Assim    Ci GrossAssim
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
## 1  239.  31.3  171.       32.1
## 2  243.  31.4  173.       32.2</code></pre>
<p>Why are these different?</p>
<p>For non-linear functions see Jensen’s Inequality (<a href="https://en.wikipedia.org/wiki/Jensen%27s_inequality">Wikipedia</a>)</p>
<p>This means - be careful when and how you use averages - everywhere!!! Spatial and temporal downscaling is how crop modelers deal with lower resolution atmospheric model forecasts. For example the most recent IPCC 100 y climate forecasts were generated on ~100km grids (<a href="http://journals.ametsoc.org/doi/pdf/10.1175/BAMS-D-11-00094.1">Taylor et al 2012</a>), thus one data point may simultaneously represent a month that is <span class="math inline">\(60^o\)</span>F and foggy in San Fransicsco and <span class="math inline">\(100^o\)</span>F and dry in Davis, CA. At the same time, crop models need to run on local hourly data while also capturing the uncertainty represented by within and across model variability.</p>
<div id="model-sensitivity" class="section level4" number="4.3.2.1">
<h4><span class="header-section-number">4.3.2.1</span> Model sensitivity</h4>
<p>Next, we are going to look at the sensitivity of the model to each of the different weather parameters, holding the others at their mean</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="session-4-model-analysis.html#cb208-1" aria-hidden="true" tabindex="-1"></a>meanQp <span class="ot">&lt;-</span> <span class="fu">mean</span>(par)</span>
<span id="cb208-2"><a href="session-4-model-analysis.html#cb208-2" aria-hidden="true" tabindex="-1"></a>meanTl <span class="ot">&lt;-</span> <span class="fu">mean</span>(temp)</span>
<span id="cb208-3"><a href="session-4-model-analysis.html#cb208-3" aria-hidden="true" tabindex="-1"></a>meanRH <span class="ot">&lt;-</span> <span class="fu">mean</span>(rh)</span>
<span id="cb208-4"><a href="session-4-model-analysis.html#cb208-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span><span class="sc">/</span><span class="dv">100</span>, <span class="fu">c4photo</span>(<span class="at">Qp =</span> <span class="fu">rep</span>(meanQp, <span class="dv">100</span>),</span>
<span id="cb208-5"><a href="session-4-model-analysis.html#cb208-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Tl =</span> <span class="fu">rep</span>(meanTl, <span class="dv">100</span>),</span>
<span id="cb208-6"><a href="session-4-model-analysis.html#cb208-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">RH =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span><span class="sc">/</span><span class="dv">100</span>)<span class="sc">$</span>Assim,</span>
<span id="cb208-7"><a href="session-4-model-analysis.html#cb208-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&#39;l&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Assim&#39;</span>, <span class="at">xlab =</span> <span class="st">&#39;RH&#39;</span>)</span></code></pre></div>
<p><img src="reproducible-research-short-course_files/figure-html/unnamed-chunk-94-1.png" width="672" /></p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="session-4-model-analysis.html#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span><span class="sc">/</span><span class="dv">4</span>, <span class="fu">c4photo</span>(<span class="at">Qp =</span> <span class="fu">rep</span>(meanQp, <span class="dv">100</span>),</span>
<span id="cb209-2"><a href="session-4-model-analysis.html#cb209-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Tl =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span><span class="sc">/</span><span class="dv">4</span>,</span>
<span id="cb209-3"><a href="session-4-model-analysis.html#cb209-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">RH =</span> <span class="fu">rep</span>(meanRH, <span class="dv">100</span>))<span class="sc">$</span>Assim,</span>
<span id="cb209-4"><a href="session-4-model-analysis.html#cb209-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&#39;l&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Assim&#39;</span>, <span class="at">xlab =</span> <span class="st">&#39;RH&#39;</span>)</span></code></pre></div>
<p><img src="reproducible-research-short-course_files/figure-html/unnamed-chunk-94-2.png" width="672" /></p>
</div>
<div id="monte-carlo-error-propagation" class="section level4" number="4.3.2.2">
<h4><span class="header-section-number">4.3.2.2</span> Monte Carlo Error propagation</h4>
<p>Given a model parameters represented as variables, e.g.</p>
<p><span class="math display">\[
V_{cmax}\sim N(45,2)\\
Rd\sim N(1, 0.1)
b1 \sim N(4,1)
\]</span></p>
<p>What is expected uncertainty in model predictions of photosynthesis (A = assimilation)</p>
<p>Lets take some samples from these distributions</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="session-4-model-analysis.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb210-2"><a href="session-4-model-analysis.html#cb210-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-3"><a href="session-4-model-analysis.html#cb210-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb210-4"><a href="session-4-model-analysis.html#cb210-4" aria-hidden="true" tabindex="-1"></a>vmax <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">45</span>, <span class="dv">2</span>)</span>
<span id="cb210-5"><a href="session-4-model-analysis.html#cb210-5" aria-hidden="true" tabindex="-1"></a>Rd   <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">1</span>, <span class="fl">0.10</span>)</span>
<span id="cb210-6"><a href="session-4-model-analysis.html#cb210-6" aria-hidden="true" tabindex="-1"></a>b1   <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">4</span>, <span class="dv">1</span>)</span></code></pre></div>
<p>Now we can take a look at them</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="session-4-model-analysis.html#cb211-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">25</span><span class="sc">:</span><span class="dv">75</span></span>
<span id="cb211-2"><a href="session-4-model-analysis.html#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb211-3"><a href="session-4-model-analysis.html#cb211-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(vmax, <span class="at">y =</span> ..density..), <span class="at">proability =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb211-4"><a href="session-4-model-analysis.html#cb211-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(x, <span class="fu">dnorm</span>(x, <span class="dv">45</span>, <span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## Warning: Ignoring unknown parameters: proability</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="reproducible-research-short-course_files/figure-html/unnamed-chunk-96-1.png" width="672" /></p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="session-4-model-analysis.html#cb214-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">200</span><span class="sc">/</span><span class="dv">100</span></span>
<span id="cb214-2"><a href="session-4-model-analysis.html#cb214-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb214-3"><a href="session-4-model-analysis.html#cb214-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(Rd, <span class="at">y =</span> ..density..), <span class="at">proability =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb214-4"><a href="session-4-model-analysis.html#cb214-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(x, <span class="fu">dnorm</span>(x, <span class="dv">1</span>, <span class="fl">0.1</span>)))</span></code></pre></div>
<pre><code>## Warning: Ignoring unknown parameters: proability</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="reproducible-research-short-course_files/figure-html/unnamed-chunk-96-2.png" width="672" /></p>
<p>Next, we are going to propagate the parameter variance to see how much of an effect it has on the model output variance:</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="session-4-model-analysis.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="do">### sample given time series of met</span></span>
<span id="cb217-2"><a href="session-4-model-analysis.html#cb217-2" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">length</span>(time), <span class="at">ncol =</span> <span class="dv">1000</span>)</span>
<span id="cb217-3"><a href="session-4-model-analysis.html#cb217-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb217-4"><a href="session-4-model-analysis.html#cb217-4" aria-hidden="true" tabindex="-1"></a>  A[,i] <span class="ot">&lt;-</span> <span class="fu">c4photo</span>(<span class="at">Qp =</span> par, <span class="at">Tl =</span> temp, <span class="at">RH =</span> rh, <span class="at">vmax =</span> vmax[i], <span class="at">Rd =</span> Rd[i], <span class="at">b1=</span>b1[i])<span class="sc">$</span>Assim</span>
<span id="cb217-5"><a href="session-4-model-analysis.html#cb217-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb217-6"><a href="session-4-model-analysis.html#cb217-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-7"><a href="session-4-model-analysis.html#cb217-7" aria-hidden="true" tabindex="-1"></a><span class="co"># take a look at the matrix .. </span></span>
<span id="cb217-8"><a href="session-4-model-analysis.html#cb217-8" aria-hidden="true" tabindex="-1"></a><span class="co"># image(A, xlab = &#39;time&#39;, ylab = &#39;sample&#39;)</span></span>
<span id="cb217-9"><a href="session-4-model-analysis.html#cb217-9" aria-hidden="true" tabindex="-1"></a><span class="do">## shows an annual cycle of photosynthesis         </span></span>
<span id="cb217-10"><a href="session-4-model-analysis.html#cb217-10" aria-hidden="true" tabindex="-1"></a>median <span class="ot">&lt;-</span> <span class="fu">which.min</span>(<span class="fu">abs</span>(<span class="fu">quantile</span>(<span class="fu">colMeans</span>(A), <span class="fl">0.50</span>)<span class="sc">-</span><span class="fu">colMeans</span>(A)))</span>
<span id="cb217-11"><a href="session-4-model-analysis.html#cb217-11" aria-hidden="true" tabindex="-1"></a>ucl    <span class="ot">&lt;-</span> <span class="fu">which.min</span>(<span class="fu">abs</span>(<span class="fu">quantile</span>(<span class="fu">colMeans</span>(A), <span class="fl">0.975</span>)<span class="sc">-</span><span class="fu">colMeans</span>(A)))</span>
<span id="cb217-12"><a href="session-4-model-analysis.html#cb217-12" aria-hidden="true" tabindex="-1"></a>lcl    <span class="ot">&lt;-</span> <span class="fu">which.min</span>(<span class="fu">abs</span>(<span class="fu">quantile</span>(<span class="fu">colMeans</span>(A), <span class="fl">0.025</span>)<span class="sc">-</span><span class="fu">colMeans</span>(A)))</span>
<span id="cb217-13"><a href="session-4-model-analysis.html#cb217-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-14"><a href="session-4-model-analysis.html#cb217-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb217-15"><a href="session-4-model-analysis.html#cb217-15" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_smooth(aes(time, A))+</span></span>
<span id="cb217-16"><a href="session-4-model-analysis.html#cb217-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(time, A[,median])) <span class="sc">+</span></span>
<span id="cb217-17"><a href="session-4-model-analysis.html#cb217-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(time, <span class="at">y =</span> A[,lcl]), <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb217-18"><a href="session-4-model-analysis.html#cb217-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(time, <span class="at">y =</span> A[,ucl]), <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb217-19"><a href="session-4-model-analysis.html#cb217-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_datetime</span>(<span class="at">limits =</span> <span class="fu">ymd_h</span>(<span class="fu">c</span>(<span class="st">&#39;2004-05-01 0&#39;</span>, <span class="st">&#39;2004-05-07 23&#39;</span>)))</span></code></pre></div>
<pre><code>## Warning: Removed 8592 row(s) containing missing values (geom_path).

## Warning: Removed 8592 row(s) containing missing values (geom_path).

## Warning: Removed 8592 row(s) containing missing values (geom_path).</code></pre>
<p><img src="reproducible-research-short-course_files/figure-html/unnamed-chunk-97-1.png" width="672" /></p>
</div>
</div>
<div id="variance-decomposition---which-of-these-parameters-are-most-important" class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Variance Decomposition - which of these parameters are most important?</h3>
<p>Response of interest is the total assimilation</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="session-4-model-analysis.html#cb219-1" aria-hidden="true" tabindex="-1"></a>a_total <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(A)</span>
<span id="cb219-2"><a href="session-4-model-analysis.html#cb219-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-3"><a href="session-4-model-analysis.html#cb219-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">aov</span>(a_total <span class="sc">~</span> vmax <span class="sc">+</span> Rd <span class="sc">+</span> b1))</span></code></pre></div>
<pre><code>##              Df Sum Sq Mean Sq F value Pr(&gt;F)    
## vmax          1  22.66   22.66    8593 &lt;2e-16 ***
## Rd            1   2.55    2.55     966 &lt;2e-16 ***
## b1            1   0.40    0.40     153 &lt;2e-16 ***
## Residuals   996   2.63    0.00                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="propagate-met-and-use-met-as-a-variable-sample-over-variation-within-the-hour" class="section level3" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> Propagate met and Use met as a variable, sample over variation within the hour</h3>
<p>To answer the question - if I were to step out and look at the plants in the summer,
how fast would they be growing?</p>
<p>This time, instead of sampling from a parameterized distribution, I am going to sample over the middle (hours 10-4) of days in the middle of the year (approx. summer, day of year 120-240)</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="session-4-model-analysis.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="do">### sample over met variability</span></span>
<span id="cb221-2"><a href="session-4-model-analysis.html#cb221-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-3"><a href="session-4-model-analysis.html#cb221-3" aria-hidden="true" tabindex="-1"></a>A2 <span class="ot">&lt;-</span> Gs <span class="ot">&lt;-</span> Ci <span class="ot">&lt;-</span> Qp <span class="ot">&lt;-</span> Tl <span class="ot">&lt;-</span> RH <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length =</span> <span class="dv">1000</span>)</span>
<span id="cb221-4"><a href="session-4-model-analysis.html#cb221-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb221-5"><a href="session-4-model-analysis.html#cb221-5" aria-hidden="true" tabindex="-1"></a>  day <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">120</span><span class="sc">:</span><span class="dv">240</span>, <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb221-6"><a href="session-4-model-analysis.html#cb221-6" aria-hidden="true" tabindex="-1"></a>  hour <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">16</span>, <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb221-7"><a href="session-4-model-analysis.html#cb221-7" aria-hidden="true" tabindex="-1"></a>  j <span class="ot">&lt;-</span> day <span class="sc">*</span> <span class="dv">24</span> <span class="sc">+</span> hour</span>
<span id="cb221-8"><a href="session-4-model-analysis.html#cb221-8" aria-hidden="true" tabindex="-1"></a>  Qp[i] <span class="ot">&lt;-</span> par[j]</span>
<span id="cb221-9"><a href="session-4-model-analysis.html#cb221-9" aria-hidden="true" tabindex="-1"></a>  Tl[i] <span class="ot">&lt;-</span> temp[j]</span>
<span id="cb221-10"><a href="session-4-model-analysis.html#cb221-10" aria-hidden="true" tabindex="-1"></a>  RH[i] <span class="ot">&lt;-</span> rh[j]</span>
<span id="cb221-11"><a href="session-4-model-analysis.html#cb221-11" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">c4photo</span>(<span class="at">Qp =</span> Qp[i], <span class="at">Tl =</span> Tl[i], <span class="at">RH =</span> RH[i], <span class="at">vmax =</span> vmax[i], <span class="at">Rd =</span> Rd[i], <span class="at">b1=</span>b1[i])</span>
<span id="cb221-12"><a href="session-4-model-analysis.html#cb221-12" aria-hidden="true" tabindex="-1"></a>  A2[i] <span class="ot">&lt;-</span> res<span class="sc">$</span>Assim</span>
<span id="cb221-13"><a href="session-4-model-analysis.html#cb221-13" aria-hidden="true" tabindex="-1"></a>  Gs[i] <span class="ot">&lt;-</span> res<span class="sc">$</span>Gs</span>
<span id="cb221-14"><a href="session-4-model-analysis.html#cb221-14" aria-hidden="true" tabindex="-1"></a>  Ci[i] <span class="ot">&lt;-</span> res<span class="sc">$</span>Ci</span>
<span id="cb221-15"><a href="session-4-model-analysis.html#cb221-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb221-16"><a href="session-4-model-analysis.html#cb221-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-17"><a href="session-4-model-analysis.html#cb221-17" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(A2)</span></code></pre></div>
<p><img src="reproducible-research-short-course_files/figure-html/unnamed-chunk-99-1.png" width="672" /></p>
<p>Equivalent of sensitivity analysis: (where A2, Gs, Ci are response variables)</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="session-4-model-analysis.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="fu">data.frame</span>(A2, Gs, Ci, vmax, Rd, b1, Qp, Tl, RH), <span class="at">pch =</span> <span class="st">&#39;.&#39;</span>)</span></code></pre></div>
<p><img src="reproducible-research-short-course_files/figure-html/unnamed-chunk-100-1.png" width="672" /></p>
<p>The lm is pretty much a sensitivity analysis: what is the slope of the effect of inputs on the output of the model.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="session-4-model-analysis.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(A2 <span class="sc">~</span> vmax <span class="sc">+</span> Rd <span class="sc">+</span> b1 <span class="sc">+</span> Qp <span class="sc">+</span> Tl <span class="sc">+</span> RH))</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = A2 ~ vmax + Rd + b1 + Qp + Tl + RH)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -35.33  -1.35   0.71   1.61   6.75 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -2.61e+01   2.42e+00  -10.78  &lt; 2e-16 ***
## vmax         2.94e-01   3.94e-02    7.47  1.8e-13 ***
## Rd           5.76e-02   8.29e-01    0.07     0.94    
## b1           3.67e-01   7.75e-02    4.73  2.6e-06 ***
## Qp           1.05e-02   1.93e-04   54.54  &lt; 2e-16 ***
## Tl           1.08e+00   1.86e-02   57.99  &lt; 2e-16 ***
## RH           9.66e-01   1.28e+00    0.76     0.45    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.56 on 993 degrees of freedom
## Multiple R-squared:  0.895,  Adjusted R-squared:  0.894 
## F-statistic: 1.41e+03 on 6 and 993 DF,  p-value: &lt;2e-16</code></pre>
<p>The analysis of variance partitions the variance - how much if the total variance in A2 is contributed by each of the following parameters (recall that the domain for met variables is &lt;&lt; the domain for physiological parameters …</p>
<blockquote>
<p>What would happen if we used a whole year of meteorological data instead of the one hour of met data that we used?</p>
</blockquote>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="session-4-model-analysis.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">aov</span>(A2 <span class="sc">~</span> vmax <span class="sc">+</span> Rd <span class="sc">+</span> b1 <span class="sc">+</span> Qp <span class="sc">+</span> Tl <span class="sc">+</span> RH))</span></code></pre></div>
<pre><code>##              Df Sum Sq Mean Sq F value Pr(&gt;F)    
## vmax          1    932     932  142.26 &lt;2e-16 ***
## Rd            1     21      21    3.21  0.074 .  
## b1            1     33      33    5.01  0.025 *  
## Qp            1  32153   32153 4906.97 &lt;2e-16 ***
## Tl            1  22380   22380 3415.44 &lt;2e-16 ***
## RH            1      4       4    0.57  0.450    
## Residuals   993   6507       7                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="session-4-model-analysis.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(<span class="fu">aov</span>(Gs <span class="sc">~</span> vmax <span class="sc">+</span> Rd <span class="sc">+</span> b1 <span class="sc">+</span> Qp <span class="sc">+</span> Tl <span class="sc">+</span> RH))</span>
<span id="cb227-2"><a href="session-4-model-analysis.html#cb227-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-3"><a href="session-4-model-analysis.html#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(<span class="fu">aov</span>(Ci <span class="sc">~</span> vmax <span class="sc">+</span> Rd <span class="sc">+</span> b1 <span class="sc">+</span> Qp <span class="sc">+</span> Tl <span class="sc">+</span> RH))</span></code></pre></div>
</div>
<div id="references-1" class="section level3" number="4.3.5">
<h3><span class="header-section-number">4.3.5</span> References</h3>
<p>Taylor, K.E., R.J. Stouffer, G.A. Meehl: An Overview of CMIP5 and the experiment design.” Bull. Amer. Meteor. Soc., 93, 485-498, <a href="doi:10.1175/BAMS-D-11-00094.1" class="uri">doi:10.1175/BAMS-D-11-00094.1</a>, 2012.
<a href="http://journals.ametsoc.org/doi/pdf/10.1175/BAMS-D-11-00094.1" class="uri">http://journals.ametsoc.org/doi/pdf/10.1175/BAMS-D-11-00094.1</a></p>
<p>Humphries S and Long SP (1995) WIMOVAC - a software package for modeling the dynamics of the plant leaf and canopy photosynthesis. Computer Applications in the Bioscience 11(4):361-371.</p>
<p>Miguez FE, Zhu XG, Humphries S, Bollero GA, Long SP (2009) A semimechanistic model predicting the growth and production of the bioenergy crop Miscanthus × giganteus: description, parameterization and validation. Global Change Biology Bioenergy 1: 282-296.</p>
<p>Wang D, Jaiswal D, Lebauer DS, Wertin TM, Bollero GA, Leakey ADB, Long SP (2015) A physiological and biophysical model of coppice willow (Salix spp.) production yields for the contiguous USA in current and future climate scenarios. Plant, cell &amp; environment, 38(9), 1850-1865.</p>
<p>Thornton, M.M., R. Shrestha, Y. Wei, P.E. Thornton, S. Kao, and B.E. Wilson. 2020. Daymet: Daily Surface Weather Data on a 1-km Grid for North America, Version 4. ORNL DAAC, Oak Ridge, Tennessee, USA. <a href="https://doi.org/10.3334/ORNLDAAC/1840" class="uri">https://doi.org/10.3334/ORNLDAAC/1840</a></p>
<p>Daymet: Daily Surface Weather Data on a 1-km Grid for North America, Version 4 <a href="https://doi.org/10.3334/ORNLDAAC/1840" class="uri">https://doi.org/10.3334/ORNLDAAC/1840</a></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="session-3-programmatic-metadata-and-data-access.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="session-5-shiny.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
