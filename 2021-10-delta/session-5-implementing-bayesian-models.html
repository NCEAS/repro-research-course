<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Session 5: Implementing Bayesian models | Open Science Synthesis for the Delta Science Program: Week 2</title>
  <meta name="description" content="6 Session 5: Implementing Bayesian models | Open Science Synthesis for the Delta Science Program: Week 2" />
  <meta name="generator" content="bookdown 0.24.2 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Session 5: Implementing Bayesian models | Open Science Synthesis for the Delta Science Program: Week 2" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Session 5: Implementing Bayesian models | Open Science Synthesis for the Delta Science Program: Week 2" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="session-4-collaborative-synthesis.html"/>
<link rel="next" href="session-6-collaborative-synthesis.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Open Science Synthesis for the Delta Science Program: Week 2</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i><b>0.1</b> Schedule</a>
<ul>
<li class="chapter" data-level="0.1.1" data-path="index.html"><a href="index.html#code-of-conduct"><i class="fa fa-check"></i><b>0.1.1</b> Code of Conduct</a></li>
<li class="chapter" data-level="0.1.2" data-path="index.html"><a href="index.html#logistics"><i class="fa fa-check"></i><b>0.1.2</b> Logistics</a></li>
<li class="chapter" data-level="0.1.3" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i><b>0.1.3</b> About this book</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="session-1-re-introductions-and-setup.html"><a href="session-1-re-introductions-and-setup.html"><i class="fa fa-check"></i><b>1</b> Session 1: Re-Introductions and Setup</a>
<ul>
<li class="chapter" data-level="1.1" data-path="session-1-re-introductions-and-setup.html"><a href="session-1-re-introductions-and-setup.html#datasets-of-interest"><i class="fa fa-check"></i><b>1.1</b> Datasets of Interest</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html"><i class="fa fa-check"></i><b>2</b> Session 2: git conflicts</a>
<ul>
<li class="chapter" data-level="2.1" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#learning-objectives"><i class="fa fa-check"></i><b>2.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="2.2" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#introduction"><i class="fa fa-check"></i><b>2.2</b> Introduction</a></li>
<li class="chapter" data-level="2.3" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#collaborating-with-a-trusted-colleague-without-conflicts"><i class="fa fa-check"></i><b>2.3</b> Collaborating with a trusted colleague <strong>without conflicts</strong></a>
<ul>
<li class="chapter" data-level="" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#setup"><i class="fa fa-check"></i>Setup</a></li>
<li><a href="session-2-git-conflicts.html#section"></a></li>
<li class="chapter" data-level="2.3.1" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#step-1-collaborator-clone"><i class="fa fa-check"></i><b>2.3.1</b> Step 1: Collaborator clone</a></li>
<li class="chapter" data-level="2.3.2" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#step-2-collaborator-edits"><i class="fa fa-check"></i><b>2.3.2</b> Step 2: Collaborator Edits</a></li>
<li class="chapter" data-level="2.3.3" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#step-3-collaborator-commit-and-push"><i class="fa fa-check"></i><b>2.3.3</b> Step 3: Collaborator commit and push</a></li>
<li class="chapter" data-level="2.3.4" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#step-4-owner-pull"><i class="fa fa-check"></i><b>2.3.4</b> Step 4: Owner pull</a></li>
<li class="chapter" data-level="2.3.5" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#step-5-owner-edits-commit-and-push"><i class="fa fa-check"></i><b>2.3.5</b> Step 5: Owner edits, commit, and push</a></li>
<li class="chapter" data-level="2.3.6" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#step-6-collaborator-pull"><i class="fa fa-check"></i><b>2.3.6</b> Step 6: Collaborator pull</a></li>
<li class="chapter" data-level="" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#challenge"><i class="fa fa-check"></i>Challenge</a></li>
<li><a href="session-2-git-conflicts.html#section-1"></a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#merge-conflicts"><i class="fa fa-check"></i><b>2.4</b> Merge conflicts</a></li>
<li class="chapter" data-level="2.5" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#how-to-resolve-a-conflict"><i class="fa fa-check"></i><b>2.5</b> How to resolve a conflict</a>
<ul>
<li class="chapter" data-level="" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#abort-abort-abort"><i class="fa fa-check"></i>Abort, abort, abort…</a></li>
<li class="chapter" data-level="" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#checkout"><i class="fa fa-check"></i>Checkout</a></li>
<li class="chapter" data-level="" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#pull-and-edit-the-file"><i class="fa fa-check"></i>Pull and edit the file</a></li>
<li class="chapter" data-level="2.5.1" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#producing-and-resolving-merge-conflicts"><i class="fa fa-check"></i><b>2.5.1</b> Producing and resolving merge conflicts</a></li>
<li class="chapter" data-level="" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#merge-conflict-challenge"><i class="fa fa-check"></i>Merge Conflict Challenge</a></li>
<li><a href="session-2-git-conflicts.html#section-2"></a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#workflows-to-avoid-merge-conflicts"><i class="fa fa-check"></i><b>2.6</b> Workflows to avoid merge conflicts</a></li>
<li class="chapter" data-level="2.7" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#collaborating-using-git"><i class="fa fa-check"></i><b>2.7</b> Collaborating using Git</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#learning-objectives-1"><i class="fa fa-check"></i><b>2.7.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="2.7.2" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#pull-requests"><i class="fa fa-check"></i><b>2.7.2</b> Pull requests</a></li>
<li class="chapter" data-level="2.7.3" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#exercise-create-and-merge-pull-requests"><i class="fa fa-check"></i><b>2.7.3</b> Exercise: Create and merge pull requests</a></li>
<li class="chapter" data-level="2.7.4" data-path="session-2-git-conflicts.html"><a href="session-2-git-conflicts.html#branches"><i class="fa fa-check"></i><b>2.7.4</b> Branches</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="session-2-collaborative-synthesis.html"><a href="session-2-collaborative-synthesis.html"><i class="fa fa-check"></i><b>3</b> Session 2: Collaborative Synthesis</a></li>
<li class="chapter" data-level="4" data-path="session-3-introduction-to-bayesian-modeling.html"><a href="session-3-introduction-to-bayesian-modeling.html"><i class="fa fa-check"></i><b>4</b> Session 3: Introduction to Bayesian modeling</a>
<ul>
<li class="chapter" data-level="4.1" data-path="session-3-introduction-to-bayesian-modeling.html"><a href="session-3-introduction-to-bayesian-modeling.html#learning-objectives-2"><i class="fa fa-check"></i><b>4.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="4.2" data-path="session-3-introduction-to-bayesian-modeling.html"><a href="session-3-introduction-to-bayesian-modeling.html#why-choose-bayesian"><i class="fa fa-check"></i><b>4.2</b> Why choose Bayesian?</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="session-3-introduction-to-bayesian-modeling.html"><a href="session-3-introduction-to-bayesian-modeling.html#philosophically-sound-and-consistent"><i class="fa fa-check"></i><b>4.2.1</b> Philosophically sound and consistent</a></li>
<li class="chapter" data-level="4.2.2" data-path="session-3-introduction-to-bayesian-modeling.html"><a href="session-3-introduction-to-bayesian-modeling.html#flexible"><i class="fa fa-check"></i><b>4.2.2</b> Flexible</a></li>
<li class="chapter" data-level="4.2.3" data-path="session-3-introduction-to-bayesian-modeling.html"><a href="session-3-introduction-to-bayesian-modeling.html#clear-inference"><i class="fa fa-check"></i><b>4.2.3</b> Clear inference</a></li>
<li class="chapter" data-level="4.2.4" data-path="session-3-introduction-to-bayesian-modeling.html"><a href="session-3-introduction-to-bayesian-modeling.html#uses-all-available-information"><i class="fa fa-check"></i><b>4.2.4</b> Uses all available information</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="session-3-introduction-to-bayesian-modeling.html"><a href="session-3-introduction-to-bayesian-modeling.html#review-of-probability-bayes-rule-and-distributions"><i class="fa fa-check"></i><b>4.3</b> Review of probability, Bayes’ rule, and distributions</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="session-3-introduction-to-bayesian-modeling.html"><a href="session-3-introduction-to-bayesian-modeling.html#probabability"><i class="fa fa-check"></i><b>4.3.1</b> Probabability</a></li>
<li class="chapter" data-level="4.3.2" data-path="session-3-introduction-to-bayesian-modeling.html"><a href="session-3-introduction-to-bayesian-modeling.html#bayes-rule"><i class="fa fa-check"></i><b>4.3.2</b> Bayes’ rule</a></li>
<li class="chapter" data-level="4.3.3" data-path="session-3-introduction-to-bayesian-modeling.html"><a href="session-3-introduction-to-bayesian-modeling.html#bayesian-inference"><i class="fa fa-check"></i><b>4.3.3</b> Bayesian inference</a></li>
<li class="chapter" data-level="4.3.4" data-path="session-3-introduction-to-bayesian-modeling.html"><a href="session-3-introduction-to-bayesian-modeling.html#quick-review-of-distributions"><i class="fa fa-check"></i><b>4.3.4</b> Quick review of distributions</a></li>
<li class="chapter" data-level="4.3.5" data-path="session-3-introduction-to-bayesian-modeling.html"><a href="session-3-introduction-to-bayesian-modeling.html#selecting-priors"><i class="fa fa-check"></i><b>4.3.5</b> Selecting priors</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="session-3-introduction-to-bayesian-modeling.html"><a href="session-3-introduction-to-bayesian-modeling.html#drafting-bayesian-models"><i class="fa fa-check"></i><b>4.4</b> Drafting Bayesian models</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="session-3-introduction-to-bayesian-modeling.html"><a href="session-3-introduction-to-bayesian-modeling.html#graphical-representations-of-hierarchical-models"><i class="fa fa-check"></i><b>4.4.1</b> Graphical representations of hierarchical models</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="session-3-introduction-to-bayesian-modeling.html"><a href="session-3-introduction-to-bayesian-modeling.html#simple-hierachical-example-snow-fences"><i class="fa fa-check"></i><b>4.5</b> Simple hierachical example: snow fences</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="session-3-introduction-to-bayesian-modeling.html"><a href="session-3-introduction-to-bayesian-modeling.html#acknowledgements"><i class="fa fa-check"></i><b>4.5.1</b> Acknowledgements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="session-4-collaborative-synthesis.html"><a href="session-4-collaborative-synthesis.html"><i class="fa fa-check"></i><b>5</b> Session 4: Collaborative Synthesis</a></li>
<li class="chapter" data-level="6" data-path="session-5-implementing-bayesian-models.html"><a href="session-5-implementing-bayesian-models.html"><i class="fa fa-check"></i><b>6</b> Session 5: Implementing Bayesian models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="session-5-implementing-bayesian-models.html"><a href="session-5-implementing-bayesian-models.html#learning-objectives-3"><i class="fa fa-check"></i><b>6.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="6.2" data-path="session-5-implementing-bayesian-models.html"><a href="session-5-implementing-bayesian-models.html#overview-of-the-bayesian-modeling-process"><i class="fa fa-check"></i><b>6.2</b> Overview of the Bayesian modeling process</a></li>
<li class="chapter" data-level="6.3" data-path="session-5-implementing-bayesian-models.html"><a href="session-5-implementing-bayesian-models.html#markov-chain-monte-carlo"><i class="fa fa-check"></i><b>6.3</b> Markov chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="session-5-implementing-bayesian-models.html"><a href="session-5-implementing-bayesian-models.html#inference-from-iterative-simulation"><i class="fa fa-check"></i><b>6.3.1</b> Inference from iterative simulation</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="session-5-implementing-bayesian-models.html"><a href="session-5-implementing-bayesian-models.html#programing-statistical-models"><i class="fa fa-check"></i><b>6.4</b> Programing statistical models</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="session-5-implementing-bayesian-models.html"><a href="session-5-implementing-bayesian-models.html#compiling-a-jags-model"><i class="fa fa-check"></i><b>6.4.1</b> Compiling a JAGS model</a></li>
<li class="chapter" data-level="6.4.2" data-path="session-5-implementing-bayesian-models.html"><a href="session-5-implementing-bayesian-models.html#sampling-the-posterior-distribution"><i class="fa fa-check"></i><b>6.4.2</b> Sampling the posterior distribution</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="session-5-implementing-bayesian-models.html"><a href="session-5-implementing-bayesian-models.html#evaluating-model-diagnostics"><i class="fa fa-check"></i><b>6.5</b> Evaluating model diagnostics</a>
<ul>
<li class="chapter" data-level="" data-path="session-5-implementing-bayesian-models.html"><a href="session-5-implementing-bayesian-models.html#interactive-problem-logistic-regression-model"><i class="fa fa-check"></i>Interactive problem: Logistic regression model</a></li>
<li class="chapter" data-level="6.5.1" data-path="session-5-implementing-bayesian-models.html"><a href="session-5-implementing-bayesian-models.html#acknowledgements-1"><i class="fa fa-check"></i><b>6.5.1</b> Acknowledgements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="session-6-collaborative-synthesis.html"><a href="session-6-collaborative-synthesis.html"><i class="fa fa-check"></i><b>7</b> Session 6: Collaborative Synthesis</a></li>
<li class="chapter" data-level="8" data-path="session-7-collaborative-synthesis.html"><a href="session-7-collaborative-synthesis.html"><i class="fa fa-check"></i><b>8</b> Session 7: Collaborative Synthesis</a></li>
<li class="chapter" data-level="9" data-path="session-8-informative-priors.html"><a href="session-8-informative-priors.html"><i class="fa fa-check"></i><b>9</b> Session 8: Informative Priors</a></li>
<li class="chapter" data-level="10" data-path="session-9-missing-data.html"><a href="session-9-missing-data.html"><i class="fa fa-check"></i><b>10</b> Session 9: Missing Data</a></li>
<li class="chapter" data-level="11" data-path="session-10-collaborative-synthesis.html"><a href="session-10-collaborative-synthesis.html"><i class="fa fa-check"></i><b>11</b> Session 10: Collaborative Synthesis</a></li>
<li class="chapter" data-level="12" data-path="session-11-timeseries.html"><a href="session-11-timeseries.html"><i class="fa fa-check"></i><b>12</b> Session 11: Timeseries</a></li>
<li class="chapter" data-level="13" data-path="session-12-forecasting.html"><a href="session-12-forecasting.html"><i class="fa fa-check"></i><b>13</b> Session 12: Forecasting</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Open Science Synthesis for the Delta Science Program: Week 2</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="session-5-implementing-bayesian-models" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Session 5: Implementing Bayesian models</h1>
<div id="learning-objectives-3" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Learning Objectives</h2>
<p>In this lesson, you will learn:</p>
<ul>
<li><p>Overview of the Bayesian modeling process</p></li>
<li><p>Introduction to MCMC</p></li>
<li><p>Programming model in software</p></li>
<li><p>Evaluating model diagnostics</p></li>
</ul>
</div>
<div id="overview-of-the-bayesian-modeling-process" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Overview of the Bayesian modeling process</h2>
<p>In the first part of the lecture, we established the major reasons to use Bayesian inference and briefly reviewed the fundamentals of probability, Bayes’ rule, and distributions. We ended by walking through two examples that allowed us to practice model specification.</p>
<div id="htmlwidget-cb8e5e4db17a0c8b865a" style="width:672px;height:300px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-cb8e5e4db17a0c8b865a">{"x":{"diagram":"digraph {\n  graph [layout = dot, rankdir = TB]\n  \n  node [shape = rectangle, fontcolor = coral]        \n  rec1 [label = \"Identify scientific objectives\"]\n  rec2 [label = \"Collect & understand data\"]\n  rec3 [label = \"Draw upon existing theory/knowledge\"]\n  node [shape = rectangle, fontcolor = darkorchid3]  \n  rec4 [label = \"Visualize model\"]\n  rec5 [label = \"Write model mathematically (probability notation & distributions)\"]\n  \n  # edge definitions with the node IDs\n  rec1 -> rec2 \n  rec3 -> rec2 -> rec4 -> rec5\n  rec3 -> rec1\n  rec3 -> rec4\n  }","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>In this lesson, we will explain and demonstrate how to ‘translate’ between statistical notation and model code, with particular emphasis on implementing Bayesian models with MCMC software.</p>
<div id="htmlwidget-11b99fb93c124ab206ac" style="width:672px;height:425px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-11b99fb93c124ab206ac">{"x":{"diagram":"digraph {\n  graph [layout = dot, rankdir = TB]\n  \n  node [shape = rectangle, fontcolor = darkorchid3]  \n  rec2 [label = \"Write model mathematically (probability notation & distributions)\"]\n  node [shape = rectangle, fontcolor = goldenrod, style = dashed]  \n  rec3 [label = \"Write unnormalized posterior\"]\n  rec4 [label = \"Derive full conditional distributions\"]\n  rec5 [label = \"Construct MCMC algorithm\"]\n  node [shape = rectangle, fontcolor = goldenrod, style = bold]  \n  rec6 [label = \"Program model components in software\"]\n  rec7 [label = \"Fit data to model using MCMC\"]\n  node [shape = rectangle, fontcolor = steelblue, style = solid]\n  rec8 [label = \"Evaluate models (diagnostics, posterior predictive checks)\"]\n  rec9 [label = \"Use output to make inferences\"]\n  \n  # edge definitions with the node IDs\n  rec2 -> rec3 -> rec4 -> rec5 -> rec7 [style = dashed]\n  rec2 -> rec6 -> rec7 [style = bold]\n  rec7 -> rec8 -> rec9 [style = solid]\n  }","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="markov-chain-monte-carlo" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Markov chain Monte Carlo</h2>
<p>MCMC is a general method where samples are drawn sequentially from a proposal distribution that depends on the last value in the sequence. These draws form a Markov chain because the probability of accepting a proposed value of <span class="math inline">\(\theta\)</span> in iteration <span class="math inline">\(j\)</span> depends on the value of <span class="math inline">\(\theta\)</span> in iteration <span class="math inline">\(j-1\)</span>. Each iteration improves the proposal distribution until it eventually approximates (converges upon) the posterior distribution.</p>
<p>Two popular MCMC algorithms are the Metropolis-Hastings algorithm and the Gibbs sampler. Both procedures are highly random, although Gibbs sampling is more efficient at proposing values by reducing this randomness. The software OpenBUGS and JAGS both utilize Gibbs sampling and can interface with R using packages such as ‘rjags’ and ‘R2OpenBUGS’.</p>
<p>Hamiltonian Monte Carlo (HMC) and its variant No-U-Turn sampler are much more computationally intensive, but more efficient algorithms that are available in the imperative programming language Stan. Popular R interface packages include ‘rstan’, ‘rethinking’, and ‘brms’.</p>
<p>Chapter 8 of McElreath’s ‘Statistical Rethinking’ (2016) provides a great overview of MCMC algorithms at the level suitable for applied practitioners, while greater detail of the algorithms can be found in chapters 11-12 of ‘Bayesian Data Analysis’ (Gelman et al. 2014).</p>
<div id="inference-from-iterative-simulation" class="section level3" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Inference from iterative simulation</h3>
<p>Using MCMC simulation software frees us from having to compute the posterior analytically, but adds the following considerations:</p>
<ul>
<li><p>The simulation must be run long enough such that the distribution of <span class="math inline">\(\theta\)</span> closely approximates the true posterior distribution</p></li>
<li><p>Iterative simulation can result in within-sequence correlation, such that inference can be less precise than with independent draws</p></li>
</ul>
<p>To address these issues, simulation can be run for multiple sequences and initiated at dispersed starting points within the parameter space. It is highly recommended that at least 3 chains are run. If the runs are initiated with dispersed starting values, yet ultimately describe the same posterior, we say that the model has converged.</p>
<p>One rule of thumb is to aim for 3000-4000 ‘independent’ posterior samples. Since each MCMC sample depends on the previous proposal, the samples are not truly independent. In practice, trial runs of the model can be used to assess autocorrelation within chains. We can then set the number of iterations and the thinning interval to obtain the desired number of ‘independent’ posterior samples.</p>
<p>Below, we’ll use an example below to illustrate how to specify starting values, determine chain length, and perform posterior predictive checks.</p>
</div>
</div>
<div id="programing-statistical-models" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Programing statistical models</h2>
<p>Let’s revisit the snow fence example from the previous lecture. We have already described the model both mathematically and with a DAG. Next, we need to implement the set of equations in an MCMC software.</p>
<p>In this lesson, we will use JAGS interfaced from R with the package ‘rjags’. JAGS shares some syntax with R, but is not declarative and not vectorized. In practice, this means that the order of statements does not matter, and that operations that apply to a vector of values must be contained within a for loop.</p>
<p>To start a model, write a for loop for the number of observations (N) in the dataset. Then, specify the likelihood within that data loop.</p>
<p><span class="math inline">\(y_i \sim Poisson(\theta_i \cdot x_i)\)</span></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="session-5-implementing-bayesian-models.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;model{</span></span>
<span id="cb2-2"><a href="session-5-implementing-bayesian-models.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="st">  for(i in 1:N){</span></span>
<span id="cb2-3"><a href="session-5-implementing-bayesian-models.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="st">    y[i] ~ dpois(theta[i]*x[i])</span></span>
<span id="cb2-4"><a href="session-5-implementing-bayesian-models.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb2-5"><a href="session-5-implementing-bayesian-models.html#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="st">}&quot;</span></span></code></pre></div>
<p>Note that the subscript indexing from the mathematical notation is retained as indices within square brackets.</p>
<p>Next, consider the probability distribution of <span class="math inline">\(\theta_i\)</span>.</p>
<p><span class="math inline">\(\theta_i \sim Gamma(\alpha, \beta)\)</span></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="session-5-implementing-bayesian-models.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;model{</span></span>
<span id="cb3-2"><a href="session-5-implementing-bayesian-models.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="st">  for(i in 1:N){</span></span>
<span id="cb3-3"><a href="session-5-implementing-bayesian-models.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="st">    y[i] ~ dpois(theta[i]*x[i])</span></span>
<span id="cb3-4"><a href="session-5-implementing-bayesian-models.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="st">    theta[i] ~ dgamma(alpha, beta)</span></span>
<span id="cb3-5"><a href="session-5-implementing-bayesian-models.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb3-6"><a href="session-5-implementing-bayesian-models.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="st">}&quot;</span></span></code></pre></div>
<p>The distribution for <span class="math inline">\(\theta_i\)</span> also occurs within the data loop, because our model specifies that each observation has its own rate of invasive plants, drawn from a gamma distribution.</p>
<p>We provide priors for the hyperparameters <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>.</p>
<p><span class="math inline">\(\alpha \sim Gamma(2, 1)\)</span></p>
<p><span class="math inline">\(\beta \sim Exponential(1)\)</span></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="session-5-implementing-bayesian-models.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;model{</span></span>
<span id="cb4-2"><a href="session-5-implementing-bayesian-models.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="st">  for(i in 1:N){</span></span>
<span id="cb4-3"><a href="session-5-implementing-bayesian-models.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="st">    y[i] ~ dpois(theta[i]*x[i])</span></span>
<span id="cb4-4"><a href="session-5-implementing-bayesian-models.html#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="st">    theta[i] ~ dgamma(alpha, beta)</span></span>
<span id="cb4-5"><a href="session-5-implementing-bayesian-models.html#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb4-6"><a href="session-5-implementing-bayesian-models.html#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="st">  alpha ~ dgamma(2, 1)</span></span>
<span id="cb4-7"><a href="session-5-implementing-bayesian-models.html#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="st">  beta ~ dexp(1)</span></span>
<span id="cb4-8"><a href="session-5-implementing-bayesian-models.html#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="st">}&quot;</span></span></code></pre></div>
<p>These hyperparameters are scalars that must be defined outside of the data loop. As root nodes, their parameters are numerical values.</p>
<p>Finally, let’s calculate the mean and standard deviation of the population-level invasive plant rate. We know that the mean of a gamma distribution is <span class="math inline">\(\frac{\alpha}{\beta}\)</span>, and the variance is <span class="math inline">\(\frac{\alpha}{\beta^2}\)</span>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="session-5-implementing-bayesian-models.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;model{</span></span>
<span id="cb5-2"><a href="session-5-implementing-bayesian-models.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="st">  for(i in 1:N){</span></span>
<span id="cb5-3"><a href="session-5-implementing-bayesian-models.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="st">    y[i] ~ dpois(theta[i]*x[i])</span></span>
<span id="cb5-4"><a href="session-5-implementing-bayesian-models.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="st">    theta[i] ~ dgamma(alpha, beta)</span></span>
<span id="cb5-5"><a href="session-5-implementing-bayesian-models.html#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb5-6"><a href="session-5-implementing-bayesian-models.html#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="st">  alpha ~ dgamma(2, 1)</span></span>
<span id="cb5-7"><a href="session-5-implementing-bayesian-models.html#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="st">  beta ~ dexp(1)</span></span>
<span id="cb5-8"><a href="session-5-implementing-bayesian-models.html#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="st">  pmean_theta &lt;- alpha/beta</span></span>
<span id="cb5-9"><a href="session-5-implementing-bayesian-models.html#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="st">  pstd_theta &lt;- sqrt(alpha/beta^2)</span></span>
<span id="cb5-10"><a href="session-5-implementing-bayesian-models.html#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="st">}&quot;</span></span></code></pre></div>
<div id="compiling-a-jags-model" class="section level3" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Compiling a JAGS model</h3>
<p>Fitting a JAGS model consists of two steps. The first step is to compile the model object with <code>jags.model()</code>. This function requires requires the model code, the list of input data, the starting values, and the number of chains.</p>
<p>There is also an optional adaption phase, which has a default of 1000 iterations. This is equivalent to discarding the first 1000 sampes as a ‘burn-in’, during which the samplers are adapting behavior to maximize efficiency.</p>
<div id="model-code" class="section level4 unnumbered">
<h4>Model code</h4>
<p>I typically recommend that model code be saved as a separate model file, which allows for different versions to be tested without cluttering up the main script. But for simple cases, we can specify the model as a character string and later use <code>textConnection()</code> to read in the model.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="session-5-implementing-bayesian-models.html#cb6-1" aria-hidden="true" tabindex="-1"></a>mstring <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb6-2"><a href="session-5-implementing-bayesian-models.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="st">model{</span></span>
<span id="cb6-3"><a href="session-5-implementing-bayesian-models.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="st">  for(i in 1:N){</span></span>
<span id="cb6-4"><a href="session-5-implementing-bayesian-models.html#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="st">    y[i] ~ dpois(theta[i]*x[i])</span></span>
<span id="cb6-5"><a href="session-5-implementing-bayesian-models.html#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="st">    theta[i] ~ dgamma(alpha, beta)</span></span>
<span id="cb6-6"><a href="session-5-implementing-bayesian-models.html#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb6-7"><a href="session-5-implementing-bayesian-models.html#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="st">  alpha ~ dgamma(2, 1)</span></span>
<span id="cb6-8"><a href="session-5-implementing-bayesian-models.html#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="st">  beta ~ dexp(1)</span></span>
<span id="cb6-9"><a href="session-5-implementing-bayesian-models.html#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="st">  pmean_theta &lt;- alpha/beta</span></span>
<span id="cb6-10"><a href="session-5-implementing-bayesian-models.html#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="st">  pstd_theta &lt;- sqrt(alpha/beta^2)</span></span>
<span id="cb6-11"><a href="session-5-implementing-bayesian-models.html#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb6-12"><a href="session-5-implementing-bayesian-models.html#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span></code></pre></div>
</div>
<div id="list-of-input-data" class="section level4 unnumbered">
<h4>List of input data</h4>
<p>To fit the model we have specified, we will need to provide data for the variables <code>y</code> (number of invasive plants), <code>x</code> (footprint area of snow fence), and <code>N</code> (number of observations). These data must be provided as a list, with list element names that correspond to the variable names used in the model code.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="session-5-implementing-bayesian-models.html#cb7-1" aria-hidden="true" tabindex="-1"></a>sf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">138</span>, <span class="dv">91</span>, <span class="dv">132</span>, <span class="dv">123</span>, <span class="dv">173</span>, <span class="dv">124</span>, <span class="dv">109</span>, <span class="dv">154</span>, <span class="dv">138</span>, <span class="dv">134</span>),</span>
<span id="cb7-2"><a href="session-5-implementing-bayesian-models.html#cb7-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">72</span>, <span class="dv">50</span>, <span class="dv">55</span>, <span class="dv">60</span>, <span class="dv">78</span>, <span class="dv">63</span>, <span class="dv">54</span>, <span class="dv">70</span>, <span class="dv">80</span>, <span class="dv">68</span>))</span>
<span id="cb7-3"><a href="session-5-implementing-bayesian-models.html#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="session-5-implementing-bayesian-models.html#cb7-4" aria-hidden="true" tabindex="-1"></a>datlist <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y =</span> sf<span class="sc">$</span>y, </span>
<span id="cb7-5"><a href="session-5-implementing-bayesian-models.html#cb7-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> sf<span class="sc">$</span>x,</span>
<span id="cb7-6"><a href="session-5-implementing-bayesian-models.html#cb7-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">N =</span> <span class="fu">nrow</span>(sf))</span></code></pre></div>
</div>
<div id="initial-values" class="section level4 unnumbered">
<h4>Initial values</h4>
<p>Next, we need to consider appropriate and dispersed starting values. Initial values are only needed for root nodes, in this case for <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>. For simple models, we can skip this input and random starting values will be generated from the prior distribution. In more complex cases, we might want to specify realistic but dispersed starting values to speed the time to convergence.</p>
<p>Initial values must be appropriate for the domain of the prior. For example, since <span class="math inline">\(\alpha\)</span> has a exponential distribution, the model will error if the starting value for <span class="math inline">\(\alpha\)</span> is negative.</p>
<p>The function <code>jags.model()</code> requires initial values as a list of lists; the length of the list must correspond to the number of chains specified. Since we desire 3 independent chains, our list of initials will contain 3 lists, each with two elements (<code>alpha</code> and <code>beta</code>). Again, list element names that correspond to the variable names used in the model code.</p>
<p>Crude estimates of parameter values are a good starting point for specifying initial values. In this case, we will compute the sample mean for the rate of invasive plant occurrence.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="session-5-implementing-bayesian-models.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(sf<span class="sc">$</span>y<span class="sc">/</span>sf<span class="sc">$</span>x)</span></code></pre></div>
<pre><code>## [1] 2.028698</code></pre>
<p>On average, there are about 2 invasive plants per square meter across all snow fences. The rate parameter is specified as a gamma distribution, and the mean of a gamma distribution is <span class="math inline">\(\alpha/\beta\)</span>. We will specify starting values for <code>alpha</code> and <code>beta</code> equivalent to 0.5, 2, and 20.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="session-5-implementing-bayesian-models.html#cb10-1" aria-hidden="true" tabindex="-1"></a>initslist <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">beta =</span> <span class="dv">1</span>),</span>
<span id="cb10-2"><a href="session-5-implementing-bayesian-models.html#cb10-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">4</span>, <span class="at">beta =</span> <span class="dv">2</span>),</span>
<span id="cb10-3"><a href="session-5-implementing-bayesian-models.html#cb10-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">30</span>, <span class="at">beta =</span> <span class="fl">1.5</span>))</span></code></pre></div>
<p>Finally, we can compile the model.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="session-5-implementing-bayesian-models.html#cb11-1" aria-hidden="true" tabindex="-1"></a>jm <span class="ot">&lt;-</span> <span class="fu">jags.model</span>(<span class="at">file =</span> <span class="fu">textConnection</span>(mstring),</span>
<span id="cb11-2"><a href="session-5-implementing-bayesian-models.html#cb11-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> datlist,</span>
<span id="cb11-3"><a href="session-5-implementing-bayesian-models.html#cb11-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">inits =</span> initslist,</span>
<span id="cb11-4"><a href="session-5-implementing-bayesian-models.html#cb11-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n.chains =</span> <span class="dv">3</span>)</span></code></pre></div>
</div>
</div>
<div id="sampling-the-posterior-distribution" class="section level3" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> Sampling the posterior distribution</h3>
<p>After the model object has compiled, we will monitor the posterior samples using <code>coda.samples()</code>. This function requires a jags model object, names of variables to monitor, and the number of iterations to monitor.</p>
<p>There is also an optional thinning argument, which is set to 1 by default. Thinning can be used to save every <span class="math inline">\(i\)</span>th element of the posterior chain, which can produce more ‘independent’ samples when chains are autocorrelated.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="session-5-implementing-bayesian-models.html#cb12-1" aria-hidden="true" tabindex="-1"></a>jm_coda <span class="ot">&lt;-</span> <span class="fu">coda.samples</span>(<span class="at">model =</span> jm,</span>
<span id="cb12-2"><a href="session-5-implementing-bayesian-models.html#cb12-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variable.names =</span> <span class="fu">c</span>(<span class="st">&quot;theta&quot;</span>, <span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>,</span>
<span id="cb12-3"><a href="session-5-implementing-bayesian-models.html#cb12-3" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;pmean_theta&quot;</span>, <span class="st">&quot;pstd_theta&quot;</span>),</span>
<span id="cb12-4"><a href="session-5-implementing-bayesian-models.html#cb12-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n.iter =</span> <span class="dv">3000</span>)</span></code></pre></div>
<p>3000 iterations for each of 3 chains ran quickly in our example.</p>
</div>
</div>
<div id="evaluating-model-diagnostics" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Evaluating model diagnostics</h2>
<p>Hooray! The model ran! But before we can summarize the posterior and move on making inferences, we must examine a series of model diagnostics and re-run the model if necessary.</p>
<p>There are at least two goals of evaluating the posterior samples:</p>
<ul>
<li><p>whether chain length was sufficient</p></li>
<li><p>whether the chains converged</p></li>
</ul>
<p>If either the number of ‘independent’ samples or convergence among chains falls short, we will have to re-run the model before making inferences.</p>
<div id="visual-assessment" class="section level4 unnumbered">
<h4>Visual assessment</h4>
<p>First thing to check are the traceplots, from which we can roughly assess convergence and autocorrelation simultaneously.</p>
<p>Here, we use the <code>traplot()</code> function from the package <code>mcmcplots</code>, which allows us to specify which parameter to visualize.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="session-5-implementing-bayesian-models.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">traplot</span>(jm_coda,</span>
<span id="cb13-2"><a href="session-5-implementing-bayesian-models.html#cb13-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">parms =</span> <span class="fu">c</span>(<span class="st">&quot;theta&quot;</span>, <span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>))</span></code></pre></div>
<p><img src="reproducible-research-short-course_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>The traceplots for the <code>theta</code> parameters are textbook ‘fuzzy catepillars’; the values are stable over time, while the three chains are very well-mixed. We can consider the <code>theta</code> parameters converged and of sufficient run length.</p>
<p>The <code>alpha</code> and <code>beta</code> parameters are also converged, in that the 3 chains are well-mixed and stable. However, there is some autocorrelation present. We will switch to using the function <code>mcmcplot</code>, which provides the traceplot, autoccorelation, and density for specified parameters as an html file that can be viewed in a web browser.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="session-5-implementing-bayesian-models.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmcplot</span>(jm_coda,</span>
<span id="cb14-2"><a href="session-5-implementing-bayesian-models.html#cb14-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">parms =</span> <span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>))</span></code></pre></div>
<p>In the autocorrelation plot, the correlation coefficient between the parameter value at iteration <span class="math inline">\(t\)</span> and its value at iteration <span class="math inline">\(t-l\)</span> are visualized, where <span class="math inline">\(l\)</span> represents the lag or offset between iterations. A correlation coefficient near 1 indicates that samples are highly autocorrelated, whereas correlation coefficients near 0 indicate approximately independent samples.</p>
<p>For <code>alpha</code> and <code>beta</code>, we see that autocorrelation is high until about 20, indicating that thinning by 20 might be appropriate.</p>
</div>
<div id="rerunning-the-model" class="section level4 unnumbered">
<h4>Rerunning the model</h4>
<p>We can re-run the model now and set thinning to 20. But if we are only saving every 20th posterior sample, we should inflate the number of iterations by a factor of 20 to keep the same number of samples.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="session-5-implementing-bayesian-models.html#cb15-1" aria-hidden="true" tabindex="-1"></a>jm <span class="ot">&lt;-</span> <span class="fu">jags.model</span>(<span class="at">file =</span> <span class="fu">textConnection</span>(mstring),</span>
<span id="cb15-2"><a href="session-5-implementing-bayesian-models.html#cb15-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> datlist,</span>
<span id="cb15-3"><a href="session-5-implementing-bayesian-models.html#cb15-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">inits =</span> initslist,</span>
<span id="cb15-4"><a href="session-5-implementing-bayesian-models.html#cb15-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n.chains =</span> <span class="dv">3</span>)</span>
<span id="cb15-5"><a href="session-5-implementing-bayesian-models.html#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="session-5-implementing-bayesian-models.html#cb15-6" aria-hidden="true" tabindex="-1"></a>jm_coda <span class="ot">&lt;-</span> <span class="fu">coda.samples</span>(<span class="at">model =</span> jm,</span>
<span id="cb15-7"><a href="session-5-implementing-bayesian-models.html#cb15-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variable.names =</span> <span class="fu">c</span>(<span class="st">&quot;theta&quot;</span>, <span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>,</span>
<span id="cb15-8"><a href="session-5-implementing-bayesian-models.html#cb15-8" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;pmean_theta&quot;</span>, <span class="st">&quot;pstd_theta&quot;</span>),</span>
<span id="cb15-9"><a href="session-5-implementing-bayesian-models.html#cb15-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n.iter =</span> <span class="dv">3000</span><span class="sc">*</span><span class="dv">20</span>,</span>
<span id="cb15-10"><a href="session-5-implementing-bayesian-models.html#cb15-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">thin =</span> <span class="dv">20</span>)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="session-5-implementing-bayesian-models.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmcplot</span>(jm_coda,</span>
<span id="cb16-2"><a href="session-5-implementing-bayesian-models.html#cb16-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">parms =</span> <span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>))</span></code></pre></div>
<p>Notice that the model took appreciably longer to run this time, as we have specified that the MCMC be run for 20 times the previous number of iterations. However, we now have posterior samples for <code>alpha</code> and <code>beta</code> that are relatively independent.</p>
</div>
<div id="numerical-confirmation-of-convergence" class="section level4 unnumbered">
<h4>Numerical confirmation of convergence</h4>
<p>To quantify convergence, we can use the potential scale reduction factor or <span class="math inline">\(\hat{R}\)</span>, which compares within-chain to between-chain variance for each parameter. In the ‘coda’ package (which is automatically loaded with ‘rjags’), the function for calculating <span class="math inline">\(\hat{R}\)</span> is <code>gelman.diag()</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="session-5-implementing-bayesian-models.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.diag</span>(jm_coda, <span class="at">multivariate =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Potential scale reduction factors:
## 
##             Point est. Upper C.I.
## alpha                1       1.00
## beta                 1       1.00
## pmean_theta          1       1.00
## pstd_theta           1       1.00
## theta[1]             1       1.00
## theta[2]             1       1.00
## theta[3]             1       1.00
## theta[4]             1       1.00
## theta[5]             1       1.00
## theta[6]             1       1.00
## theta[7]             1       1.00
## theta[8]             1       1.00
## theta[9]             1       1.01
## theta[10]            1       1.00</code></pre>
<p><span class="math inline">\(\hat{R} \leq 1.2\)</span> is generally indicates convergence. Here, all of the parameters have converged, which confirms our visual assessment of convergence.</p>
</div>
<div id="plotting-model-output" class="section level4 unnumbered">
<h4>Plotting model output</h4>
<p>We can visualize the posterior distributions of invasive plant rates with the function <code>caterplot()</code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="session-5-implementing-bayesian-models.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">caterplot</span>(jm_coda, </span>
<span id="cb19-2"><a href="session-5-implementing-bayesian-models.html#cb19-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">parms =</span> <span class="st">&quot;theta&quot;</span>,</span>
<span id="cb19-3"><a href="session-5-implementing-bayesian-models.html#cb19-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">reorder =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="reproducible-research-short-course_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>We can see that the rates for each snow fence (<span class="math inline">\(\theta_i\)</span>) are indeed distributed about the sample mean of 2 invasive plants per square meter.</p>
<p>How do the fence-level rates compare with the regional-level rates? We can use the <code>summary()</code> function on the model output samples.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="session-5-implementing-bayesian-models.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(jm_coda)[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>##                 Mean        SD    Naive SE Time-series SE
## alpha       4.940838 1.7791334 0.018753713    0.020548734
## beta        2.362988 0.8990146 0.009476446    0.010344713
## pmean_theta 2.133635 0.3355905 0.003537434    0.003613381
## pstd_theta  1.009152 0.2599937 0.002740575    0.002992529
## theta[1]    1.922982 0.1604328 0.001691110    0.001668412
## theta[2]    1.830783 0.1898067 0.002000739    0.002020824
## theta[3]    2.384865 0.2045426 0.002156068    0.002158823
## theta[4]    2.050765 0.1813432 0.001911525    0.001931191
## theta[5]    2.215917 0.1664404 0.001754436    0.001753172
## theta[6]    1.972456 0.1739080 0.001833151    0.001782088
## theta[7]    2.019942 0.1887418 0.001989513    0.001969378
## theta[8]    2.199109 0.1749615 0.001844256    0.001887350
## theta[9]    1.733456 0.1452889 0.001531480    0.001562532
## theta[10]   1.977165 0.1674572 0.001765154    0.001781153</code></pre>
<p>The regional rate of invasive plants has a posterior mean of ~2.4 and a posterior standard deviation of ~1. Thus, this hierarchical model acts as something of a random effects model, allowing us to account for variation among individual snow fences while reporting statistics at the regional level. The distinction between fixed and random effect is blurred in hierarchical Bayesian modeling, and there can be multiple ways of specifying random effects.</p>
</div>
<div id="interactive-problem-logistic-regression-model" class="section level3 unnumbered aside">
<h3>Interactive problem: Logistic regression model</h3>
<p>Using the steps described above, work in small groups to code, run, and diagnose the logistic regression model for moth coloration.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="session-5-implementing-bayesian-models.html#cb22-1" aria-hidden="true" tabindex="-1"></a>moths <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">site =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">each =</span> <span class="dv">2</span>),</span>
<span id="cb22-2"><a href="session-5-implementing-bayesian-models.html#cb22-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">morph =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">times =</span> <span class="dv">7</span>),</span>
<span id="cb22-3"><a href="session-5-implementing-bayesian-models.html#cb22-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">distance =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">7.2</span>, <span class="fl">24.1</span>, <span class="fl">30.2</span>, <span class="fl">36.4</span>, <span class="fl">41.5</span>, <span class="fl">51.2</span>), <span class="at">each =</span> <span class="dv">2</span>),</span>
<span id="cb22-4"><a href="session-5-implementing-bayesian-models.html#cb22-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">placed =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">56</span>, <span class="dv">80</span>, <span class="dv">52</span>, <span class="dv">60</span>, <span class="dv">60</span>, <span class="dv">84</span>, <span class="dv">92</span>), <span class="at">each =</span> <span class="dv">2</span>),</span>
<span id="cb22-5"><a href="session-5-implementing-bayesian-models.html#cb22-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">removed =</span> <span class="fu">c</span>(<span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">28</span>, <span class="dv">20</span>, <span class="dv">18</span>, <span class="dv">22</span>, <span class="dv">9</span>, <span class="dv">16</span>, <span class="dv">16</span>, <span class="dv">23</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">24</span>, <span class="dv">39</span>))</span></code></pre></div>
<p>Helpful hints:</p>
<ul>
<li><p>Use the <a href="https://people.stat.sc.edu/hansont/stat740/jags_user_manual.pdf">JAGS manual</a> to find the parameters of <code>dbin</code>, the binomial distribution</p></li>
<li><p>No need to specify initials for this regression model</p></li>
<li><p>Can add replicated data to evaluate model fit. Create a new variable <code>y.rep</code> beneath the likelihood and give it an identical distribution.</p></li>
</ul>
<p>Once the model has converged, plot and summarize posterior parameters of interest to address the following questions:</p>
<ul>
<li><p>Does the probability of predation vary with distance fom Liverpool?</p></li>
<li><p>Does the probability of predation differ between morphs?</p></li>
<li><p>Does the effect of distance on predation differ between morphs?</p></li>
<li><p>How might we evaluate model fit?</p></li>
</ul>
</div>
<div id="acknowledgements-1" class="section level3" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> Acknowledgements</h3>
<p>These materials are derived primarily from Bayesian course materials developed and taught by Kiona Ogle. Additional ideas and code have been adapted from materials authored by Kelly Heilman, Robert Shriver, and Drew Peltier. The texts ‘Doing Bayesian Data Analyis’ (Kruschke 2015), ‘Statistical Rethinking’ (McElreath 2016), and ‘Bayesian Data Analysis’ (Gelman et al. 2014) were strongly influential and recommended references.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="session-4-collaborative-synthesis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="session-6-collaborative-synthesis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
